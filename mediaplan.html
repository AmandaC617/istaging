<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è‡ªå‹•åŒ–åª’é«”ææ¡ˆå¼•æ“ (å°ç£å¸‚å ´ç‰¹åŒ–ç‰ˆ MVP)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', 'Noto Sans TC', sans-serif;
        }
        .gradient-bg {
            background: linear-gradient(135deg, #f0f9ff 0%, #e0e7ff 100%);
        }
        .card {
            background-color: white;
            border-radius: 1rem;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }
        .btn-primary {
            background: linear-gradient(135deg, #4f46e5 0%, #818cf8 100%);
            color: white;
            transition: all 0.3s ease;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 7px 14px rgba(0,0,0,0.1);
        }
        .btn-primary:disabled {
            background: #a5b4fc;
            cursor: not-allowed;
            transform: translateY(0);
            box-shadow: none;
        }
        #proposalOutput h2 {
            font-size: 1.5rem;
            font-weight: 700;
            color: #1e3a8a;
            margin-top: 1.5rem;
            margin-bottom: 1rem;
            border-bottom: 2px solid #60a5fa;
            padding-bottom: 0.5rem;
        }
        #proposalOutput h3 {
            font-size: 1.25rem;
            font-weight: 600;
            color: #1d4ed8;
            margin-top: 1.25rem;
            margin-bottom: 0.75rem;
        }
        #proposalOutput p, #proposalOutput li, #proposalOutput td, #proposalOutput th {
            color: #374151;
            line-height: 1.7;
        }
        #proposalOutput p, #proposalOutput ul {
             margin-bottom: 1rem;
        }
        #proposalOutput ul {
            list-style-type: disc;
            padding-left: 1.5rem;
        }
        #proposalOutput strong {
            color: #1e40af;
            font-weight: 600;
        }
        .status-update {
            transition: all 0.5s ease;
            overflow: hidden;
            max-height: 0;
            opacity: 0;
        }
        .status-update.active {
            max-height: 100px; /* or a suitable max-height */
            opacity: 1;
            margin-top: 1rem;
        }
        .input-grid {
            display: grid;
            grid-template-columns: repeat(1, 1fr);
            gap: 1.5rem;
        }
        @media (min-width: 1024px) {
            .input-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }
        #proposalOutput table {
            width: 100%;
            margin-top: 1rem;
            margin-bottom: 1rem;
            border-collapse: collapse;
        }
        #proposalOutput th, #proposalOutput td {
            border: 1px solid #e5e7eb;
            padding: 0.75rem;
            text-align: left;
        }
        #proposalOutput th {
            background-color: #f9fafb;
            font-weight: 600;
        }
    </style>
</head>
<body class="gradient-bg min-h-screen flex items-center justify-center p-4">
    <div class="w-full max-w-6xl mx-auto">
        <div class="card p-8">
            <div class="text-center mb-8">
                <h1 class="text-3xl font-bold text-gray-800">è‡ªå‹•åŒ–åª’é«”ææ¡ˆå¼•æ“</h1>
                <p class="mt-2 text-gray-600">v2.5.1 å¼·åŒ–JSONè§£æç‰ˆ (MVP) 
                <br><small class="text-xs text-gray-500">æœ€å¾Œæ›´æ–°: 2024-10-21 - å¦‚é‡å•é¡Œè«‹å¼·åˆ¶é‡æ–°æ•´ç† (Ctrl+F5)</small></p>
            </div>

            <!-- Module 1: ä½¿ç”¨è€…èˆ‡é…ç½®ä»‹é¢ ('é§•é§›è‰™') -->
            <div class="space-y-6">
                 <!-- API é‡‘é‘°è¼¸å…¥ -->
                <div class="p-4 bg-yellow-50 border border-yellow-200 rounded-lg">
                    <label for="apiKeyInput" class="block text-sm font-medium text-yellow-800 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M18 8a6 6 0 11-12 0 6 6 0 0112 0zM7 8a1 1 0 11-2 0 1 1 0 012 0zm5 0a1 1 0 11-2 0 1 1 0 012 0zm5 0a1 1 0 11-2 0 1 1 0 012 0z" clip-rule="evenodd"></path></svg>
                        Google Gemini API é‡‘é‘° <span class="text-red-500 ml-1">*</span>
                    </label>
                    <input type="password" id="apiKeyInput" class="mt-1 block w-full px-3 py-2 border border-yellow-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500" placeholder="AIzaSy...ï¼ˆæ‡‰ä»¥AIzaSyé–‹é ­ï¼‰">
                    
                    <!-- APIé‡‘é‘°é©—è­‰æŒ‰éˆ• -->
                    <div class="mt-2 flex items-center gap-2">
                        <button type="button" id="validateApiBtn" onclick="validateApiKey()" 
                                class="text-xs bg-blue-500 text-white px-3 py-1 rounded hover:bg-blue-600 transition-colors">
                            ğŸ” é©—è­‰é‡‘é‘°
                        </button>
                        <div id="apiValidationResult" class="text-xs flex-1"></div>
                    </div>
                    
                    <div class="mt-3 p-3 bg-blue-50 border border-blue-200 rounded">
                        <p class="text-xs text-blue-800 font-medium mb-2">ğŸ”§ å¦‚ä½•ç²å–APIé‡‘é‘°ï¼š</p>
                        <ol class="text-xs text-blue-700 list-decimal list-inside space-y-1">
                            <li>è¨ªå• <a href="https://aistudio.google.com/app/apikey" target="_blank" class="underline font-medium hover:text-blue-900">Google AI Studio</a></li>
                            <li>ç™»å…¥æ‚¨çš„Googleå¸³æˆ¶</li>
                            <li>é»æ“Šã€ŒCreate API Keyã€å»ºç«‹æ–°é‡‘é‘°</li>
                            <li>è¤‡è£½é‡‘é‘°ä¸¦è²¼ä¸Šåˆ°ä¸Šæ–¹æ¬„ä½</li>
                        </ol>
                        <div class="mt-2 p-2 bg-green-100 border border-green-200 rounded text-xs">
                            <p class="text-green-800"><strong>âœ… æ­£ç¢ºæ ¼å¼ï¼š</strong> ä»¥ã€ŒAIzaSyã€é–‹é ­ï¼Œç¸½é•·åº¦ç´„39å€‹å­—ç¬¦</p>
                            <p class="text-green-700 mt-1"><strong>âŒ å¸¸è¦‹éŒ¯èª¤ï¼š</strong> åŒ…å«ç©ºæ ¼ã€æ›è¡Œç¬¦æˆ–ä¸å®Œæ•´è¤‡è£½</p>
                        </div>
                    </div>
                    
                    <p class="mt-2 text-xs text-yellow-700">
                        ğŸ”’ æ­¤é‡‘é‘°åƒ…å­˜æ–¼æ‚¨ç›®å‰çš„ç€è¦½å™¨åˆ†é ï¼Œé—œé–‰å¾Œå³æ¶ˆå¤±ï¼Œä¸æœƒè¢«å„²å­˜ã€‚
                    </p>
                </div>
                
                <!-- Project ID è¼¸å…¥ -->
                <div class="p-4 bg-blue-50 border border-blue-200 rounded-lg">
                    <label for="projectIdInput" class="block text-sm font-medium text-blue-800 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M4 4a2 2 0 00-2 2v4a2 2 0 002 2V6h10a2 2 0 00-2-2H4zm2 6a2 2 0 012-2h8a2 2 0 012 2v2a2 2 0 01-2 2H8a2 2 0 01-2-2v-4zm6 4a2 2 0 100-4 2 2 0 000 4z" clip-rule="evenodd"></path></svg>
                        å°ˆæ¡ˆ ID <span class="text-gray-500 ml-1">(å¯é¸)</span>
                    </label>
                    <input type="text" id="projectIdInput" class="mt-1 block w-full px-3 py-2 border border-blue-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500" placeholder="è«‹è¼¸å…¥å°ˆæ¡ˆ ID (å¯é¸)">
                    <p class="mt-2 text-xs text-blue-700">å¦‚ç„¡å°ˆæ¡ˆIDï¼Œç³»çµ±å°‡è‡ªå‹•ç”¢ç”Ÿè‡¨æ™‚IDç”¨æ–¼æª”æ¡ˆå‘½å</p>
                </div>
                
                <!-- é›†ä¸­åŒ–è³‡æ–™å¤¾ç®¡ç†è¨­å®š -->
                <div class="p-4 bg-green-50 border border-green-200 rounded-lg">
                    <label class="block text-sm font-medium text-green-800 flex items-center mb-3">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M2 6a2 2 0 012-2h4l2 2h4a2 2 0 012 2v1H8a3 3 0 00-3 3v1.5a1.5 1.5 0 01-3 0V6z" clip-rule="evenodd"></path><path d="M6 12a2 2 0 012-2h8a2 2 0 012 2v2a2 2 0 01-2 2H2h2a2 2 0 01-2-2v-2z"></path></svg>
                        é›†ä¸­åŒ–è³‡æ–™å¤¾ç®¡ç† <span class="text-gray-500 ml-1">(å¯é¸)</span>
                    </label>
                    <div class="space-y-3">
                        <div>
                            <label for="centralFolderName" class="block text-xs font-medium text-green-700">ä¸»è¦å°ˆæ¡ˆè³‡æ–™å¤¾åç¨±</label>
                            <input type="text" id="centralFolderName" class="mt-1 block w-full px-3 py-2 border border-green-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 text-sm" value="iStaging_å°ˆæ¡ˆç®¡ç†" placeholder="ä¾‹å¦‚: iStaging_å°ˆæ¡ˆç®¡ç†">
                        </div>
                        <div>
                            <label for="mediaplanSubfolder" class="block text-xs font-medium text-green-700">åª’é«”ææ¡ˆå­è³‡æ–™å¤¾åç¨±</label>
                            <input type="text" id="mediaplanSubfolder" class="mt-1 block w-full px-3 py-2 border border-green-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 text-sm" value="02_åª’é«”ææ¡ˆ" placeholder="ä¾‹å¦‚: 02_åª’é«”ææ¡ˆ">
                        </div>
                    </div>
                    <p class="mt-2 text-xs text-green-700">è¨­å®šå¾Œå°‡è‡ªå‹•å»ºç«‹å°ˆæ¡ˆè³‡æ–™å¤¾çµæ§‹ä¸¦å„²å­˜çµæœ</p>
                </div>

                <div class="border-t border-gray-200 pt-6">
                    <div class="input-grid">
                        <div>
                            <label for="targetBrand" class="block text-sm font-medium text-gray-700">ç›®æ¨™å“ç‰Œ / ç”¢å“ <span class="text-red-500">*</span></label>
                            <input type="text" id="targetBrand" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500" placeholder="ä¾‹å¦‚ï¼šgogoro, æ˜Ÿå®‡èˆªç©º">
                        </div>
                        <div>
                            <label for="competitorBrand" class="block text-sm font-medium text-gray-700">ä¸»è¦ç«¶çˆ­å°æ‰‹ <span class="text-red-500">*</span></label>
                            <input type="text" id="competitorBrand" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500" placeholder="ä¾‹å¦‚ï¼šå…‰é™½, é•·æ¦®èˆªç©º">
                        </div>
                         <div>
                            <label for="industry" class="block text-sm font-medium text-gray-700">ç›®æ¨™å¸‚å ´ / ç”¢æ¥­ <span class="text-red-500">*</span></label>
                            <select id="industry" class="mt-1 block w-full px-3 py-2 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                <option>æ¶ˆè²»æ€§é›»å­ç”¢å“</option>
                                <option>æ™‚å°šæœé£¾èˆ‡é…ä»¶</option>
                                <option>ç¾å¦ä¿é¤Š</option>
                                <option>æ—…éŠèˆ‡èˆªç©ºæœå‹™</option>
                                <option>é¤é£²æ¥­</option>
                                <option>B2B è»Ÿé«”æœå‹™</option>
                                <option>é‡‘èèˆ‡ä¿éšªæœå‹™</option>
                                <option>å…¶ä»–</option>
                            </select>
                        </div>
                        <div>
                            <label for="businessModel" class="block text-sm font-medium text-gray-700">å•†æ¥­æ¨¡å¼ <span class="text-red-500">*</span></label>
                             <select id="businessModel" class="mt-1 block w-full px-3 py-2 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                <option value="B2C">B2C (ä¼æ¥­å°æ¶ˆè²»è€…)</option>
                                <option value="B2B">B2B (ä¼æ¥­å°ä¼æ¥­)</option>
                            </select>
                        </div>
                         <div>
                            <label for="salesChannels" class="block text-sm font-medium text-gray-700">ä¸»è¦éŠ·å”®é€šè·¯</label>
                            <input type="text" id="salesChannels" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500" placeholder="ä¾‹å¦‚ï¼šç·šä¸Šå®˜ç¶²ã€MOMOã€å¯¦é«”é–€å¸‚">
                        </div>
                        <div>
                            <label for="targetAudience" class="block text-sm font-medium text-gray-700">ç›®æ¨™äººç¾¤æè¿°</label>
                            <input type="text" id="targetAudience" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500" placeholder="ä¾‹å¦‚ï¼š25-35æ­²éƒ½æœƒå¥³æ€§ã€ç§‘æŠ€æ¥­æ¡è³¼ä¸»ç®¡">
                        </div>
                         <div class="md:col-span-3">
                            <label for="advertisingBudget" class="block text-sm font-medium text-gray-700">é è¨ˆå»£å‘Šé ç®— (å°å¹£)</label>
                            <input type="number" id="advertisingBudget" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500" placeholder="ä¾‹å¦‚ï¼š300000">
                        </div>
                    </div>
                </div>

                <!-- B2B å°ˆæ¥­å¸‚å ´åˆ†æè¨­å®š -->
                <div class="border-t border-gray-200 pt-6">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
                        <svg class="w-5 h-5 mr-2 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"></path>
                        </svg>
                        B2B å°ˆæ¥­å¸‚å ´åˆ†æè¨­å®š
                    </h3>
                    <div class="input-grid">
                        <div>
                            <label for="targetCompanySize" class="block text-sm font-medium text-gray-700">ç›®æ¨™ä¼æ¥­è¦æ¨¡</label>
                            <select id="targetCompanySize" class="mt-1 block w-full px-3 py-2 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                <option value="startup">æ–°å‰µä¼æ¥­ (1-50äºº)</option>
                                <option value="sme">ä¸­å°ä¼æ¥­ (51-500äºº)</option>
                                <option value="mid-market">ä¸­å‹ä¼æ¥­ (501-2000äºº)</option>
                                <option value="enterprise">å¤§å‹ä¼æ¥­ (2000+äºº)</option>
                                <option value="mixed">æ··åˆå‹ä¼æ¥­</option>
                            </select>
                        </div>
                        <div>
                            <label for="decisionMakerRole" class="block text-sm font-medium text-gray-700">ä¸»è¦æ±ºç­–è€…è§’è‰²</label>
                            <select id="decisionMakerRole" class="mt-1 block w-full px-3 py-2 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                <option value="ceo">CEO/ç¸½ç¶“ç†</option>
                                <option value="cto">CTO/æŠ€è¡“é•·</option>
                                <option value="cfo">CFO/è²¡å‹™é•·</option>
                                <option value="cmo">CMO/è¡ŒéŠ·é•·</option>
                                <option value="cio">CIO/è³‡è¨Šé•·</option>
                                <option value="procurement">æ¡è³¼ç¶“ç†</option>
                                <option value="department-head">éƒ¨é–€ä¸»ç®¡</option>
                                <option value="influencer">å½±éŸ¿è€…/æ¨è–¦è€…</option>
                            </select>
                        </div>
                        <div>
                            <label for="purchaseCycle" class="block text-sm font-medium text-gray-700">æ¡è³¼é€±æœŸ</label>
                            <select id="purchaseCycle" class="mt-1 block w-full px-3 py-2 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                <option value="immediate">ç«‹å³æ¡è³¼ (1-30å¤©)</option>
                                <option value="short">çŸ­æœŸæ¡è³¼ (1-3å€‹æœˆ)</option>
                                <option value="medium">ä¸­æœŸæ¡è³¼ (3-6å€‹æœˆ)</option>
                                <option value="long">é•·æœŸæ¡è³¼ (6-12å€‹æœˆ)</option>
                                <option value="strategic">ç­–ç•¥æ€§æ¡è³¼ (1å¹´ä»¥ä¸Š)</option>
                            </select>
                        </div>
                        <div>
                            <label for="budgetRange" class="block text-sm font-medium text-gray-700">é ç®—ç¯„åœ</label>
                            <select id="budgetRange" class="mt-1 block w-full px-3 py-2 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                <option value="low">ä½é ç®— (10è¬ä»¥ä¸‹)</option>
                                <option value="medium">ä¸­ç­‰é ç®— (10-50è¬)</option>
                                <option value="high">é«˜é ç®— (50-200è¬)</option>
                                <option value="enterprise">ä¼æ¥­ç´šé ç®— (200è¬ä»¥ä¸Š)</option>
                                <option value="unlimited">ç„¡é™åˆ¶é ç®—</option>
                            </select>
                        </div>
                        <div>
                            <label for="painPoints" class="block text-sm font-medium text-gray-700">ä¸»è¦ç—›é»</label>
                            <input type="text" id="painPoints" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500" placeholder="ä¾‹å¦‚ï¼šæ•ˆç‡ä½ä¸‹ã€æˆæœ¬éé«˜ã€æŠ€è¡“è½å¾Œ">
                        </div>
                        <div>
                            <label for="successMetrics" class="block text-sm font-medium text-gray-700">æˆåŠŸæŒ‡æ¨™</label>
                            <input type="text" id="successMetrics" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500" placeholder="ä¾‹å¦‚ï¼šROIã€æ•ˆç‡æå‡ã€æˆæœ¬ç¯€çœ">
                        </div>
                        <div class="md:col-span-3">
                            <label for="competitiveAdvantage" class="block text-sm font-medium text-gray-700">ç«¶çˆ­å„ªå‹¢</label>
                            <textarea id="competitiveAdvantage" rows="3" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500" placeholder="è«‹æè¿°ç›¸å°æ–¼ç«¶çˆ­å°æ‰‹çš„æ ¸å¿ƒå„ªå‹¢ï¼Œä¾‹å¦‚ï¼šæŠ€è¡“é ˜å…ˆã€æœå‹™å“è³ªã€åƒ¹æ ¼å„ªå‹¢ã€æœ¬åœ°åŒ–æ”¯æ´ç­‰"></textarea>
                        </div>
                        <div class="md:col-span-3">
                            <label for="industryChallenges" class="block text-sm font-medium text-gray-700">ç”¢æ¥­æŒ‘æˆ°</label>
                            <textarea id="industryChallenges" rows="3" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500" placeholder="è«‹æè¿°ç›®æ¨™ç”¢æ¥­é¢è‡¨çš„ä¸»è¦æŒ‘æˆ°ï¼Œä¾‹å¦‚ï¼šæ•¸ä½è½‰å‹å£“åŠ›ã€äººæ‰çŸ­ç¼ºã€æ³•è¦è®Šæ›´ã€å¸‚å ´ç«¶çˆ­ç­‰"></textarea>
                        </div>
                    </div>
                </div>

                <!-- è·¨åœ‹å¸‚å ´ç­–ç•¥è¨­å®š -->
                <div class="border-t border-gray-200 pt-6">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
                        <svg class="w-5 h-5 mr-2 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3.055 11H5a2 2 0 012 2v1a2 2 0 002 2 2 2 0 012 2v2.945M8 3.935V5.5A2.5 2.5 0 0010.5 8h.5a2 2 0 012 2 2 2 0 104 0 2 2 0 012-2h1.064M15 20.488V18a2 2 0 012-2h3.064M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                        è·¨åœ‹å¸‚å ´ç­–ç•¥è¨­å®š
                    </h3>
                    <div class="input-grid">
                        <div>
                            <label for="targetMarkets" class="block text-sm font-medium text-gray-700">ç›®æ¨™å¸‚å ´ <span class="text-red-500">*</span></label>
                            <select id="targetMarkets" class="mt-1 block w-full px-3 py-2 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                <option value="single">å–®ä¸€å¸‚å ´ (å°ç£)</option>
                                <option value="multi-asia">å¤šåœ‹äºæ´²å¸‚å ´</option>
                                <option value="global">å…¨çƒå¸‚å ´</option>
                                <option value="custom">è‡ªè¨‚å¸‚å ´çµ„åˆ</option>
                            </select>
                        </div>
                        <div>
                            <label for="primaryMarket" class="block text-sm font-medium text-gray-700">ä¸»è¦å¸‚å ´</label>
                            <select id="primaryMarket" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="taiwan">å°ç£</option>
                                <option value="japan">æ—¥æœ¬</option>
                                <option value="us">ç¾åœ‹</option>
                                <option value="india">å°åº¦</option>
                                <option value="germany">å¾·åœ‹</option>
                                <option value="philippines">è²å¾‹è³“</option>
                            </select>
                        </div>
                        <div>
                            <label for="secondaryMarkets" class="block text-sm font-medium text-gray-700">æ¬¡è¦å¸‚å ´</label>
                            <input type="text" id="secondaryMarkets" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500" placeholder="ä¾‹å¦‚ï¼šæ—¥æœ¬ã€æ–°åŠ å¡ã€é¦™æ¸¯">
                        </div>
                        <div>
                            <label for="marketEntryStrategy" class="block text-sm font-medium text-gray-700">å¸‚å ´é€²å…¥ç­–ç•¥</label>
                            <select id="marketEntryStrategy" class="mt-1 block w-full px-3 py-2 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                <option value="organic">æœ‰æ©Ÿæˆé•·</option>
                                <option value="aggressive">ç©æ¥µæ“´å¼µ</option>
                                <option value="partnership">ç­–ç•¥è¯ç›Ÿ</option>
                                <option value="acquisition">ä½µè³¼é€²å…¥</option>
                                <option value="franchise">ç‰¹è¨±ç¶“ç‡Ÿ</option>
                            </select>
                        </div>
                        <div>
                            <label for="localizationLevel" class="block text-sm font-medium text-gray-700">æœ¬åœ°åŒ–ç¨‹åº¦</label>
                            <select id="localizationLevel" class="mt-1 block w-full px-3 py-2 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                <option value="minimal">æœ€å°æœ¬åœ°åŒ–</option>
                                <option value="moderate">ä¸­åº¦æœ¬åœ°åŒ–</option>
                                <option value="high">é«˜åº¦æœ¬åœ°åŒ–</option>
                                <option value="full">å®Œå…¨æœ¬åœ°åŒ–</option>
                            </select>
                        </div>
                        <div>
                            <label for="culturalSensitivity" class="block text-sm font-medium text-gray-700">æ–‡åŒ–æ•æ„Ÿåº¦</label>
                            <select id="culturalSensitivity" class="mt-1 block w-full px-3 py-2 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                <option value="low">ä½ (æ¨™æº–åŒ–ç­–ç•¥)</option>
                                <option value="medium">ä¸­ (é©åº¦èª¿æ•´)</option>
                                <option value="high">é«˜ (æ·±åº¦æ–‡åŒ–é©æ‡‰)</option>
                                <option value="critical">é—œéµ (æ–‡åŒ–å„ªå…ˆ)</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- è·¨åœ‹æºé€šç­–ç•¥è¨­å®š -->
                <div class="border-t border-gray-200 pt-6">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
                        <svg class="w-5 h-5 mr-2 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path>
                        </svg>
                        è·¨åœ‹æºé€šç­–ç•¥è¨­å®š
                    </h3>
                    <div class="input-grid">
                        <div>
                            <label for="communicationStrategy" class="block text-sm font-medium text-gray-700">æºé€šç­–ç•¥é¡å‹</label>
                            <select id="communicationStrategy" class="mt-1 block w-full px-3 py-2 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                <option value="global">å…¨çƒçµ±ä¸€ç­–ç•¥</option>
                                <option value="glocal">å…¨çƒåœ¨åœ°åŒ–</option>
                                <option value="local">å®Œå…¨åœ¨åœ°åŒ–</option>
                                <option value="hybrid">æ··åˆç­–ç•¥</option>
                            </select>
                        </div>
                        <div>
                            <label for="languageStrategy" class="block text-sm font-medium text-gray-700">èªè¨€ç­–ç•¥</label>
                            <select id="languageStrategy" class="mt-1 block w-full px-3 py-2 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                <option value="english">è‹±èªç‚ºä¸»</option>
                                <option value="local">ç•¶åœ°èªè¨€</option>
                                <option value="multilingual">å¤šèªè¨€ä¸¦è¡Œ</option>
                                <option value="translation">ç¿»è­¯ç­–ç•¥</option>
                            </select>
                        </div>
                        <div>
                            <label for="toneStrategy" class="block text-sm font-medium text-gray-700">èªèª¿ç­–ç•¥</label>
                            <select id="toneStrategy" class="mt-1 block w-full px-3 py-2 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                <option value="formal">æ­£å¼å°ˆæ¥­</option>
                                <option value="casual">è¼•é¬†è¦ªåˆ‡</option>
                                <option value="luxury">å¥¢è¯é«˜ç«¯</option>
                                <option value="youthful">å¹´è¼•æ´»åŠ›</option>
                                <option value="adaptive">é©æ‡‰æ€§èªèª¿</option>
                            </select>
                        </div>
                        <div>
                            <label for="channelStrategy" class="block text-sm font-medium text-gray-700">é€šè·¯ç­–ç•¥</label>
                            <select id="channelStrategy" class="mt-1 block w-full px-3 py-2 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                <option value="digital">æ•¸ä½å„ªå…ˆ</option>
                                <option value="traditional">å‚³çµ±åª’é«”</option>
                                <option value="omnichannel">å…¨é€šè·¯æ•´åˆ</option>
                                <option value="social">ç¤¾ç¾¤åª’é«”</option>
                                <option value="influencer">ç¶²ç´…è¡ŒéŠ·</option>
                            </select>
                        </div>
                        <div>
                            <label for="timingStrategy" class="block text-sm font-medium text-gray-700">æ™‚æ©Ÿç­–ç•¥</label>
                            <select id="timingStrategy" class="mt-1 block w-full px-3 py-2 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                <option value="simultaneous">åŒæ­¥ç™¼å¸ƒ</option>
                                <option value="staggered">åˆ†éšæ®µç™¼å¸ƒ</option>
                                <option value="localized">ç•¶åœ°æ™‚æ©Ÿ</option>
                                <option value="event-driven">äº‹ä»¶é©…å‹•</option>
                            </select>
                        </div>
                        <div>
                            <label for="crisisManagement" class="block text-sm font-medium text-gray-700">å±æ©Ÿç®¡ç†ç­–ç•¥</label>
                            <select id="crisisManagement" class="mt-1 block w-full px-3 py-2 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                <option value="centralized">ä¸­å¤®åŒ–è™•ç†</option>
                                <option value="decentralized">åˆ†æ•£åŒ–è™•ç†</option>
                                <option value="hybrid">æ··åˆè™•ç†</option>
                                <option value="localized">ç•¶åœ°è™•ç†</option>
                            </select>
                        </div>
                        <div class="md:col-span-3">
                            <label for="culturalConsiderations" class="block text-sm font-medium text-gray-700">æ–‡åŒ–è€ƒé‡é‡é»</label>
                            <textarea id="culturalConsiderations" rows="3" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500" placeholder="è«‹æè¿°éœ€è¦ç‰¹åˆ¥æ³¨æ„çš„æ–‡åŒ–æ•æ„Ÿè­°é¡Œï¼Œä¾‹å¦‚ï¼šå®—æ•™ç¦å¿Œã€é¡è‰²è±¡å¾µã€æ•¸å­—ç¦å¿Œç­‰"></textarea>
                        </div>
                        <div class="md:col-span-3">
                            <label for="regulatoryRequirements" class="block text-sm font-medium text-gray-700">æ³•è¦è¦æ±‚</label>
                            <textarea id="regulatoryRequirements" rows="3" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500" placeholder="è«‹æè¿°å„ç›®æ¨™å¸‚å ´çš„å»£å‘Šæ³•è¦è¦æ±‚ï¼Œä¾‹å¦‚ï¼šæ¨™ç¤ºè¦å®šã€å…§å®¹é™åˆ¶ã€å¯©æŸ¥æµç¨‹ç­‰"></textarea>
                        </div>
                    </div>
                </div>

                <button id="generateBtn" class="w-full btn-primary font-bold py-3 px-4 rounded-lg flex items-center justify-center text-lg">
                    <svg class="w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path></svg>
                    ç”Ÿæˆ AI åˆ†æå ±å‘Š
                </button>
            </div>

            <!-- å‹•æ…‹ç‹€æ…‹æ›´æ–°å€åŸŸ -->
            <div id="statusContainer" class="mt-4 space-y-2"></div>

            <!-- Module 4: è¼¸å‡ºèˆ‡äº¤ä»˜æ¨¡çµ„ ('æ¸²æŸ“å±¤') -->
            <div id="proposalOutput" class="mt-8 border-t-2 border-gray-200 pt-6">
                <!-- AI ç”Ÿæˆçš„å…§å®¹å°‡æœƒé¡¯ç¤ºåœ¨é€™è£¡ -->
            </div>
        </div>
        <footer class="text-center mt-4 text-sm text-gray-500">
            <p>æœ¬åŸå‹ç”± Google Gemini é©…å‹•ï¼Œæ‰€æœ‰åˆ†æçš†ç‚ºå³æ™‚ç”Ÿæˆã€‚</p>
        </footer>
    </div>

    <script type="module">
        // --- UI å…ƒç´  ---
        const apiKeyInput = document.getElementById('apiKeyInput');
        const projectIdInput = document.getElementById('projectIdInput');
        const generateBtn = document.getElementById('generateBtn');
        const targetBrandInput = document.getElementById('targetBrand');
        const competitorBrandInput = document.getElementById('competitorBrand');
        const industryInput = document.getElementById('industry');
        const businessModelInput = document.getElementById('businessModel');
        const salesChannelsInput = document.getElementById('salesChannels');
        const targetAudienceInput = document.getElementById('targetAudience');
        const advertisingBudgetInput = document.getElementById('advertisingBudget');
        const statusContainer = document.getElementById('statusContainer');
        const proposalOutput = document.getElementById('proposalOutput');

        // è·¨åœ‹å¸‚å ´ç­–ç•¥ UI å…ƒç´ 
        const targetMarketsInput = document.getElementById('targetMarkets');
        const primaryMarketInput = document.getElementById('primaryMarket');
        const secondaryMarketsInput = document.getElementById('secondaryMarkets');
        const marketEntryStrategyInput = document.getElementById('marketEntryStrategy');
        const localizationLevelInput = document.getElementById('localizationLevel');
        const culturalSensitivityInput = document.getElementById('culturalSensitivity');

        // è·¨åœ‹æºé€šç­–ç•¥ UI å…ƒç´ 
        const communicationStrategyInput = document.getElementById('communicationStrategy');
        const languageStrategyInput = document.getElementById('languageStrategy');
        const toneStrategyInput = document.getElementById('toneStrategy');
        const channelStrategyInput = document.getElementById('channelStrategy');
        const timingStrategyInput = document.getElementById('timingStrategy');
        const crisisManagementInput = document.getElementById('crisisManagement');
        const culturalConsiderationsInput = document.getElementById('culturalConsiderations');
        const regulatoryRequirementsInput = document.getElementById('regulatoryRequirements');

        // B2B å°ˆæ¥­å¸‚å ´åˆ†æ UI å…ƒç´ 
        const targetCompanySizeInput = document.getElementById('targetCompanySize');
        const decisionMakerRoleInput = document.getElementById('decisionMakerRole');
        const purchaseCycleInput = document.getElementById('purchaseCycle');
        const budgetRangeInput = document.getElementById('budgetRange');
        const painPointsInput = document.getElementById('painPoints');
        const successMetricsInput = document.getElementById('successMetrics');
        const competitiveAdvantageInput = document.getElementById('competitiveAdvantage');
        const industryChallengesInput = document.getElementById('industryChallenges');

        // æª¢æŸ¥å¿…è¦å…ƒç´ æ˜¯å¦å­˜åœ¨
        if (!apiKeyInput || !projectIdInput || !generateBtn || !targetBrandInput || 
            !competitorBrandInput || !industryInput || !businessModelInput || 
            !salesChannelsInput || !targetAudienceInput || !advertisingBudgetInput || 
            !statusContainer || !proposalOutput || !targetMarketsInput || 
            !primaryMarketInput || !secondaryMarketsInput || !marketEntryStrategyInput ||
            !localizationLevelInput || !culturalSensitivityInput || !communicationStrategyInput ||
            !languageStrategyInput || !toneStrategyInput || !channelStrategyInput ||
            !timingStrategyInput || !crisisManagementInput || !culturalConsiderationsInput ||
            !regulatoryRequirementsInput || !targetCompanySizeInput || !decisionMakerRoleInput ||
            !purchaseCycleInput || !budgetRangeInput || !painPointsInput || !successMetricsInput ||
            !competitiveAdvantageInput || !industryChallengesInput) {
            console.error('æŸäº›å¿…è¦çš„ UI å…ƒç´ æœªæ‰¾åˆ°ï¼Œè«‹æª¢æŸ¥ HTML çµæ§‹');
            // é¡¯ç¤ºéŒ¯èª¤è¨Šæ¯çµ¦ç”¨æˆ¶
            document.body.innerHTML = `
                <div class="min-h-screen bg-gray-50 flex items-center justify-center">
                    <div class="max-w-md w-full bg-white rounded-lg shadow-lg p-6">
                        <div class="text-center">
                            <svg class="mx-auto h-12 w-12 text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"></path>
                            </svg>
                            <h3 class="mt-4 text-lg font-medium text-gray-900">é é¢è¼‰å…¥éŒ¯èª¤</h3>
                            <p class="mt-2 text-sm text-gray-500">æŸäº›å¿…è¦çš„ UI å…ƒç´ æœªæ‰¾åˆ°ï¼Œè«‹é‡æ–°æ•´ç†é é¢æˆ–è¯ç¹«æŠ€è¡“æ”¯æ´ã€‚</p>
                            <button onclick="location.reload()" class="mt-4 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md">
                                é‡æ–°æ•´ç†é é¢
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }

        // å…¨åŸŸè®Šæ•¸å„²å­˜ project ID
        let currentProjectId = null;

        // æ–°å¢ï¼šé›†ä¸­åŒ–è³‡æ–™å¤¾ç®¡ç†è®Šæ•¸
        let folderStructure = {
            centralFolder: 'iStaging_å°ˆæ¡ˆç®¡ç†',
            mediaplanSubfolder: '02_åª’é«”ææ¡ˆ'
        };
        let folderIds = {
            central: null,
            project: null,
            mediaplan: null
        };
        let isGoogleDriveEnabled = false;

        // æ–°å¢ï¼šå¾ URL åƒæ•¸è®€å– project ID
        function loadProjectIdFromUrl() {
            try {
                const urlParams = new URLSearchParams(window.location.search);
                const projectId = urlParams.get('projectId');
                if (projectId && projectIdInput) {
                    projectIdInput.value = projectId;
                    currentProjectId = projectId;
                    console.log('å¾ URL è®€å–åˆ°å°ˆæ¡ˆ ID:', projectId);
                }
            } catch (error) {
                console.warn('è®€å– URL åƒæ•¸å¤±æ•—:', error);
            }
        }

        // é é¢è¼‰å…¥æ™‚è®€å– project ID
        loadProjectIdFromUrl();

        // ç¶å®šäº‹ä»¶ç›£è½å™¨ï¼ˆåªæœ‰åœ¨å…ƒç´ å­˜åœ¨æ™‚æ‰ç¶å®šï¼‰
        if (generateBtn) {
            generateBtn.addEventListener('click', handleGenerateClick);
        } else {
            console.error('ç”ŸæˆæŒ‰éˆ•æœªæ‰¾åˆ°ï¼Œç„¡æ³•ç¶å®šäº‹ä»¶');
        }

        // ç›®æ¨™å¸‚å ´é¸æ“‡çš„å‹•æ…‹åŠŸèƒ½
        if (targetMarketsInput) {
            targetMarketsInput.addEventListener('change', function() {
                const selectedMarket = this.value;
                updateMarketFields(selectedMarket);
            });
        }

        // æ›´æ–°å¸‚å ´ç›¸é—œæ¬„ä½çš„é¡¯ç¤ºå’Œé è¨­å€¼
        function updateMarketFields(selectedMarket) {
            const secondaryMarketsField = document.getElementById('secondaryMarkets');
            const primaryMarketField = document.getElementById('primaryMarket');
            const localizationField = document.getElementById('localizationLevel');
            const culturalSensitivityField = document.getElementById('culturalSensitivity');

            if (selectedMarket === 'single') {
                // å–®ä¸€å¸‚å ´ï¼šéš±è—æ¬¡è¦å¸‚å ´ï¼Œè¨­å®šæœ¬åœ°åŒ–ç‚ºä¸­åº¦
                if (secondaryMarketsField) {
                    secondaryMarketsField.value = '';
                    secondaryMarketsField.parentElement.style.display = 'none';
                }
                if (localizationField) {
                    localizationField.value = 'moderate';
                }
                if (culturalSensitivityField) {
                    culturalSensitivityField.value = 'medium';
                }
            } else if (selectedMarket === 'multi-asia') {
                // å¤šåœ‹äºæ´²å¸‚å ´ï¼šé¡¯ç¤ºæ¬¡è¦å¸‚å ´ï¼Œè¨­å®šæœ¬åœ°åŒ–ç‚ºé«˜åº¦
                if (secondaryMarketsField) {
                    secondaryMarketsField.parentElement.style.display = 'block';
                    secondaryMarketsField.placeholder = 'ä¾‹å¦‚ï¼šæ—¥æœ¬ã€æ–°åŠ å¡ã€é¦™æ¸¯ã€é¦¬ä¾†è¥¿äº';
                }
                if (localizationField) {
                    localizationField.value = 'high';
                }
                if (culturalSensitivityField) {
                    culturalSensitivityField.value = 'high';
                }
            } else if (selectedMarket === 'global') {
                // å…¨çƒå¸‚å ´ï¼šé¡¯ç¤ºæ¬¡è¦å¸‚å ´ï¼Œè¨­å®šæœ¬åœ°åŒ–ç‚ºå®Œå…¨
                if (secondaryMarketsField) {
                    secondaryMarketsField.parentElement.style.display = 'block';
                    secondaryMarketsField.placeholder = 'ä¾‹å¦‚ï¼šç¾åœ‹ã€æ­æ´²ã€æ—¥æœ¬ã€æ±å—äº';
                }
                if (localizationField) {
                    localizationField.value = 'full';
                }
                if (culturalSensitivityField) {
                    culturalSensitivityField.value = 'critical';
                }
            } else if (selectedMarket === 'custom') {
                // è‡ªè¨‚å¸‚å ´ï¼šé¡¯ç¤ºæ¬¡è¦å¸‚å ´ï¼Œä¿æŒé è¨­å€¼
                if (secondaryMarketsField) {
                    secondaryMarketsField.parentElement.style.display = 'block';
                    secondaryMarketsField.placeholder = 'è«‹è¼¸å…¥è‡ªè¨‚çš„æ¬¡è¦å¸‚å ´';
                }
            }
        }

        // --- Module 2: AI ä»»å‹™å”èª¿èˆ‡åŸ·è¡Œæ ¸å¿ƒ ('èåˆä¸­æ¨') ---
        async function callGeminiAPI(prompt, apiKey, isJsonMode = false) {
            if (!apiKey) {
                throw new Error("Google Gemini API é‡‘é‘°ç‚ºç©ºï¼Œè«‹åœ¨ä»‹é¢ä¸Šæ–¹è¼¸å…¥ã€‚");
            }
            const payload = {
                contents: [{ role: "user", parts: [{ text: prompt }] }],
            };
            if (isJsonMode) {
                payload.generationConfig = { responseMimeType: "application/json" };
            }
            
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=${apiKey}`;
            
            const response = await fetch(apiUrl, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });
            if (!response.ok) {
                const errorBody = await response.text();
                throw new Error(`AI API è«‹æ±‚å¤±æ•— (ç‹€æ…‹ ${response.status}): ${errorBody}`);
            }
            const result = await response.json();
            if (result.candidates && result.candidates[0]?.content?.parts[0]?.text) {
                const rawText = result.candidates[0].content.parts[0].text;
                
                if (isJsonMode) {
                    try {
                        // å˜—è©¦ç›´æ¥è§£æ
                        return JSON.parse(rawText);
                    } catch (parseError) {
                        console.warn('ç›´æ¥ JSON è§£æå¤±æ•—ï¼Œå˜—è©¦æ¸…ç†æ–‡å­—:', parseError);
                        console.log('åŸå§‹å›æ‡‰æ–‡å­—:', rawText);
                        
                        // æ”¹é€²çš„æ–‡å­—æ¸…ç†é‚è¼¯
                        let cleanedText = rawText.trim();
                        
                        // ç§»é™¤å¯èƒ½çš„ markdown æ¨™è¨˜
                        cleanedText = cleanedText.replace(/```json\s*/gi, '').replace(/```\s*$/gi, '');
                        cleanedText = cleanedText.replace(/```\s*/gi, '');
                        
                        // ç§»é™¤å¯èƒ½çš„å‰ç¶´æ–‡å­—ï¼ˆå¦‚"ä»¥ä¸‹æ˜¯åˆ†æçµæœï¼š"ç­‰ï¼‰
                        cleanedText = cleanedText.replace(/^[^{]*/, '');
                        cleanedText = cleanedText.replace(/[^}]*$/, '}');
                        
                        // å°‹æ‰¾ JSON ç‰©ä»¶é–‹å§‹å’ŒçµæŸçš„ä½ç½®
                        const jsonStart = cleanedText.indexOf('{');
                        const jsonEnd = cleanedText.lastIndexOf('}');
                        
                        if (jsonStart !== -1 && jsonEnd !== -1 && jsonEnd > jsonStart) {
                            cleanedText = cleanedText.substring(jsonStart, jsonEnd + 1);
                        }
                        
                        // å¼·åŒ–çš„JSONä¿®å¾©æ©Ÿåˆ¶
                        try {
                            // 1. è™•ç†å¯èƒ½çš„å°¾éš¨é€—è™Ÿ
                            cleanedText = cleanedText.replace(/,(\s*[}\]])/g, '$1');
                            
                            // 2. è™•ç†ç¼ºå°‘é€—è™Ÿçš„å•é¡Œ (å¸¸è¦‹æ–¼ä½ç½®168éŒ¯èª¤)
                            cleanedText = cleanedText.replace(/"\s*"([^,}\]])/g, '", "$1');
                            cleanedText = cleanedText.replace(/}(\s*)"/g, '}, $1"');
                            cleanedText = cleanedText.replace(/](\s*)"/g, '], $1"');
                            
                            // 3. ä¿®å¾©å¯èƒ½ç¼ºå°‘çš„å³æ‹¬è™Ÿ
                            const openBraces = (cleanedText.match(/{/g) || []).length;
                            const closeBraces = (cleanedText.match(/}/g) || []).length;
                            if (openBraces > closeBraces) {
                                cleanedText += '}'.repeat(openBraces - closeBraces);
                            }
                            
                            // 4. ä¿®å¾©å¯èƒ½ç¼ºå°‘çš„å³æ–¹æ‹¬è™Ÿ
                            const openBrackets = (cleanedText.match(/\[/g) || []).length;
                            const closeBrackets = (cleanedText.match(/\]/g) || []).length;
                            if (openBrackets > closeBrackets) {
                                cleanedText += ']'.repeat(openBrackets - closeBrackets);
                            }
                            
                            // 5. è™•ç†æ›è¡Œç¬¦åœ¨å­—ç¬¦ä¸²ä¸­çš„å•é¡Œ
                            cleanedText = cleanedText.replace(/"\s*\n\s*"/g, '" "');
                            cleanedText = cleanedText.replace(/:\s*\n\s*/g, ': ');
                            
                            // 6. è™•ç†å–®å¼•è™Ÿ
                            cleanedText = cleanedText.replace(/'/g, '"');
                            
                            // 7. ç§»é™¤æ§åˆ¶å­—ç¬¦
                            cleanedText = cleanedText.replace(/[\x00-\x1F\x7F-\x9F]/g, ' ');
                            
                            // 8. è™•ç†é‡è¤‡çš„é€—è™Ÿ
                            cleanedText = cleanedText.replace(/,+/g, ',');
                            
                            // 9. ç§»é™¤keyä¹‹å‰æˆ–ä¹‹å¾Œçš„å¤šé¤˜ç©ºæ ¼å’Œç‰¹æ®Šå­—ç¬¦
                            cleanedText = cleanedText.replace(/,(\s*)}/g, '$1}');
                            
                            console.log('å¼·åŒ–æ¸…ç†å¾Œçš„JSONæ–‡å­—:', cleanedText.substring(0, 500) + '...');
                            return JSON.parse(cleanedText);
                        } catch (secondError) {
                            console.error('æ¸…ç†å¾Œçš„ JSON è§£æä»ç„¶å¤±æ•—:', secondError);
                            console.error('åŸå§‹æ–‡å­—:', rawText);
                            console.error('æ¸…ç†å¾Œæ–‡å­—:', cleanedText);
                            console.error('éŒ¯èª¤ä½ç½®è³‡è¨Š:', {
                                message: secondError.message,
                                position: cleanedText.substring(Math.max(0, secondError.toString().match(/\d+/)?.[0] - 50 || 0), (secondError.toString().match(/\d+/)?.[0] || 0) + 50)
                            });
                            
                            // å˜—è©¦å›é€€åˆ°éJSONæ¨¡å¼ï¼Œç›´æ¥è¿”å›åŸå§‹æ–‡å­—
                            console.warn('JSONè§£æå®Œå…¨å¤±æ•—ï¼Œå›é€€åˆ°æ–‡å­—æ¨¡å¼');
                            return rawText;
                        }
                    }
                } else {
                    return rawText;
                }
            } else {
                console.error("AI å›æ‡‰æ ¼å¼ä¸ç¬¦:", result);
                throw new Error("AI æœªèƒ½ç”Ÿæˆæœ‰æ•ˆçš„åˆ†æå ±å‘Šï¼Œè«‹æª¢æŸ¥ä¸»æ§å°ã€‚");
            }
        }
        
        function updateStatus(text, state = 'running') {
            if (!statusContainer) {
                console.error('ç‹€æ…‹å®¹å™¨æœªæ‰¾åˆ°');
                return null;
            }

            const statusId = `status-${Date.now()}`;
            const icon = {
                running: `<svg class="animate-spin h-5 w-5 mr-3 text-indigo-500" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>`,
                done: `<svg class="h-5 w-5 mr-3 text-green-500" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" /></svg>`,
                error: `<svg class="h-5 w-5 mr-3 text-red-500" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd" /></svg>`,
            };
            const div = document.createElement('div');
            div.id = statusId;
            div.className = 'status-update flex items-center p-3 bg-gray-100 rounded-lg';
            div.innerHTML = `${icon[state]}<p class="text-gray-700">${text}</p>`;
            statusContainer.appendChild(div);
            setTimeout(() => div.classList.add('active'), 10);
            return statusId;
        }

        function markStatusDone(statusId) {
            if (!statusId) return;
            
            const statusElement = document.getElementById(statusId);
            if (statusElement) {
                statusElement.innerHTML = statusElement.innerHTML.replace(/<svg.*?<\/svg>/, 
                    `<svg class="h-5 w-5 mr-3 text-green-500" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" /></svg>`
                );
            }
        }
        
        // --- åˆ†æä»»å‹™å®šç¾© ---
        async function analyzeForumSentiment(context, apiKey) {
            const prompt = `
                ä½ æ˜¯ä¸€ä½å°ˆç²¾å°ç£å¸‚å ´çš„è³‡æ·±å¸‚å ´åˆ†æå¸«ã€‚è«‹ä½ æ ¹æ“šä»¥ä¸‹å“ç‰Œæƒ…å¢ƒï¼Œåœ¨å°ç£ä¸»æµè«–å£‡ Dcard å’Œ PTT ä¸Šé€²è¡Œè¼¿æƒ…åˆ†æã€‚

                **å“ç‰Œæƒ…å¢ƒ:**
                - **ç›®æ¨™å“ç‰Œ:** ${context.target}
                - **ç«¶çˆ­å“ç‰Œ:** ${context.competitor}
                - **æ‰€å±¬ç”¢æ¥­:** ${context.industry}
                - **å•†æ¥­æ¨¡å¼:** ${context.businessModel}
                - **ä¸»è¦éŠ·å”®é€šè·¯:** ${context.salesChannels}
                - **æ ¸å¿ƒç›®æ¨™äººç¾¤:** ${context.targetAudience}

                ä½ çš„ä»»å‹™æ˜¯ç¸½çµæ¯”è¼ƒçš„çµæœï¼Œä¸¦ä»¥ä¸€å€‹ JSON ç‰©ä»¶çš„æ ¼å¼å›å‚³ã€‚JSON ç‰©ä»¶å¿…é ˆåŒ…å«ä»¥ä¸‹å¹¾å€‹ key: 
                "target_profile", "target_pros", "target_cons", "competitor_pros", "competitor_cons", "market_opportunity"ã€‚

                - **target_profile:** åœ¨è«–å£‡ä¸­ï¼Œæœ€æ¥è¿‘ã€Œ${context.targetAudience}ã€é€™å€‹è¼ªå»“çš„è¨è«–è€…æ˜¯èª°ï¼Ÿä»–å€‘æœ‰ä»€éº¼ç‰¹å¾µï¼Ÿ
                - **target_pros:** é€™äº›ç›®æ¨™äººç¾¤è®šè³ç›®æ¨™å“ç‰Œçš„å„ªé»æ˜¯ä»€éº¼ï¼Ÿ (è‡³å°‘ 2 é»)ã€‚
                - **target_cons:** é€™äº›ç›®æ¨™äººç¾¤æŠ±æ€¨ç›®æ¨™å“ç‰Œçš„ç¼ºé»æ˜¯ä»€éº¼ï¼Ÿ (è‡³å°‘ 2 é»)ã€‚
                - **competitor_pros:** ç«¶çˆ­å“ç‰Œå¸å¼•é€™äº›ç›®æ¨™äººç¾¤çš„å„ªé»ã€‚
                - **competitor_cons:** ç«¶çˆ­å“ç‰Œè®“é€™äº›ç›®æ¨™äººç¾¤å»æ­¥çš„ç¼ºé»ã€‚
                - **market_opportunity:** æ ¹æ“šä»¥ä¸Šåˆ†æï¼Œæ‰¾å‡ºä¸€å€‹èƒ½ç²¾æº–æ‰“å‹•ã€Œ${context.targetAudience}ã€çš„å¸‚å ´æºé€šæ©Ÿæœƒé»ã€‚

                è«‹ç¢ºä¿å›å‚³çš„å…§å®¹æ˜¯ç´”ç²¹çš„ JSON æ ¼å¼ï¼Œæ²’æœ‰ä»»ä½•é¡å¤–çš„æ–‡å­—æˆ–è¨»è§£ã€‚
            `;
            return await callGeminiAPI(prompt, apiKey, true);
        }

        async function analyzeSeoStrategy(context, apiKey) {
            const prompt = `
                ä½ æ˜¯ä¸€ä½é ‚å°–çš„ SEO ç­–ç•¥é¡§å•ï¼Œç‰¹åˆ¥ç†Ÿæ‚‰å°ç£çš„ google.com.tw æœå°‹å¼•æ“ç”Ÿæ…‹ã€‚
                è«‹æ¨¡æ“¬ã€Œ${context.targetAudience}ã€é€™å€‹ç›®æ¨™äººç¾¤ï¼Œåœ¨æœå°‹èˆ‡ã€Œ${context.target}ã€ç›¸é—œçš„é—œéµå­—æ™‚ï¼Œä»–å€‘æœƒçœ‹åˆ°ä»€éº¼æ¨£çš„æœå°‹çµæœé é¢ (SERP)ã€‚

                **å“ç‰Œæƒ…å¢ƒ:**
                - **ç›®æ¨™å“ç‰Œ:** ${context.target}
                - **å•†æ¥­æ¨¡å¼:** ${context.businessModel}
                - **æ ¸å¿ƒç›®æ¨™äººç¾¤:** ${context.targetAudience}

                ä½ çš„ä»»å‹™æ˜¯ç¸½çµä½ çš„ç™¼ç¾ï¼Œä¸¦ä»¥ä¸€å€‹ JSON ç‰©ä»¶çš„æ ¼å¼å›å‚³ã€‚JSON ç‰©ä»¶å¿…é ˆåŒ…å«ä»¥ä¸‹å¹¾å€‹ key: 
                "main_competitors_in_serp", "dominant_content_format", "user_intent", "content_gap_opportunity"ã€‚

                - **main_competitors_in_serp:** é™¤äº†ã€Œ${context.competitor}ã€ä¹‹å¤–ï¼Œåœ¨è‡ªç„¶æœå°‹çµæœä¸­é‚„å¸¸å‡ºç¾å“ªäº›ç«¶çˆ­è€…ï¼Ÿ
                - **dominant_content_format:** æ’åé å‰çš„å…§å®¹ä¸»è¦æ˜¯é•·ç¯‡æ–‡ç« ã€ç”¢å“æ¯”è¼ƒé ã€æ–°èç¨¿ï¼Œé‚„æ˜¯ YouTube å½±ç‰‡ï¼Ÿ
                - **user_intent:** ã€Œ${context.targetAudience}ã€åœ¨æœå°‹æ™‚ï¼Œå…¶ä¸»è¦çš„ã€Œæœå°‹æ„åœ–ã€æ˜¯ä»€éº¼ï¼Ÿè«‹æ ¹æ“š ${context.businessModel} çš„ç‰¹æ€§ä¾†åˆ†æã€‚
                - **content_gap_opportunity:** æ ¹æ“š Google çš„ã€Œå…¶ä»–äººä¹Ÿå•äº†ã€æˆ–ã€Œç›¸é—œæœå°‹ã€ï¼Œæ‰¾å‡ºä¸€å€‹èƒ½è§£æ±ºã€Œ${context.targetAudience}ã€ç—›é»ï¼Œä½†å¸‚å ´ä¸Šé‚„æ²’æœ‰å„ªè³ªå…§å®¹å›ç­”çš„å•é¡Œï¼Œä½œç‚ºå…§å®¹ç­–ç•¥åˆ‡å…¥é»ã€‚

                è«‹ç¢ºä¿å›å‚³çš„å…§å®¹æ˜¯ç´”ç²¹çš„ JSON æ ¼å¼ï¼Œæ²’æœ‰ä»»ä½•é¡å¤–çš„æ–‡å­—æˆ–è¨»è§£ã€‚
            `;
            return await callGeminiAPI(prompt, apiKey, true);
        }

        async function estimateKpiAndBudget(context, opportunity, apiKey) {
            if (!context.budget || context.budget <= 0) {
                 return { budget_allocation: [], kpi_estimations: [], rationale: "æœªæä¾›é ç®—ï¼Œç„¡æ³•é€²è¡Œä¼°ç®—ã€‚" };
            }
            const prompt = `
                ä½ æ˜¯ä¸€ä½ç¶“é©—è±å¯Œçš„æ•¸ä½åª’é«”è¦åŠƒå¸« (Media Planner)ï¼Œæ“…é•·å°ç£å¸‚å ´çš„åª’é«”æŠ•è³‡èˆ‡æˆæ•ˆé ä¼°ã€‚
                æ ¹æ“šä»¥ä¸‹å®¢æˆ¶æƒ…å¢ƒèˆ‡ä½ å·²çŸ¥çš„å¸‚å ´æ©Ÿæœƒé»ï¼Œè¦åŠƒä¸€ä»½åˆæ­¥çš„é ç®—åˆ†é…èˆ‡ KPI é ä¼°ã€‚

                **å®¢æˆ¶æƒ…å¢ƒ:**
                - **ç”¢æ¥­:** ${context.industry}
                - **å•†æ¥­æ¨¡å¼:** ${context.businessModel}
                - **ç›®æ¨™äººç¾¤:** ${context.targetAudience}
                - **ç¸½é ç®— (TWD):** ${context.budget.toLocaleString()}
                - **æ ¸å¿ƒç­–ç•¥æ©Ÿæœƒé»:** ${opportunity}

                ä½ çš„ä»»å‹™æ˜¯ç”¢å‡ºä¸€å€‹ JSON ç‰©ä»¶ï¼ŒåŒ…å« "budget_allocation", "kpi_estimations", "rationale" ä¸‰å€‹ keyã€‚

                1.  **budget_allocation:** ä¸€å€‹é™£åˆ—ã€‚æ ¹æ“šã€Œæ ¸å¿ƒç­–ç•¥æ©Ÿæœƒé»ã€ï¼Œå»ºè­°å°‡é ç®—åˆ†é…åˆ° 2-3 å€‹æœ€ç›¸é—œçš„åª’é«”æ¸ é“ (ä¾‹å¦‚ï¼šä»˜è²»æœå°‹, ç¤¾ç¾¤å»£å‘Š, å…§å®¹è¡ŒéŠ·, å½±éŸ³å»£å‘Š)ï¼Œä¸¦çµ¦å‡ºæ¯å€‹æ¸ é“çš„**ç™¾åˆ†æ¯”**å’Œ**é‡‘é¡**ã€‚
                2.  **kpi_estimations:** ä¸€å€‹é™£åˆ—ã€‚ç‚ºæ¯å€‹å»ºè­°çš„æ¸ é“ï¼Œæä¾›**å¯é‡åŒ–çš„ KPI é ä¼°**ã€‚è«‹ä½¿ç”¨å°ç£å¸‚å ´çš„å…¸å‹ benchmarks (åŸºæº–)ã€‚
                    -   **å°æ–¼ B2C:** éœ€åŒ…å« "Impressions" (æ›å…‰), "CTR" (é»æ“Šç‡), "Clicks" (é»æ“Š), "CPC" (å–®æ¬¡é»æ“Šæˆæœ¬), "Est_Conversions" (é ä¼°è¨‚å–®æ•¸ï¼Œè«‹è‡ªè¨‚ä¸€å€‹åˆç†çš„è½‰æ›ç‡)ã€‚
                    -   **å°æ–¼ B2B:** éœ€åŒ…å« "Impressions", "CTR", "Clicks", "CPC", "Est_Leads" (é ä¼°æ½›åœ¨å®¢æˆ¶æ•¸ï¼Œè«‹è‡ªè¨‚ä¸€å€‹åˆç†çš„è½‰æ›ç‡)ã€‚
                3.  **rationale:** ä¸€æ®µç°¡çŸ­æ–‡å­—ï¼Œèªªæ˜ä½ é€™æ¨£è¦åŠƒé ç®—å„ªå…ˆç´šçš„ç†ç”±ã€‚

                è«‹ç¢ºä¿å›å‚³çš„å…§å®¹æ˜¯ç´”ç²¹çš„ JSON æ ¼å¼ã€‚
            `;
            return await callGeminiAPI(prompt, apiKey, true);
        }

        // è·¨åœ‹å¸‚å ´ç­–ç•¥åˆ†æ
        async function analyzeInternationalMarketStrategy(context, apiKey) {
            const prompt = `
                ä½ æ˜¯ä¸€ä½è³‡æ·±çš„åœ‹éš›å¸‚å ´ç­–ç•¥é¡§å•ï¼Œå°ˆç²¾æ–¼è·¨åœ‹å¸‚å ´é€²å…¥ç­–ç•¥å’Œæœ¬åœ°åŒ–ç­–ç•¥ã€‚
                è«‹æ ¹æ“šä»¥ä¸‹å“ç‰Œæƒ…å¢ƒï¼Œåˆ†æè·¨åœ‹å¸‚å ´ç­–ç•¥å’Œæºé€šç­–ç•¥ã€‚

                **å“ç‰Œæƒ…å¢ƒ:**
                - **ç›®æ¨™å“ç‰Œ:** ${context.target}
                - **ç«¶çˆ­å“ç‰Œ:** ${context.competitor}
                - **ç”¢æ¥­:** ${context.industry}
                - **å•†æ¥­æ¨¡å¼:** ${context.businessModel}
                - **ç›®æ¨™äººç¾¤:** ${context.targetAudience}
                - **ç›®æ¨™å¸‚å ´:** ${context.targetMarkets}
                - **ä¸»è¦å¸‚å ´:** ${context.primaryMarket}
                - **æ¬¡è¦å¸‚å ´:** ${context.secondaryMarkets}
                - **å¸‚å ´é€²å…¥ç­–ç•¥:** ${context.marketEntryStrategy}
                - **æœ¬åœ°åŒ–ç¨‹åº¦:** ${context.localizationLevel}
                - **æ–‡åŒ–æ•æ„Ÿåº¦:** ${context.culturalSensitivity}
                - **æºé€šç­–ç•¥é¡å‹:** ${context.communicationStrategy}
                - **èªè¨€ç­–ç•¥:** ${context.languageStrategy}
                - **èªèª¿ç­–ç•¥:** ${context.toneStrategy}
                - **é€šè·¯ç­–ç•¥:** ${context.channelStrategy}
                - **æ™‚æ©Ÿç­–ç•¥:** ${context.timingStrategy}
                - **å±æ©Ÿç®¡ç†ç­–ç•¥:** ${context.crisisManagement}
                - **æ–‡åŒ–è€ƒé‡é‡é»:** ${context.culturalConsiderations}
                - **æ³•è¦è¦æ±‚:** ${context.regulatoryRequirements}

                ä½ çš„ä»»å‹™æ˜¯ç”¢å‡ºä¸€å€‹ JSON ç‰©ä»¶ï¼ŒåŒ…å«ä»¥ä¸‹ keyï¼š

                1. **market_analysis:** åŒ…å« "market_opportunities", "market_challenges", "competitive_landscape", "entry_timing"
                2. **localization_strategy:** åŒ…å« "product_adaptation", "communication_adaptation", "cultural_considerations", "regulatory_compliance"
                3. **communication_framework:** åŒ…å« "global_message", "local_messages", "channel_mix", "timing_strategy"
                4. **risk_management:** åŒ…å« "cultural_risks", "regulatory_risks", "competitive_risks", "mitigation_strategies"
                5. **success_metrics:** åŒ…å« "market_penetration", "brand_awareness", "cultural_acceptance", "regulatory_compliance"

                è«‹ç¢ºä¿å›å‚³çš„å…§å®¹æ˜¯ç´”ç²¹çš„ JSON æ ¼å¼ï¼Œæ²’æœ‰ä»»ä½•é¡å¤–çš„æ–‡å­—æˆ–è¨»è§£ã€‚
            `;
            return await callGeminiAPI(prompt, apiKey, true);
        }

        // è·¨åœ‹æ–‡åŒ–é©æ‡‰æ€§åˆ†æ
        async function analyzeCulturalAdaptation(context, apiKey) {
            const prompt = `
                ä½ æ˜¯ä¸€ä½è·¨æ–‡åŒ–æºé€šå°ˆå®¶ï¼Œå°ˆç²¾æ–¼äºæ´²å¸‚å ´çš„æ–‡åŒ–é©æ‡‰ç­–ç•¥ã€‚
                è«‹æ ¹æ“šä»¥ä¸‹æƒ…å¢ƒï¼Œåˆ†æåœ¨ä¸åŒç›®æ¨™å¸‚å ´çš„æ–‡åŒ–é©æ‡‰ç­–ç•¥ã€‚

                **åˆ†ææƒ…å¢ƒ:**
                - **ç›®æ¨™å“ç‰Œ:** ${context.target}
                - **ä¸»è¦å¸‚å ´:** ${context.primaryMarket}
                - **æ¬¡è¦å¸‚å ´:** ${context.secondaryMarkets}
                - **æ–‡åŒ–æ•æ„Ÿåº¦:** ${context.culturalSensitivity}
                - **æ–‡åŒ–è€ƒé‡é‡é»:** ${context.culturalConsiderations}

                ä½ çš„ä»»å‹™æ˜¯ç”¢å‡ºä¸€å€‹ JSON ç‰©ä»¶ï¼ŒåŒ…å«ä»¥ä¸‹ keyï¼š

                1. **cultural_insights:** åŒ…å« "primary_market_culture", "secondary_markets_culture", "cultural_differences", "shared_values"
                2. **adaptation_strategies:** åŒ…å« "visual_adaptation", "message_adaptation", "tone_adaptation", "timing_adaptation"
                3. **cultural_taboos:** åŒ…å« "visual_taboos", "language_taboos", "concept_taboos", "timing_taboos"
                4. **localization_priorities:** åŒ…å« "high_priority", "medium_priority", "low_priority", "not_required"
                5. **success_indicators:** åŒ…å« "cultural_acceptance", "local_relevance", "brand_authenticity", "market_resonance"

                è«‹ç¢ºä¿å›å‚³çš„å…§å®¹æ˜¯ç´”ç²¹çš„ JSON æ ¼å¼ï¼Œæ²’æœ‰ä»»ä½•é¡å¤–çš„æ–‡å­—æˆ–è¨»è§£ã€‚
            `;
            return await callGeminiAPI(prompt, apiKey, true);
        }

        // B2B å°ˆæ¥­å¸‚å ´åˆ†æ
        async function analyzeB2BMarketStrategy(context, apiKey) {
            const prompt = `
                ä½ æ˜¯ä¸€ä½è³‡æ·±çš„ B2B å¸‚å ´ç­–ç•¥é¡§å•ï¼Œå°ˆç²¾æ–¼ä¼æ¥­ç´šå¸‚å ´åˆ†æå’ŒéŠ·å”®ç­–ç•¥ã€‚
                è«‹æ ¹æ“šä»¥ä¸‹ B2B æƒ…å¢ƒï¼Œé€²è¡Œå°ˆæ¥­çš„å¸‚å ´åˆ†æã€‚

                **B2B æƒ…å¢ƒåˆ†æ:**
                - **ç›®æ¨™å“ç‰Œ:** ${context.target}
                - **ç«¶çˆ­å“ç‰Œ:** ${context.competitor}
                - **ç”¢æ¥­:** ${context.industry}
                - **å•†æ¥­æ¨¡å¼:** ${context.businessModel}
                - **ç›®æ¨™ä¼æ¥­è¦æ¨¡:** ${context.targetCompanySize}
                - **ä¸»è¦æ±ºç­–è€…è§’è‰²:** ${context.decisionMakerRole}
                - **æ¡è³¼é€±æœŸ:** ${context.purchaseCycle}
                - **é ç®—ç¯„åœ:** ${context.budgetRange}
                - **ä¸»è¦ç—›é»:** ${context.painPoints}
                - **æˆåŠŸæŒ‡æ¨™:** ${context.successMetrics}
                - **ç«¶çˆ­å„ªå‹¢:** ${context.competitiveAdvantage}
                - **ç”¢æ¥­æŒ‘æˆ°:** ${context.industryChallenges}

                ä½ çš„ä»»å‹™æ˜¯ç”¢å‡ºä¸€å€‹ JSON ç‰©ä»¶ï¼ŒåŒ…å«ä»¥ä¸‹ keyï¼š

                1. **buyer_persona_analysis:** åŒ…å« "decision_maker_profile", "influencer_network", "pain_points_analysis", "success_criteria"
                2. **sales_funnel_strategy:** åŒ…å« "awareness_stage", "consideration_stage", "decision_stage", "conversion_tactics"
                3. **competitive_positioning:** åŒ…å« "differentiation_strategy", "value_proposition", "competitive_advantages", "market_positioning"
                4. **content_marketing_strategy:** åŒ…å« "thought_leadership", "educational_content", "case_studies", "technical_documentation"
                5. **lead_generation_tactics:** åŒ…å« "inbound_strategies", "outbound_strategies", "partnership_opportunities", "referral_programs"
                6. **account_based_marketing:** åŒ…å« "target_account_selection", "personalization_strategy", "multi_touch_campaigns", "success_metrics"

                è«‹ç¢ºä¿å›å‚³çš„å…§å®¹æ˜¯ç´”ç²¹çš„ JSON æ ¼å¼ï¼Œæ²’æœ‰ä»»ä½•é¡å¤–çš„æ–‡å­—æˆ–è¨»è§£ã€‚
            `;
            return await callGeminiAPI(prompt, apiKey, true);
        }

        // B2B ç•¶åœ°å¸‚å ´æ·±åº¦åˆ†æ
        async function analyzeLocalB2BMarket(context, apiKey) {
            const prompt = `
                ä½ æ˜¯ä¸€ä½å°ˆç²¾å°ç£ B2B å¸‚å ´çš„è³‡æ·±åˆ†æå¸«ï¼Œå°å°ç£ä¼æ¥­ç”Ÿæ…‹ã€æ¡è³¼ç¿’æ…£ã€æ±ºç­–æµç¨‹æœ‰æ·±å…¥ç†è§£ã€‚
                è«‹æ ¹æ“šä»¥ä¸‹æƒ…å¢ƒï¼Œåˆ†æå°ç£ B2B å¸‚å ´çš„ç‰¹æ®Šæ€§å’Œæ©Ÿæœƒã€‚

                **å°ç£ B2B å¸‚å ´åˆ†ææƒ…å¢ƒ:**
                - **ç›®æ¨™å“ç‰Œ:** ${context.target}
                - **ç”¢æ¥­:** ${context.industry}
                - **ç›®æ¨™ä¼æ¥­è¦æ¨¡:** ${context.targetCompanySize}
                - **ä¸»è¦æ±ºç­–è€…è§’è‰²:** ${context.decisionMakerRole}
                - **æ¡è³¼é€±æœŸ:** ${context.purchaseCycle}
                - **é ç®—ç¯„åœ:** ${context.budgetRange}
                - **ä¸»è¦ç—›é»:** ${context.painPoints}
                - **ç«¶çˆ­å„ªå‹¢:** ${context.competitiveAdvantage}

                ä½ çš„ä»»å‹™æ˜¯ç”¢å‡ºä¸€å€‹ JSON ç‰©ä»¶ï¼ŒåŒ…å«ä»¥ä¸‹ keyï¼š

                1. **taiwan_b2b_landscape:** åŒ…å« "market_characteristics", "industry_clusters", "regional_distribution", "business_culture"
                2. **decision_making_process:** åŒ…å« "decision_hierarchy", "approval_process", "evaluation_criteria", "timeline_factors"
                3. **local_competition_analysis:** åŒ…å« "domestic_competitors", "international_players", "competitive_dynamics", "market_gaps"
                4. **relationship_building:** åŒ…å« "guanxi_importance", "trust_building", "long_term_relationships", "local_partnerships"
                5. **regulatory_environment:** åŒ…å« "compliance_requirements", "industry_regulations", "tax_considerations", "legal_framework"
                6. **success_factors:** åŒ…å« "local_adaptation", "service_quality", "price_positioning", "after_sales_support"

                è«‹ç¢ºä¿å›å‚³çš„å…§å®¹æ˜¯ç´”ç²¹çš„ JSON æ ¼å¼ï¼Œæ²’æœ‰ä»»ä½•é¡å¤–çš„æ–‡å­—æˆ–è¨»è§£ã€‚
            `;
            return await callGeminiAPI(prompt, apiKey, true);
        }

        // ç•¶åœ°å¸‚å ´å•†æ¥­æ¨¡å¼åˆ†æ
        async function analyzeLocalBusinessModel(context, apiKey) {
            const prompt = `
                ä½ æ˜¯ä¸€ä½å°ˆç²¾äºæ´²å¸‚å ´çš„å•†æ¥­æ¨¡å¼åˆ†æå¸«ï¼Œå°ä¸åŒåœ°å€çš„å•†æ¥­ç”Ÿæ…‹ã€æ¶ˆè²»ç¿’æ…£ã€ä¼æ¥­æ–‡åŒ–æœ‰æ·±å…¥ç†è§£ã€‚
                è«‹æ ¹æ“šä»¥ä¸‹æƒ…å¢ƒï¼Œåˆ†æç›®æ¨™å¸‚å ´çš„å•†æ¥­æ¨¡å¼ç‰¹é»å’Œæ©Ÿæœƒã€‚

                **ç•¶åœ°å¸‚å ´å•†æ¥­æ¨¡å¼åˆ†ææƒ…å¢ƒ:**
                - **ç›®æ¨™å“ç‰Œ:** ${context.target}
                - **ç”¢æ¥­:** ${context.industry}
                - **å•†æ¥­æ¨¡å¼:** ${context.businessModel}
                - **ä¸»è¦å¸‚å ´:** ${context.primaryMarket}
                - **æ¬¡è¦å¸‚å ´:** ${context.secondaryMarkets}
                - **ç›®æ¨™å—çœ¾:** ${context.targetAudience}
                - **éŠ·å”®é€šè·¯:** ${context.salesChannels}

                ä½ çš„ä»»å‹™æ˜¯ç”¢å‡ºä¸€å€‹ JSON ç‰©ä»¶ï¼ŒåŒ…å«ä»¥ä¸‹ keyï¼š

                1. **local_business_ecosystem:** åŒ…å« "market_maturity", "competitive_landscape", "regulatory_environment", "business_culture"
                2. **consumer_behavior_analysis:** åŒ…å« "purchase_habits", "decision_factors", "brand_preferences", "price_sensitivity"
                3. **business_model_adaptation:** åŒ…å« "local_opportunities", "challenges", "adaptation_strategies", "success_factors"
                4. **market_segmentation:** åŒ…å« "demographic_segments", "psychographic_profiles", "behavioral_patterns", "value_propositions"
                5. **competitive_advantages:** åŒ…å« "local_differentiation", "cultural_advantages", "operational_efficiencies", "innovation_potential"
                6. **growth_opportunities:** åŒ…å« "market_gaps", "emerging_trends", "expansion_potential", "partnership_opportunities"

                è«‹ç¢ºä¿å›å‚³çš„å…§å®¹æ˜¯ç´”ç²¹çš„ JSON æ ¼å¼ï¼Œæ²’æœ‰ä»»ä½•é¡å¤–çš„æ–‡å­—æˆ–è¨»è§£ã€‚
            `;
            return await callGeminiAPI(prompt, apiKey, true);
        }

        // ç•¶åœ°åª’é«”åå¥½åˆ†æ
        async function analyzeLocalMediaPreferences(context, apiKey) {
            const prompt = `
                ä½ æ˜¯ä¸€ä½å°ˆç²¾äºæ´²åª’é«”å¸‚å ´çš„è³‡æ·±åˆ†æå¸«ï¼Œå°ä¸åŒåœ°å€çš„åª’é«”ç”Ÿæ…‹ã€ç”¨æˆ¶ç¿’æ…£ã€å»£å‘Šæ•ˆæœæœ‰æ·±å…¥ç†è§£ã€‚
                è«‹æ ¹æ“šä»¥ä¸‹æƒ…å¢ƒï¼Œåˆ†æç›®æ¨™å¸‚å ´çš„åª’é«”åå¥½å’Œå»£å‘Šç­–ç•¥ã€‚

                **ç•¶åœ°åª’é«”åå¥½åˆ†ææƒ…å¢ƒ:**
                - **ç›®æ¨™å“ç‰Œ:** ${context.target}
                - **ç”¢æ¥­:** ${context.industry}
                - **å•†æ¥­æ¨¡å¼:** ${context.businessModel}
                - **ä¸»è¦å¸‚å ´:** ${context.primaryMarket}
                - **æ¬¡è¦å¸‚å ´:** ${context.secondaryMarkets}
                - **ç›®æ¨™å—çœ¾:** ${context.targetAudience}
                - **é ç®—:** ${context.budget}

                ä½ çš„ä»»å‹™æ˜¯ç”¢å‡ºä¸€å€‹ JSON ç‰©ä»¶ï¼ŒåŒ…å«ä»¥ä¸‹ keyï¼š

                1. **media_landscape_analysis:** åŒ…å« "traditional_media", "digital_media", "social_media", "emerging_platforms"
                2. **audience_media_habits:** åŒ…å« "media_consumption_patterns", "platform_preferences", "content_preferences", "engagement_metrics"
                3. **advertising_effectiveness:** åŒ…å« "cost_performance", "reach_efficiency", "engagement_rates", "conversion_metrics"
                4. **local_media_strategy:** åŒ…å« "primary_channels", "secondary_channels", "content_strategy", "timing_strategy"
                5. **cultural_media_factors:** åŒ…å« "cultural_sensitivity", "local_content_preferences", "communication_style", "taboo_topics"
                6. **competitive_media_analysis:** åŒ…å« "competitor_channels", "advertising_trends", "market_gaps", "opportunity_areas"

                è«‹ç¢ºä¿å›å‚³çš„å…§å®¹æ˜¯ç´”ç²¹çš„ JSON æ ¼å¼ï¼Œæ²’æœ‰ä»»ä½•é¡å¤–çš„æ–‡å­—æˆ–è¨»è§£ã€‚
            `;
            return await callGeminiAPI(prompt, apiKey, true);
        }

        // ç•¶åœ°äººç¾¤æ·±åº¦åˆ†æ
        async function analyzeLocalAudienceInsights(context, apiKey) {
            const prompt = `
                ä½ æ˜¯ä¸€ä½å°ˆç²¾äºæ´²æ¶ˆè²»è€…è¡Œç‚ºçš„è³‡æ·±åˆ†æå¸«ï¼Œå°ä¸åŒåœ°å€çš„äººç¾¤ç‰¹å¾µã€æ¶ˆè²»å¿ƒç†ã€ç”Ÿæ´»æ–¹å¼æœ‰æ·±å…¥ç†è§£ã€‚
                è«‹æ ¹æ“šä»¥ä¸‹æƒ…å¢ƒï¼Œåˆ†æç›®æ¨™å¸‚å ´çš„äººç¾¤ç‰¹é»å’Œæ´å¯Ÿã€‚

                **ç•¶åœ°äººç¾¤æ·±åº¦åˆ†ææƒ…å¢ƒ:**
                - **ç›®æ¨™å“ç‰Œ:** ${context.target}
                - **ç”¢æ¥­:** ${context.industry}
                - **å•†æ¥­æ¨¡å¼:** ${context.businessModel}
                - **ä¸»è¦å¸‚å ´:** ${context.primaryMarket}
                - **æ¬¡è¦å¸‚å ´:** ${context.secondaryMarkets}
                - **ç›®æ¨™å—çœ¾:** ${context.targetAudience}
                - **é ç®—ç¯„åœ:** ${context.budgetRange}

                ä½ çš„ä»»å‹™æ˜¯ç”¢å‡ºä¸€å€‹ JSON ç‰©ä»¶ï¼ŒåŒ…å«ä»¥ä¸‹ keyï¼š

                1. **demographic_analysis:** åŒ…å« "age_distribution", "income_levels", "education_background", "occupation_patterns"
                2. **psychographic_profiles:** åŒ…å« "lifestyle_preferences", "values_beliefs", "personality_traits", "aspirations"
                3. **behavioral_insights:** åŒ…å« "purchase_behavior", "brand_loyalty", "decision_process", "influence_factors"
                4. **cultural_influences:** åŒ…å« "cultural_values", "social_norms", "family_structure", "community_impact"
                5. **digital_adoption:** åŒ…å« "technology_usage", "online_behavior", "social_media_habits", "e_commerce_preferences"
                6. **communication_preferences:** åŒ…å« "language_preferences", "communication_style", "content_format", "channel_preferences"

                è«‹ç¢ºä¿å›å‚³çš„å…§å®¹æ˜¯ç´”ç²¹çš„ JSON æ ¼å¼ï¼Œæ²’æœ‰ä»»ä½•é¡å¤–çš„æ–‡å­—æˆ–è¨»è§£ã€‚
            `;
            return await callGeminiAPI(prompt, apiKey, true);
        }

        // --- Module 3: ææ¡ˆç”Ÿæˆå¼•æ“ ('åˆæˆå¼•æ“') ---
        async function synthesizeFinalReport(context, forumAnalysis, seoAnalysis, kpiEstimation, internationalData, culturalData, b2bData, localB2bData, localBusinessData, localMediaData, localAudienceData, apiKey) {
             const prompt = `
                ä½ æ˜¯ä¸€ä½é¦–å¸­åª’é«”ç­–ç•¥ç¸½ç›£ï¼Œä½ çš„ä»»å‹™æ˜¯å°‡ä¸‹å±¬åˆ†æå¸«æäº¤çš„æ‰€æœ‰ JSON è³‡æ–™ï¼Œæ•´åˆæˆä¸€ä»½çµ¦å®¢æˆ¶çœ‹çš„ã€å°ˆæ¥­ä¸”æœ‰èªªæœåŠ›çš„ã€Œå¸‚å ´æ©Ÿæœƒèˆ‡åˆæ­¥ç­–ç•¥å»ºè­°ã€å ±å‘Šã€‚å ±å‘Šéœ€ä»¥ HTML æ ¼å¼å‘ˆç¾ã€‚

                **å®¢æˆ¶è³‡æ–™:**
                - **ç›®æ¨™å“ç‰Œ:** ${context.target}
                - **æ ¸å¿ƒç›®æ¨™äººç¾¤:** ${context.targetAudience}
                - **ç¸½é ç®— (TWD):** ${context.budget > 0 ? context.budget.toLocaleString() : 'æœªæä¾›'}
                - **å•†æ¥­æ¨¡å¼:** ${context.businessModel}
                - **ç›®æ¨™å¸‚å ´:** ${context.targetMarkets}
                - **ä¸»è¦å¸‚å ´:** ${context.primaryMarket}
                - **æ¬¡è¦å¸‚å ´:** ${context.secondaryMarkets}
                ${context.businessModel === 'B2B' ? `
                - **ç›®æ¨™ä¼æ¥­è¦æ¨¡:** ${context.targetCompanySize}
                - **ä¸»è¦æ±ºç­–è€…è§’è‰²:** ${context.decisionMakerRole}
                - **æ¡è³¼é€±æœŸ:** ${context.purchaseCycle}
                - **é ç®—ç¯„åœ:** ${context.budgetRange}
                - **ä¸»è¦ç—›é»:** ${context.painPoints}
                - **æˆåŠŸæŒ‡æ¨™:** ${context.successMetrics}
                ` : ''}

                **åˆ†æå¸«æäº¤çš„è³‡æ–™:**
                1.  **è«–å£‡è¼¿æƒ…åˆ†æ:** ${JSON.stringify(forumAnalysis, null, 2)}
                2.  **SEO èˆ‡å…§å®¹ç­–ç•¥åˆ†æ:** ${JSON.stringify(seoAnalysis, null, 2)}
                3.  **é ç®—è¦åŠƒèˆ‡ KPI ä¼°ç®—:** ${JSON.stringify(kpiEstimation, null, 2)}
                4.  **è·¨åœ‹å¸‚å ´ç­–ç•¥åˆ†æ:** ${JSON.stringify(internationalData, null, 2)}
                5.  **è·¨åœ‹æ–‡åŒ–é©æ‡‰æ€§åˆ†æ:** ${JSON.stringify(culturalData, null, 2)}
                6.  **ç•¶åœ°å¸‚å ´å•†æ¥­æ¨¡å¼åˆ†æ:** ${JSON.stringify(localBusinessData, null, 2)}
                7.  **ç•¶åœ°åª’é«”åå¥½åˆ†æ:** ${JSON.stringify(localMediaData, null, 2)}
                8.  **ç•¶åœ°äººç¾¤æ·±åº¦åˆ†æ:** ${JSON.stringify(localAudienceData, null, 2)}
                ${context.businessModel === 'B2B' ? `
                9.  **B2B å°ˆæ¥­å¸‚å ´åˆ†æ:** ${JSON.stringify(b2bData, null, 2)}
                ${context.primaryMarket === 'taiwan' ? `
                10. **å°ç£ B2B å¸‚å ´æ·±åº¦åˆ†æ:** ${JSON.stringify(localB2bData, null, 2)}
                ` : ''}
                ` : ''}

                è«‹ç”¢å‡ºä¸€ä»½çµæ§‹åŒ–çš„ HTML å ±å‘Šï¼ŒåŒ…å«ä»¥ä¸‹ç« ç¯€ï¼š

                ## 1. åŸ·è¡Œæ‘˜è¦
                - å¸‚å ´æ©Ÿæœƒæ¦‚è¿°
                - æ ¸å¿ƒç­–ç•¥å»ºè­°
                - é æœŸæˆæ•ˆ

                ## 2. ç•¶åœ°å¸‚å ´åˆ†æ
                - ç›®æ¨™å¸‚å ´æ¦‚æ³
                - ç•¶åœ°å•†æ¥­ç”Ÿæ…‹åˆ†æ
                - ç«¶çˆ­ç’°å¢ƒåˆ†æ
                - ç•¶åœ°äººç¾¤æ´å¯Ÿ
                ${context.businessModel === 'B2B' ? `
                - B2B è²·å®¶è§’è‰²åˆ†æ
                - æ±ºç­–æµç¨‹åˆ†æ
                - æ¡è³¼è¡Œç‚ºæ´å¯Ÿ
                ` : ''}

                ## 3. ç•¶åœ°åª’é«”ç­–ç•¥
                - åª’é«”ç”Ÿæ…‹åˆ†æ
                - ç•¶åœ°åª’é«”åå¥½
                - å»£å‘Šæ•ˆæœè©•ä¼°
                - åª’é«”é¸æ“‡å»ºè­°
                - å…§å®¹ç­–ç•¥å»ºè­°

                ## 4. å•†æ¥­æ¨¡å¼é©æ‡‰ç­–ç•¥
                - ç•¶åœ°å•†æ¥­æ¨¡å¼åˆ†æ
                - æ¶ˆè²»è€…è¡Œç‚ºæ´å¯Ÿ
                - å¸‚å ´ç´°åˆ†ç­–ç•¥
                - ç«¶çˆ­å„ªå‹¢åˆ†æ
                - æˆé•·æ©Ÿæœƒè­˜åˆ¥

                ## 5. è·¨åœ‹ç­–ç•¥
                - å¸‚å ´é€²å…¥ç­–ç•¥
                - æœ¬åœ°åŒ–ç­–ç•¥
                - æ–‡åŒ–é©æ‡‰ç­–ç•¥
                - æºé€šç­–ç•¥

                ## 6. é ç®—åˆ†é…èˆ‡ KPI
                - é ç®—åˆ†é…å»ºè­°
                - KPI è¨­å®š
                - æˆæ•ˆè¿½è¹¤æ–¹æ³•

                ## 7. åŸ·è¡Œæ™‚ç¨‹
                - çŸ­æœŸè¡Œå‹•è¨ˆç•« (1-3å€‹æœˆ)
                - ä¸­æœŸç™¼å±•è¨ˆç•« (3-6å€‹æœˆ)
                - é•·æœŸç­–ç•¥è¦åŠƒ (6-12å€‹æœˆ)

                ## 8. é¢¨éšªç®¡ç†
                - æ½›åœ¨é¢¨éšªè­˜åˆ¥
                - é¢¨éšªç·©è§£ç­–ç•¥
                - å±æ©Ÿç®¡ç†è¨ˆç•«

                è«‹ä½¿ç”¨å°ˆæ¥­çš„ HTML æ ¼å¼ï¼ŒåŒ…å«é©ç•¶çš„æ¨™é¡Œã€æ®µè½ã€åˆ—è¡¨å’Œå¼·èª¿å…ƒç´ ã€‚å ±å‘Šæ‡‰è©²å…·æœ‰èªªæœåŠ›ä¸”æ˜“æ–¼é–±è®€ã€‚
                ç‰¹åˆ¥æ³¨æ„æ•´åˆç•¶åœ°å¸‚å ´çš„å•†æ¥­æ¨¡å¼åˆ¤æ–·ã€äººç¾¤åˆ†æï¼Œä»¥åŠç•¶åœ°åª’é«”åå¥½è€ƒé‡ã€‚
            `;
            return await callGeminiAPI(prompt, apiKey, false);
        }

        // --- ä¸»åŸ·è¡Œæµç¨‹ ---
        async function handleGenerateClick() {
            try {
                // æª¢æŸ¥å¿…è¦å…ƒç´ æ˜¯å¦å­˜åœ¨
                if (!apiKeyInput || !projectIdInput || !targetBrandInput || 
                    !competitorBrandInput || !industryInput || !businessModelInput || 
                    !salesChannelsInput || !targetAudienceInput || !advertisingBudgetInput) {
                    throw new Error('æŸäº›å¿…è¦çš„ UI å…ƒç´ æœªæ‰¾åˆ°ï¼Œè«‹é‡æ–°æ•´ç†é é¢');
                }

                // å°ˆæ¡ˆ ID è®Šæˆå¯é¸çš„
                const projectId = projectIdInput.value?.trim() || '';
                if (projectId) {
                    // å¦‚æœæœ‰è¼¸å…¥å°ˆæ¡ˆIDï¼Œå„²å­˜åˆ°å…¨åŸŸè®Šæ•¸
                    currentProjectId = projectId;
                    console.log('ä½¿ç”¨å°ˆæ¡ˆID:', projectId);
                } else {
                    // å¦‚æœæ²’æœ‰å°ˆæ¡ˆIDï¼Œä½¿ç”¨æ™‚é–“æˆ³ä½œç‚ºè‡¨æ™‚ID
                    currentProjectId = `temp_${Date.now()}`;
                    console.log('ä½¿ç”¨è‡¨æ™‚ID:', currentProjectId);
                }
                
                const userApiKey = apiKeyInput.value?.trim() || '';
                if (!userApiKey) {
                    alert('è«‹åœ¨æœ€ä¸Šæ–¹è¼¸å…¥æ‚¨çš„ Google Gemini API é‡‘é‘°ã€‚');
                    return;
                }

                const analysisContext = {
                    target: targetBrandInput.value?.trim() || '',
                    competitor: competitorBrandInput.value?.trim() || '',
                    industry: industryInput.value || '',
                    businessModel: businessModelInput.value || '',
                    salesChannels: salesChannelsInput.value?.trim() || 'æœªæä¾›',
                    targetAudience: targetAudienceInput.value?.trim() || 'æœªæŒ‡å®š',
                    budget: parseInt(advertisingBudgetInput.value, 10) || 0,
                    projectId: currentProjectId, // åŠ å…¥ project ID åˆ°åˆ†æä¸Šä¸‹æ–‡
                    // è·¨åœ‹å¸‚å ´ç­–ç•¥åƒæ•¸
                    targetMarkets: targetMarketsInput.value || 'single',
                    primaryMarket: primaryMarketInput.value || 'taiwan',
                    secondaryMarkets: secondaryMarketsInput.value?.trim() || '',
                    marketEntryStrategy: marketEntryStrategyInput.value || 'organic',
                    localizationLevel: localizationLevelInput.value || 'medium',
                    culturalSensitivity: culturalSensitivityInput.value || 'medium',
                    // è·¨åœ‹æºé€šç­–ç•¥åƒæ•¸
                    communicationStrategy: communicationStrategyInput.value || 'global_local',
                    languageStrategy: languageStrategyInput.value || 'local_language',
                    toneStrategy: toneStrategyInput.value || 'professional',
                    channelStrategy: channelStrategyInput.value || 'digital_first',
                    timingStrategy: timingStrategyInput.value || 'phased',
                    crisisManagement: crisisManagementInput.value || 'centralized',
                    culturalConsiderations: culturalConsiderationsInput.value?.trim() || '',
                    regulatoryRequirements: regulatoryRequirementsInput.value?.trim() || '',
                    // B2B å°ˆæ¥­å¸‚å ´åˆ†æåƒæ•¸
                    targetCompanySize: targetCompanySizeInput.value || 'sme',
                    decisionMakerRole: decisionMakerRoleInput.value || 'ceo',
                    purchaseCycle: purchaseCycleInput.value || 'medium',
                    budgetRange: budgetRangeInput.value || 'medium',
                    painPoints: painPointsInput.value?.trim() || '',
                    successMetrics: successMetricsInput.value?.trim() || '',
                    competitiveAdvantage: competitiveAdvantageInput.value?.trim() || '',
                    industryChallenges: industryChallengesInput.value?.trim() || ''
                };

                if (!analysisContext.target || !analysisContext.competitor) {
                    alert('è«‹å‹™å¿…è¼¸å…¥ç›®æ¨™å“ç‰Œå’Œç«¶çˆ­å°æ‰‹ã€‚');
                    return;
                }

                if (!generateBtn || !statusContainer || !proposalOutput) {
                    throw new Error('UI å…ƒç´ æœªæ­£ç¢ºè¼‰å…¥ï¼Œè«‹é‡æ–°æ•´ç†é é¢');
                }

                generateBtn.disabled = true;
                generateBtn.innerHTML = `åˆ†æä¸­...`;
                statusContainer.innerHTML = '';
                proposalOutput.innerHTML = '';

                try {
                    const status1 = updateStatus(`åˆ†æ **${analysisContext.target}** åœ¨ç›®æ¨™äººç¾¤ä¸­çš„è«–å£‡è¼¿æƒ…...`);
                    const forumData = await analyzeForumSentiment(analysisContext, userApiKey);
                    markStatusDone(status1);

                    const status2 = updateStatus(`åˆ†æ **${analysisContext.target}** çš„ SEO èˆ‡å…§å®¹ç­–ç•¥...`);
                    const seoData = await analyzeSeoStrategy(analysisContext, userApiKey);
                    markStatusDone(status2);
                    
                    const opportunity = forumData.market_opportunity || seoData.content_gap_opportunity;
                    
                    const status3 = updateStatus(`é€²è¡Œé ç®—è¦åŠƒèˆ‡ KPI ä¼°ç®—...`);
                    const kpiData = await estimateKpiAndBudget(analysisContext, opportunity, userApiKey);
                    markStatusDone(status3);

                    // è·¨åœ‹ç­–ç•¥åˆ†æï¼ˆåƒ…åœ¨é¸æ“‡å¤šå¸‚å ´æ™‚åŸ·è¡Œï¼‰
                    let internationalData = null;
                    let culturalData = null;
                    
                    if (analysisContext.targetMarkets !== 'single') {
                        const status4 = updateStatus(`åˆ†æè·¨åœ‹å¸‚å ´ç­–ç•¥èˆ‡é€²å…¥ç­–ç•¥...`);
                        internationalData = await analyzeInternationalMarketStrategy(analysisContext, userApiKey);
                        markStatusDone(status4);

                        const status5 = updateStatus(`åˆ†æè·¨åœ‹æ–‡åŒ–é©æ‡‰ç­–ç•¥...`);
                        culturalData = await analyzeCulturalAdaptation(analysisContext, userApiKey);
                        markStatusDone(status5);
                    }

                    // B2B å°ˆæ¥­åˆ†æï¼ˆåƒ…åœ¨ B2B æ¨¡å¼ä¸‹åŸ·è¡Œï¼‰
                    let b2bData = null;
                    let localB2bData = null;
                    
                    if (analysisContext.businessModel === 'B2B') {
                        const status6 = updateStatus(`é€²è¡Œ B2B å°ˆæ¥­å¸‚å ´åˆ†æ...`);
                        b2bData = await analyzeB2BMarketStrategy(analysisContext, userApiKey);
                        markStatusDone(status6);

                        // ç•¶åœ° B2B å¸‚å ´åˆ†æï¼ˆåƒ…åœ¨å°ç£å¸‚å ´æ™‚åŸ·è¡Œï¼‰
                        if (analysisContext.primaryMarket === 'taiwan') {
                            const status7 = updateStatus(`åˆ†æå°ç£ B2B å¸‚å ´ç‰¹æ®Šæ€§...`);
                            localB2bData = await analyzeLocalB2BMarket(analysisContext, userApiKey);
                            markStatusDone(status7);
                        }
                    }

                    // ç•¶åœ°å¸‚å ´æ·±åº¦åˆ†æï¼ˆæ‰€æœ‰æ¨¡å¼éƒ½åŸ·è¡Œï¼‰
                    const status8 = updateStatus(`åˆ†æç•¶åœ°å¸‚å ´å•†æ¥­æ¨¡å¼...`);
                    const localBusinessData = await analyzeLocalBusinessModel(analysisContext, userApiKey);
                    markStatusDone(status8);

                    const status9 = updateStatus(`åˆ†æç•¶åœ°åª’é«”åå¥½...`);
                    const localMediaData = await analyzeLocalMediaPreferences(analysisContext, userApiKey);
                    markStatusDone(status9);

                    const status10 = updateStatus(`åˆ†æç•¶åœ°äººç¾¤æ´å¯Ÿ...`);
                    const localAudienceData = await analyzeLocalAudienceInsights(analysisContext, userApiKey);
                    markStatusDone(status10);

                    // ç”Ÿæˆæœ€çµ‚å ±å‘Š
                    const status11 = updateStatus(`æ•´åˆåˆ†æçµæœï¼Œç”Ÿæˆå°ˆæ¥­å ±å‘Š...`);
                    const finalReport = await synthesizeFinalReport(
                        analysisContext, 
                        forumData, 
                        seoData, 
                        kpiData, 
                        internationalData, 
                        culturalData, 
                        b2bData, 
                        localB2bData, 
                        localBusinessData,
                        localMediaData,
                        localAudienceData,
                        userApiKey
                    );
                    markStatusDone(status11);

                    // åœ¨å ±å‘Šé–‹é ­åŠ å…¥ project ID è³‡è¨Š
                    const projectInfoHtml = `
                        <div style="background-color: #f0f9ff; border: 1px solid #0ea5e9; border-radius: 8px; padding: 16px; margin-bottom: 24px;">
                            <h3 style="color: #0c4a6e; margin: 0 0 8px 0; font-size: 18px;">ğŸ“‹ å°ˆæ¡ˆè³‡è¨Š</h3>
                            <p style="color: #0369a1; margin: 0; font-weight: 500;">å°ˆæ¡ˆ ID: <strong>${currentProjectId}</strong></p>
                            <p style="color: #0369a1; margin: 4px 0 0 0; font-size: 14px;">ç”Ÿæˆæ™‚é–“: ${new Date().toLocaleString('zh-TW')}</p>
                        </div>
                    `;
                    
                    proposalOutput.innerHTML = projectInfoHtml + finalReport;

                } catch (error) {
                    console.error('ç”Ÿæˆææ¡ˆæ™‚ç™¼ç”ŸéŒ¯èª¤:', error);
                    updateStatus(`ç”Ÿæˆå ±å‘Šæ™‚ç™¼ç”ŸéŒ¯èª¤: ${error.message}`, 'error');
                    
                    // æä¾›æ›´è©³ç´°çš„éŒ¯èª¤è¨Šæ¯
                    let errorMessage = `<div class="bg-red-50 border border-red-200 rounded-lg p-4">
                        <h3 class="text-red-800 font-bold mb-2">âŒ è™•ç†éç¨‹ä¸­ç™¼ç”ŸéŒ¯èª¤</h3>
                        <p class="text-red-700 mb-2"><strong>éŒ¯èª¤è¨Šæ¯:</strong> ${error.message}</p>`;
                    
                    // å¦‚æœæ˜¯ JSON è§£æéŒ¯èª¤ï¼Œæä¾›ç‰¹åˆ¥çš„å»ºè­°
                    if (error.message.includes('JSON') || error.message.includes('SyntaxError')) {
                        errorMessage += `<div class="bg-yellow-50 border border-yellow-200 rounded-lg p-3 mt-3">
                            <h4 class="text-yellow-800 font-medium mb-2">ğŸ”§ JSONè§£æå•é¡Œ</h4>
                            <p class="text-yellow-700 mb-2">ç³»çµ±å·²æª¢æ¸¬åˆ°JSONæ ¼å¼å•é¡Œã€‚æœ€æ–°ç‰ˆæœ¬å·²æ”¹å–„æ­¤é¡å•é¡Œçš„è™•ç†æ©Ÿåˆ¶ã€‚</p>
                            <p class="text-yellow-700 mb-2"><strong>å¯èƒ½åŸå› :</strong></p>
                            <ul class="text-yellow-700 list-disc list-inside mb-2 text-sm">
                                <li>AI æ¨¡å‹å›æ‡‰åŒ…å«æ ¼å¼åŒ–å­—ç¬¦</li>
                                <li>API å›æ‡‰æ ¼å¼ç•°å¸¸</li>
                                <li>ç¶²è·¯å‚³è¼¸å¹²æ“¾</li>
                                <li>API é‡‘é‘°æ¬Šé™å•é¡Œ</li>
                            </ul>
                            <p class="text-yellow-700 text-sm"><strong>å»ºè­°:</strong> è«‹é‡æ–°å˜—è©¦ç”Ÿæˆå ±å‘Šã€‚å¦‚æœå•é¡ŒæŒçºŒç™¼ç”Ÿï¼Œè«‹æª¢æŸ¥APIé‡‘é‘°æˆ–è¯ç¹«æŠ€è¡“æ”¯æ´ã€‚</p>
                        </div>`;
                    } else if (error.message.includes('API') || error.message.includes('401') || error.message.includes('403') || error.message.includes('400')) {
                        errorMessage += `<div class="bg-red-50 border border-red-200 rounded-lg p-4 mt-3">
                            <h4 class="text-red-800 font-medium mb-3">ğŸ”‘ APIé‡‘é‘°å•é¡Œ</h4>
                            <div class="mb-3">
                                <p class="text-red-700 text-sm font-medium">æ‚¨çš„APIé‡‘é‘°å¯èƒ½æœ‰ä»¥ä¸‹å•é¡Œï¼š</p>
                                <ul class="text-red-600 list-disc list-inside mt-2 text-sm space-y-1">
                                    <li>APIé‡‘é‘°æ ¼å¼ä¸æ­£ç¢ºï¼ˆæ‡‰ä»¥AIzaSyé–‹é ­ï¼‰</li>
                                    <li>APIé‡‘é‘°å·²éæœŸæˆ–è¢«æ’¤éŠ·</li>
                                    <li>æœªå•Ÿç”¨Gemini APIæœå‹™</li>
                                    <li>è¤‡è£½æ™‚åŒ…å«å¤šé¤˜ç©ºæ ¼æˆ–å­—ç¬¦</li>
                                </ul>
                            </div>
                            <div class="bg-blue-50 border border-blue-200 rounded p-3">
                                <p class="text-blue-800 font-medium mb-2">ğŸ’¡ ç«‹å³è§£æ±ºæ–¹æ¡ˆï¼š</p>
                                <ol class="text-blue-700 list-decimal list-inside text-sm space-y-1">
                                    <li>æ¸…é™¤ç•¶å‰APIé‡‘é‘°æ¬„ä½</li>
                                    <li>è¨ªå• <a href="https://aistudio.google.com/app/apikey" target="_blank" class="underline font-medium">Google AI Studio</a></li>
                                    <li>å»ºç«‹æ–°çš„APIé‡‘é‘°</li>
                                    <li>å®Œæ•´è¤‡è£½æ–°é‡‘é‘°ä¸¦é‡æ–°è²¼ä¸Š</li>
                                    <li>ä½¿ç”¨ã€ŒğŸ” é©—è­‰é‡‘é‘°ã€æŒ‰éˆ•æ¸¬è©¦</li>
                                </ol>
                            </div>
                        </div>`;
                    } else {
                        errorMessage += `<div class="bg-gray-50 border border-gray-200 rounded-lg p-3 mt-3">
                            <h4 class="text-gray-800 font-medium mb-2">ğŸ› ï¸ ä¸€èˆ¬éŒ¯èª¤</h4>
                            <p class="text-gray-700 mb-2">å»ºè­°å˜—è©¦ä»¥ä¸‹è§£æ±ºæ–¹æ³•ï¼š</p>
                            <ul class="text-gray-700 list-disc list-inside mb-2 text-sm">
                                <li>é‡æ–°æ•´ç†é é¢</li>
                                <li>æª¢æŸ¥ç¶²è·¯é€£ç·š</li>
                                <li>ç¢ºèªæ‰€æœ‰æ¬„ä½æ­£ç¢ºå¡«å¯«</li>
                                <li>æŸ¥çœ‹ç€è¦½å™¨ä¸»æ§å°çš„è©³ç´°éŒ¯èª¤</li>
                            </ul>
                        </div>`;
                    }
                    
                    errorMessage += `<div class="mt-3 p-2 bg-gray-100 rounded text-xs text-gray-600">
                        <strong>åµéŒ¯è³‡è¨Š:</strong> æŒ‰F12æ‰“é–‹é–‹ç™¼è€…å·¥å…·æŸ¥çœ‹è©³ç´°æ—¥èªŒ
                    </div>`;
                    
                    errorMessage += `</div>`;
                    proposalOutput.innerHTML = errorMessage;
                } finally {
                    if (generateBtn) {
                        generateBtn.disabled = false;
                        generateBtn.innerHTML = `é‡æ–°ç”Ÿæˆ AI åˆ†æå ±å‘Š`;
                    }
                }
            } catch (error) {
                console.error('ä¸»å‡½æ•¸åŸ·è¡ŒéŒ¯èª¤:', error);
                alert(`åŸ·è¡ŒéŒ¯èª¤: ${error.message}\nè«‹é‡æ–°æ•´ç†é é¢æˆ–è¯ç¹«æŠ€è¡“æ”¯æ´ã€‚`);
            }
        }

        // æ–°å¢ï¼šGoogle Drive ç›¸é—œå‡½æ•¸
        async function setupGoogleDrive() {
            try {
                // è¼‰å…¥ Google Drive API
                await new Promise((resolve, reject) => {
                    const script = document.createElement('script');
                    script.src = 'https://apis.google.com/js/api.js';
                    script.onload = () => {
                        gapi.load('client', async () => {
                            try {
                                await gapi.client.init({});
                                await gapi.client.load('drive', 'v3');
                                resolve();
                            } catch (error) {
                                reject(error);
                            }
                        });
                    };
                    script.onerror = reject;
                    document.head.appendChild(script);
                });

                // è®€å–è³‡æ–™å¤¾è¨­å®šï¼ˆæ·»åŠ  null æª¢æŸ¥ï¼‰
                const centralFolderElement = document.getElementById('centralFolderName');
                const mediaplanSubfolderElement = document.getElementById('mediaplanSubfolder');
                
                folderStructure.centralFolder = centralFolderElement?.value || 'iStaging_å°ˆæ¡ˆç®¡ç†';
                folderStructure.mediaplanSubfolder = mediaplanSubfolderElement?.value || '02_åª’é«”ææ¡ˆ';

                // å»ºç«‹è³‡æ–™å¤¾çµæ§‹
                await setupCentralizedFolderStructure();
                isGoogleDriveEnabled = true;
                
                console.log('Google Drive è¨­å®šå®Œæˆ');
                return true;
            } catch (error) {
                console.error('Google Drive è¨­å®šå¤±æ•—:', error);
                return false;
            }
        }

        async function setupCentralizedFolderStructure() {
            try {
                // 1. å»ºç«‹æˆ–æ‰¾åˆ°ä¸»è¦å°ˆæ¡ˆè³‡æ–™å¤¾
                const centralFolderId = await findOrCreateFolder(folderStructure.centralFolder, null);
                folderIds.central = centralFolderId;
                
                // 2. å»ºç«‹æˆ–æ‰¾åˆ°å°ˆæ¡ˆå­è³‡æ–™å¤¾
                if (currentProjectId) {
                    const projectFolderName = `[${currentProjectId}]_å°ˆæ¡ˆè³‡æ–™`;
                    const projectFolderId = await findOrCreateFolder(projectFolderName, centralFolderId);
                    folderIds.project = projectFolderId;
                    
                    // 3. å»ºç«‹æˆ–æ‰¾åˆ°åª’é«”ææ¡ˆå­è³‡æ–™å¤¾
                    const mediaplanFolderId = await findOrCreateFolder(folderStructure.mediaplanSubfolder, projectFolderId);
                    folderIds.mediaplan = mediaplanFolderId;
                    
                    console.log('é›†ä¸­åŒ–è³‡æ–™å¤¾çµæ§‹å»ºç«‹å®Œæˆ:', {
                        central: centralFolderId,
                        project: projectFolderId,
                        mediaplan: mediaplanFolderId
                    });
                    
                    return true;
                }
                
                return false;
            } catch (error) {
                console.error('å»ºç«‹è³‡æ–™å¤¾çµæ§‹å¤±æ•—:', error);
                throw error;
            }
        }

        async function findOrCreateFolder(folderName, parentId) {
            try {
                let query = `mimeType='application/vnd.google-apps.folder' and name='${folderName}' and trashed=false`;
                if (parentId) {
                    query += ` and '${parentId}' in parents`;
                }
                
                const response = await gapi.client.drive.files.list({ 
                    q: query, 
                    fields: 'files(id)' 
                });
                
                if (response.result.files && response.result.files.length > 0) {
                    return response.result.files[0].id;
                } else {
                    const folderMetadata = {
                        name: folderName,
                        mimeType: 'application/vnd.google-apps.folder'
                    };
                    
                    if (parentId) {
                        folderMetadata.parents = [parentId];
                    }
                    
                    const createResponse = await gapi.client.drive.files.create({ 
                        resource: folderMetadata, 
                        fields: 'id' 
                    });
                    
                    return createResponse.result.id;
                }
            } catch (error) {
                console.error(`å»ºç«‹è³‡æ–™å¤¾ ${folderName} å¤±æ•—:`, error);
                throw error;
            }
        }

        async function saveToGoogleDrive(content, fileName) {
            try {
                if (!isGoogleDriveEnabled) {
                    const driveEnabled = await setupGoogleDrive();
                    if (!driveEnabled) {
                        console.log('Google Drive æœªå•Ÿç”¨ï¼Œè·³éå„²å­˜');
                        return false;
                    }
                }

                // ç¢ºä¿è³‡æ–™å¤¾çµæ§‹å·²å»ºç«‹
                if (!folderIds.mediaplan) {
                    await setupCentralizedFolderStructure();
                }

                // å»ºç«‹æª”æ¡ˆå…§å®¹
                const fileContent = {
                    projectId: currentProjectId,
                    content: content,
                    generatedAt: new Date().toISOString(),
                    tool: 'mediaplan'
                };

                const blob = new Blob([JSON.stringify(fileContent, null, 2)], { type: 'application/json' });
                const metadata = { 
                    name: fileName, 
                    mimeType: 'application/json', 
                    parents: [folderIds.mediaplan] 
                };
                
                const form = new FormData();
                form.append('metadata', new Blob([JSON.stringify(metadata)], { type: 'application/json' }));
                form.append('file', blob);
                
                // éœ€è¦ç”¨æˆ¶æˆæ¬Šæ‰èƒ½ä¸Šå‚³
                console.log('éœ€è¦ç”¨æˆ¶æˆæ¬Šæ‰èƒ½ä¸Šå‚³åˆ° Google Drive');
                return false;
                
            } catch (error) {
                console.error('å„²å­˜åˆ° Google Drive å¤±æ•—:', error);
                return false;
            }
        }

        // B2B å•†æ¥­æ¨¡å¼çš„å‹•æ…‹åŠŸèƒ½
        if (businessModelInput) {
            businessModelInput.addEventListener('change', function() {
                const selectedModel = this.value;
                updateB2BFields(selectedModel);
            });
        }

        // æ›´æ–° B2B ç›¸é—œæ¬„ä½çš„é¡¯ç¤º
        function updateB2BFields(selectedModel) {
            const b2bSection = document.querySelector('.border-t.border-gray-200.pt-6');
            if (!b2bSection) return;

            if (selectedModel === 'B2B') {
                b2bSection.style.display = 'block';
                // æ·»åŠ å°ˆæ¥­æç¤º
                showB2BProfessionalTips();
            } else {
                b2bSection.style.display = 'none';
                // éš±è—å°ˆæ¥­æç¤º
                hideB2BProfessionalTips();
            }
        }

        // é¡¯ç¤º B2B å°ˆæ¥­æç¤º
        function showB2BProfessionalTips() {
            const tipsHtml = `
                <div id="b2b-tips" class="mt-4 p-4 bg-purple-50 border-l-4 border-purple-400 rounded-lg">
                    <div class="flex items-start">
                        <div class="flex-shrink-0">
                            <svg class="h-5 w-5 text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                        <div class="ml-3">
                            <h4 class="text-sm font-medium text-purple-800">B2B å°ˆæ¥­åˆ†ææç¤º</h4>
                            <div class="mt-2 text-sm text-purple-700">
                                <p><strong>ä¼æ¥­è¦æ¨¡ï¼š</strong>ä¸åŒè¦æ¨¡ä¼æ¥­çš„æ¡è³¼æµç¨‹å’Œæ±ºç­–é€±æœŸå·®ç•°å¾ˆå¤§</p>
                                <p><strong>æ±ºç­–è€…è§’è‰²ï¼š</strong>äº†è§£èª°æ˜¯æœ€çµ‚æ±ºç­–è€…ï¼Œèª°æ˜¯å½±éŸ¿è€…</p>
                                <p><strong>æ¡è³¼é€±æœŸï¼š</strong>B2B æ¡è³¼é€šå¸¸éœ€è¦ 3-12 å€‹æœˆçš„æ±ºç­–é€±æœŸ</p>
                                <p><strong>ç—›é»åˆ†æï¼š</strong>ç²¾æº–è­˜åˆ¥ä¼æ¥­é¢è‡¨çš„å…·é«”æ¥­å‹™æŒ‘æˆ°</p>
                                <p><strong>æˆåŠŸæŒ‡æ¨™ï¼š</strong>ä¼æ¥­å®¢æˆ¶æ›´é—œæ³¨ ROIã€æ•ˆç‡æå‡ã€æˆæœ¬ç¯€çœ</p>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            const existingTips = document.getElementById('b2b-tips');
            if (!existingTips) {
                const b2bSection = document.querySelector('.border-t.border-gray-200.pt-6');
                if (b2bSection) {
                    b2bSection.insertAdjacentHTML('afterend', tipsHtml);
                }
            }
        }

        // éš±è— B2B å°ˆæ¥­æç¤º
        function hideB2BProfessionalTips() {
            const tips = document.getElementById('b2b-tips');
            if (tips) {
                tips.remove();
            }
        }

        // ä¸»è¦å¸‚å ´é¸æ“‡çš„å‹•æ…‹åŠŸèƒ½
        if (primaryMarketInput) {
            primaryMarketInput.addEventListener('change', function() {
                const selectedMarket = this.value;
                updateMarketAnalysisFocus(selectedMarket);
            });
        }

        // æ›´æ–°å¸‚å ´åˆ†æé‡é»
        function updateMarketAnalysisFocus(selectedMarket) {
            const marketInsights = getMarketInsights(selectedMarket);
            showMarketInsights(marketInsights);
        }

        // ç²å–å¸‚å ´æ´å¯Ÿ
        function getMarketInsights(market) {
            const insights = {
                'taiwan': {
                    title: 'å°ç£å¸‚å ´æ´å¯Ÿ',
                    characteristics: [
                        'é«˜åº¦æ•¸ä½åŒ–ï¼Œè¡Œå‹•è£ç½®æ™®åŠç‡é«˜',
                        'ç¤¾ç¾¤åª’é«”ä½¿ç”¨é »ç¹ï¼ŒLINEã€Facebookã€Instagram ç‚ºä¸»',
                        'é‡è¦–å“è³ªå’Œæœå‹™ï¼Œåƒ¹æ ¼æ•æ„Ÿåº¦ä¸­ç­‰',
                        'B2B å¸‚å ´é‡è¦–é—œä¿‚å»ºç«‹å’Œé•·æœŸåˆä½œ',
                        'æ³•è¦ç’°å¢ƒç›¸å°å®Œå–„ï¼Œåˆè¦è¦æ±‚é«˜'
                    ],
                    media_preferences: [
                        'æ•¸ä½åª’é«”ä½”ä¸»å°åœ°ä½',
                        'ç¤¾ç¾¤åª’é«”å»£å‘Šæ•ˆæœä½³',
                        'KOL å’Œç¶²ç´…è¡ŒéŠ·ç››è¡Œ',
                        'å‚³çµ±åª’é«”ä»æœ‰å½±éŸ¿åŠ›ï¼ˆé›»è¦–ã€å»£æ’­ï¼‰',
                        'æœå°‹å¼•æ“è¡ŒéŠ·ï¼ˆGoogleã€Yahooï¼‰é‡è¦'
                    ],
                    business_culture: [
                        'é‡è¦–èª ä¿¡å’Œå°ˆæ¥­',
                        'æ±ºç­–éç¨‹ç›¸å°è¬¹æ…',
                        'é—œä¿‚å°å‘çš„å•†æ¥­æ–‡åŒ–',
                        'é‡è¦–å”®å¾Œæœå‹™å’Œæ”¯æ´',
                        'å‰µæ–°æ¥å—åº¦ä¸­ç­‰'
                    ]
                },
                'japan': {
                    title: 'æ—¥æœ¬å¸‚å ´æ´å¯Ÿ',
                    characteristics: [
                        'é«˜åº¦æˆç†Ÿçš„æ¶ˆè²»å¸‚å ´',
                        'å“è³ªè¦æ±‚æ¥µé«˜ï¼Œå“ç‰Œå¿ èª åº¦å¼·',
                        'æ±ºç­–éç¨‹è¬¹æ…ï¼Œéœ€è¦è©³ç´°è³‡è¨Š',
                        'é‡è¦–ç¦®è²Œå’Œç´°ç¯€',
                        'äººå£è€é½¡åŒ–è¶¨å‹¢æ˜é¡¯'
                    ],
                    media_preferences: [
                        'å‚³çµ±åª’é«”ä»å…·å½±éŸ¿åŠ›',
                        'LINE æ˜¯ä¸»è¦ç¤¾ç¾¤å¹³å°',
                        'é›»è¦–å»£å‘Šæ•ˆæœé¡¯è‘—',
                        'å°åˆ·åª’é«”åœ¨ B2B å¸‚å ´é‡è¦',
                        'è¡Œå‹•è£ç½®ä½¿ç”¨ç‡é«˜'
                    ],
                    business_culture: [
                        'æ¥µåº¦é‡è¦–å“è³ªå’Œæœå‹™',
                        'æ±ºç­–å±¤ç´šå¤šï¼Œæµç¨‹è¤‡é›œ',
                        'é—œä¿‚å»ºç«‹éœ€è¦æ™‚é–“',
                        'é‡è¦–é•·æœŸåˆä½œé—œä¿‚',
                        'å‰µæ–°æ¥å—åº¦ç›¸å°ä¿å®ˆ'
                    ]
                },
                'us': {
                    title: 'ç¾åœ‹å¸‚å ´æ´å¯Ÿ',
                    characteristics: [
                        'é«˜åº¦ç«¶çˆ­çš„å¸‚å ´ç’°å¢ƒ',
                        'å‰µæ–°æ¥å—åº¦é«˜ï¼Œé¡˜æ„å˜—è©¦æ–°ç”¢å“',
                        'åƒ¹æ ¼æ•æ„Ÿåº¦ä¸­ç­‰ï¼Œé‡è¦–åƒ¹å€¼',
                        'æ±ºç­–éç¨‹ç›¸å°å¿«é€Ÿ',
                        'å¤šå…ƒæ–‡åŒ–èƒŒæ™¯'
                    ],
                    media_preferences: [
                        'æ•¸ä½åª’é«”ä½”çµ•å°ä¸»å°',
                        'Googleã€Facebookã€Instagram é‡è¦',
                        'å…§å®¹è¡ŒéŠ·æ•ˆæœé¡¯è‘—',
                        'å½±éŸ³å…§å®¹ï¼ˆYouTubeã€TikTokï¼‰æµè¡Œ',
                        'é›»å­éƒµä»¶è¡ŒéŠ·æœ‰æ•ˆ'
                    ],
                    business_culture: [
                        'çµæœå°å‘ï¼Œé‡è¦– ROI',
                        'æ±ºç­–éç¨‹ç›¸å°ç›´æ¥',
                        'å‰µæ–°å’Œæ•ˆç‡ä¸¦é‡',
                        'ç«¶çˆ­æ¿€çƒˆï¼Œå·®ç•°åŒ–é‡è¦',
                        'æ•¸æ“šé©…å‹•çš„æ±ºç­–'
                    ]
                },
                'india': {
                    title: 'å°åº¦å¸‚å ´æ´å¯Ÿ',
                    characteristics: [
                        'å¿«é€Ÿæˆé•·çš„æ–°èˆˆå¸‚å ´',
                        'åƒ¹æ ¼æ•æ„Ÿåº¦é«˜ï¼Œé‡è¦–æ€§åƒ¹æ¯”',
                        'å¹´è¼•äººå£å æ¯”é«˜ï¼Œæ•¸ä½åŒ–ç¨‹åº¦å¿«é€Ÿæå‡',
                        'å®¶åº­å’Œç¤¾å€å½±éŸ¿æ±ºç­–é‡è¦',
                        'å¤šèªè¨€ã€å¤šæ–‡åŒ–çš„è¤‡é›œå¸‚å ´'
                    ],
                    media_preferences: [
                        'WhatsApp æ˜¯ä¸»è¦æºé€šå¹³å°',
                        'Facebookã€Instagram ä½¿ç”¨ç‡é«˜',
                        'YouTube å½±éŸ³å…§å®¹å—æ­¡è¿',
                        'è¡Œå‹•å„ªå…ˆçš„åª’é«”æ¶ˆè²»ç¿’æ…£',
                        'æœ¬åœ°èªè¨€å…§å®¹éœ€æ±‚é«˜'
                    ],
                    business_culture: [
                        'é—œä¿‚å°å‘ï¼Œé‡è¦–ä¿¡ä»»å»ºç«‹',
                        'æ±ºç­–éç¨‹è¼ƒé•·ï¼Œéœ€å¤šæ–¹è€ƒé‡',
                        'åƒ¹æ ¼è«‡åˆ¤æ˜¯å¸¸æ…‹',
                        'å®¶æ—ä¼æ¥­æ–‡åŒ–æ¿ƒåš',
                        'é‡è¦–é•·æœŸåˆä½œå’Œå¿ èª åº¦'
                    ]
                },
                'germany': {
                    title: 'å¾·åœ‹å¸‚å ´æ·±åº¦æ´å¯Ÿ',
                    characteristics: [
                        'é«˜åº¦æˆç†Ÿçš„å·¥æ¥­åŒ–ç¶“æ¿Ÿé«”ï¼ŒGDP å…¨çƒç¬¬å››',
                        'å“è³ªè¦æ±‚æ¥µé«˜ï¼Œé‡è¦–æŠ€è¡“æ¨™æº–å’Œèªè­‰',
                        'æ±ºç­–éç¨‹åš´è¬¹ï¼Œéœ€è¦è©³ç´°æŠ€è¡“æ–‡ä»¶å’Œæ•¸æ“šæ”¯æŒ',
                        'åƒ¹æ ¼æ•æ„Ÿåº¦ä¸­ç­‰ï¼Œé‡è¦–é•·æœŸåƒ¹å€¼å’ŒæŠ•è³‡å›å ±',
                        'ç’°ä¿æ„è­˜å¼·ï¼Œæ°¸çºŒç™¼å±•å’Œç¶ è‰²æŠ€è¡“å„ªå…ˆ',
                        'é«˜åº¦æ•¸ä½åŒ–ï¼Œä½†å‚³çµ±åª’é«”ä»æœ‰å½±éŸ¿åŠ›',
                        'å€åŸŸå·®ç•°æ˜é¡¯ï¼Œå—åŒ—ç¶“æ¿Ÿç™¼å±•ä¸å¹³è¡¡',
                        'ä¸­å°ä¼æ¥­ (Mittelstand) æ˜¯ç¶“æ¿Ÿæ”¯æŸ±',
                        'å‰µæ–°æ¥å—åº¦ä¸­ç­‰ï¼Œä½†é‡è¦–å¯¦ç”¨æ€§å’Œå¯é æ€§',
                        'äººå£è€é½¡åŒ–ï¼Œä½†æŠ€è¡“äººæ‰å……è¶³'
                    ],
                    media_preferences: [
                        'LinkedIn åœ¨ B2B å¸‚å ´ä½”ä¸»å°åœ°ä½',
                        'å°ˆæ¥­åª’é«”å’Œè¡Œæ¥­é›œèªŒå½±éŸ¿åŠ›å¤§ (å¦‚ Handelsblatt, Wirtschaftswoche)',
                        'Google æœå°‹å¼•æ“ä½¿ç”¨ç‡é«˜ï¼ŒSEO ç­–ç•¥é‡è¦',
                        'é›»å­éƒµä»¶è¡ŒéŠ·æ•ˆæœé¡¯è‘—ï¼Œä½†éœ€è¦å€‹äººåŒ–',
                        'å…§å®¹è¡ŒéŠ·é‡è¦–å°ˆæ¥­æ€§å’Œæ·±åº¦ï¼ŒæŠ€è¡“ç™½çš®æ›¸å—æ­¡è¿',
                        'Facebook å’Œ Instagram åœ¨ B2C å¸‚å ´ä½¿ç”¨ç‡é«˜',
                        'YouTube ç”¨æ–¼æ•™è‚²å…§å®¹å’Œç”¢å“å±•ç¤º',
                        'æ’­å®¢ (Podcasts) åœ¨å°ˆæ¥­é ˜åŸŸå—æ­¡è¿',
                        'å‚³çµ±åª’é«” (é›»è¦–ã€å»£æ’­) ä»æœ‰å½±éŸ¿åŠ›',
                        'æˆ¶å¤–å»£å‘Šåœ¨ä¸»è¦åŸå¸‚æ•ˆæœè‰¯å¥½'
                    ],
                    business_culture: [
                        'æ¥µåº¦é‡è¦–å“è³ªå’ŒæŠ€è¡“æ¨™æº–ï¼ŒISO èªè­‰æ˜¯åŸºæœ¬è¦æ±‚',
                        'æ±ºç­–éç¨‹éœ€è¦è©³ç´°åˆ†æå’Œè«–è­‰ï¼Œä¸å–œæ­¡å¿«é€Ÿæ±ºç­–',
                        'é‡è¦–åˆè¦æ€§å’Œæ³•è¦è¦æ±‚ï¼Œæ³•å¾‹æ–‡ä»¶å¿…é ˆå®Œæ•´',
                        'é•·æœŸåˆä½œé—œä¿‚ï¼Œä¿¡ä»»å»ºç«‹éœ€è¦æ™‚é–“ï¼Œä½†ä¸€æ—¦å»ºç«‹å¾ˆç©©å›º',
                        'å‰µæ–°æ¥å—åº¦ä¸­ç­‰ï¼Œä½†é‡è¦–å¯¦ç”¨æ€§å’ŒæŠ•è³‡å›å ±',
                        'æºé€šé¢¨æ ¼ç›´æ¥ä½†ç¦®è²Œï¼Œé‡è¦–æº–ç¢ºæ€§å’Œå°ˆæ¥­æ€§',
                        'æ™‚é–“è§€å¿µåš´æ ¼ï¼Œæœƒè­°æº–æ™‚é–‹å§‹å’ŒçµæŸ',
                        'éšç´šè§€å¿µè¼ƒå¼·ï¼Œè·ä½å’Œå­¸æ­·å¾ˆé‡è¦',
                        'é‡è¦–å¯æŒçºŒç™¼å±•å’Œä¼æ¥­ç¤¾æœƒè²¬ä»»',
                        'è«‡åˆ¤éç¨‹éœ€è¦è€å¿ƒï¼Œä¸å–œæ­¡é«˜å£“éŠ·å”®'
                    ],
                    b2b_strategy: [
                        'å»ºç«‹æŠ€è¡“æ¬Šå¨å½¢è±¡ï¼Œæä¾›è©³ç´°çš„æŠ€è¡“æ–‡æª”',
                        'é‡è¦–é•·æœŸé—œä¿‚å»ºç«‹ï¼Œä¸è¦æœŸå¾…å¿«é€Ÿæˆäº¤',
                        'æº–å‚™å……åˆ†çš„æ•¸æ“šå’Œæ¡ˆä¾‹ç ”ç©¶ä¾†æ”¯æŒææ¡ˆ',
                        'å¼·èª¿å“è³ªã€å¯é æ€§å’ŒæŠ€è¡“å„ªå‹¢',
                        'è€ƒæ…®ç•¶åœ°åˆä½œå¤¥ä¼´æˆ–ä»£ç†å•†',
                        'é‡è¦–å”®å¾Œæœå‹™å’ŒæŠ€è¡“æ”¯æŒ',
                        'æº–å‚™å¾·èªç‰ˆæœ¬çš„ç‡ŸéŠ·ææ–™',
                        'åƒåŠ å¾·åœ‹é‡è¦çš„è¡Œæ¥­å±•è¦½æœƒ',
                        'å»ºç«‹ç•¶åœ°çš„æŠ€è¡“æ”¯æŒåœ˜éšŠ',
                        'é‡è¦–åˆè¦æ€§å’Œæ³•è¦è¦æ±‚'
                    ],
                    localization_recommendations: [
                        'æ‰€æœ‰ææ–™å¿…é ˆæœ‰å¾·èªç‰ˆæœ¬ï¼Œè‹±èªå¯ä½œç‚ºè¼”åŠ©',
                        'é©æ‡‰å¾·åœ‹çš„æ•¸æ“šä¿è­·æ³•è¦ (GDPR)',
                        'è€ƒæ…®å¾·åœ‹çš„ç¨…å‹™å’Œæœƒè¨ˆè¦æ±‚',
                        'é©æ‡‰å¾·åœ‹çš„å‹å‹•æ³•è¦å’Œå·¥æœƒæ–‡åŒ–',
                        'é‡è¦–å¾·åœ‹çš„ç’°ä¿æ¨™æº–å’Œèªè­‰',
                        'é©æ‡‰å¾·åœ‹çš„å•†æ¥­ç¦®å„€å’Œæºé€šç¿’æ…£',
                        'è€ƒæ…®å¾·åœ‹çš„ç¯€å‡æ—¥å’Œä¼‘å‡æ–‡åŒ–',
                        'é©æ‡‰å¾·åœ‹çš„æ”¯ä»˜ç¿’æ…£å’Œè²¡å‹™æµç¨‹',
                        'é‡è¦–å¾·åœ‹çš„å“è³ªæ¨™æº–å’Œèªè­‰è¦æ±‚',
                        'è€ƒæ…®å¾·åœ‹çš„å€åŸŸå·®ç•°å’Œæ–‡åŒ–å¤šæ¨£æ€§'
                    ],
                    regulatory_compliance: [
                        'åš´æ ¼éµå®ˆæ­ç›Ÿ GDPR æ•¸æ“šä¿è­·æ³•è¦',
                        'ç¬¦åˆå¾·åœ‹ç”¢å“å®‰å…¨æ³• (ProdSG) è¦æ±‚',
                        'éµå®ˆå¾·åœ‹ç«¶çˆ­æ³• (GWB) å’Œåå£Ÿæ–·æ³•',
                        'ç¬¦åˆå¾·åœ‹ç¨…æ³•è¦æ±‚ï¼ŒåŒ…æ‹¬ VAT å’Œä¼æ¥­ç¨…',
                        'éµå®ˆå¾·åœ‹å‹å‹•æ³•è¦å’Œå·¥æœƒå”è­°',
                        'ç¬¦åˆå¾·åœ‹ç’°ä¿æ³•è¦å’Œæ°¸çºŒç™¼å±•è¦æ±‚',
                        'éµå®ˆå¾·åœ‹é‡‘èæœå‹™æ³•è¦ (KWG)',
                        'ç¬¦åˆå¾·åœ‹é†«ç™‚è¨­å‚™æ³•è¦ (MPG)',
                        'éµå®ˆå¾·åœ‹åŒ–å­¸å“æ³•è¦ (ChemG)',
                        'ç¬¦åˆå¾·åœ‹å»ºç¯‰æ³•è¦å’Œæ¨™æº– (DIN)'
                    ],
                    competitive_analysis_template: {
                        'direct_competitors': [
                            'åˆ†æå¾·åœ‹æœ¬åœŸç«¶çˆ­å°æ‰‹',
                            'è©•ä¼°æ­æ´²å…¶ä»–åœ‹å®¶çš„ç«¶çˆ­å°æ‰‹',
                            'åˆ†æå…¨çƒæ€§ä¼æ¥­åœ¨å¾·åœ‹çš„è¡¨ç¾',
                            'è©•ä¼°æ–°èˆˆç§‘æŠ€å…¬å¸çš„å¨è„…'
                        ],
                        'competitive_advantages': [
                            'æŠ€è¡“å„ªå‹¢å’Œå°ˆåˆ©åˆ†æ',
                            'å“è³ªå’Œå¯é æ€§å„ªå‹¢',
                            'æœå‹™å’Œæ”¯æ´å„ªå‹¢',
                            'åƒ¹æ ¼å’Œæˆæœ¬å„ªå‹¢',
                            'å‰µæ–°å’Œç ”ç™¼èƒ½åŠ›'
                        ],
                        'market_positioning': [
                            'é«˜ç«¯å“è³ªå®šä½',
                            'æŠ€è¡“é ˜å…ˆå®šä½',
                            'å¯æŒçºŒç™¼å±•å®šä½',
                            'æˆæœ¬æ•ˆç›Šå®šä½',
                            'å‰µæ–°è§£æ±ºæ–¹æ¡ˆå®šä½'
                        ]
                    },
                    success_case_database: [
                        'SAP åœ¨å¾·åœ‹çš„æˆåŠŸæ¡ˆä¾‹',
                        'è¥¿é–€å­åœ¨å·¥æ¥­ 4.0 çš„é ˜å°åœ°ä½',
                        'å¯¶é¦¬åœ¨é›»å‹•è»Šå¸‚å ´çš„è½‰å‹',
                        'æ‹œè€³åœ¨é†«ç™‚ç§‘æŠ€é ˜åŸŸçš„å‰µæ–°',
                        'é˜¿è¿ªé”æ–¯åœ¨æ•¸ä½åŒ–è½‰å‹çš„æˆåŠŸ',
                        'å¤§çœ¾æ±½è»Šåœ¨é›»å‹•åŒ–è½‰å‹çš„ç­–ç•¥',
                        'åšä¸–åœ¨ç‰©è¯ç¶²é ˜åŸŸçš„ç™¼å±•',
                        'é»˜å…‹åœ¨ç”Ÿç‰©ç§‘æŠ€é ˜åŸŸçš„çªç ´'
                    ],
                    roi_prediction_model: {
                        'short_term_roi': '6-12 å€‹æœˆï¼Œé æœŸ ROI: 15-25%',
                        'medium_term_roi': '1-2 å¹´ï¼Œé æœŸ ROI: 30-45%',
                        'long_term_roi': '3-5 å¹´ï¼Œé æœŸ ROI: 50-80%',
                        'key_factors': [
                            'å¸‚å ´é€²å…¥æ™‚æ©Ÿå’Œç­–ç•¥',
                            'æœ¬åœ°åŒ–ç¨‹åº¦å’Œé©æ‡‰æ€§',
                            'ç«¶çˆ­ç’°å¢ƒå’Œå·®ç•°åŒ–å„ªå‹¢',
                            'æ³•è¦åˆè¦æ€§å’Œé¢¨éšªç®¡ç†',
                            'é•·æœŸé—œä¿‚å»ºç«‹å’Œä¿¡ä»»åº¦'
                        ]
                    }
                },
                'philippines': {
                    title: 'è²å¾‹è³“å¸‚å ´æ·±åº¦æ´å¯Ÿ',
                    characteristics: [
                        'å¿«é€Ÿæˆé•·çš„æ–°èˆˆç¶“æ¿Ÿé«”ï¼ŒGDP æˆé•·ç‡ç´„ 6-7%',
                        'å¹´è¼•äººå£çµæ§‹ï¼Œå¹³å‡å¹´é½¡ 25 æ­²ï¼Œå‹å‹•åŠ›å……æ²›',
                        'é«˜åº¦æ•¸ä½åŒ–ç¤¾æœƒï¼Œç¤¾ç¾¤åª’é«”ä½¿ç”¨ç‡æ¥µé«˜',
                        'è‹±èªæ™®åŠç‡é«˜ï¼Œå•†å‹™æºé€šä»¥è‹±èªç‚ºä¸»',
                        'å®¶åº­å’Œç¤¾ç¾¤æ–‡åŒ–æ¿ƒåšï¼Œç¾¤é«”æ±ºç­–å½±éŸ¿å¤§',
                        'åƒ¹æ ¼æ•æ„Ÿåº¦é«˜ï¼Œé‡è¦–æ€§åƒ¹æ¯”å’Œå„ªæƒ ',
                        'OFW (æµ·å¤–å·¥ä½œè€…) åŒ¯æ¬¾æ¨å‹•æ¶ˆè²»ç¶“æ¿Ÿ',
                        'å³¶å¶¼ç¶“æ¿Ÿï¼Œç‰©æµå’Œé…é€æŒ‘æˆ°è¼ƒå¤§',
                        'å®—æ•™å½±éŸ¿åŠ›å¼·ï¼Œå¤©ä¸»æ•™æ–‡åŒ–æ·±åš',
                        'æ”¿åºœæ”¿ç­–è®ŠåŒ–é »ç¹ï¼Œæ³•è¦ç’°å¢ƒè¤‡é›œ'
                    ],
                    media_preferences: [
                        'Facebook æ˜¯æœ€ä¸»è¦çš„ç¤¾ç¾¤å¹³å°ï¼Œä½¿ç”¨ç‡è¶…é 90%',
                        'Instagram å’Œ TikTok åœ¨å¹´è¼•æ—ç¾¤ä¸­å¿«é€Ÿæˆé•·',
                        'YouTube ç”¨æ–¼å¨›æ¨‚å’Œæ•™è‚²å…§å®¹ï¼Œå½±éŸ¿åŠ›å·¨å¤§',
                        'Messenger å’Œ Viber æ˜¯ä¸»è¦é€šè¨Šå·¥å…·',
                        'LinkedIn åœ¨ B2B å’Œå°ˆæ¥­äººå£«ä¸­ä½¿ç”¨ç‡æå‡',
                        'å‚³çµ±åª’é«”ï¼ˆé›»è¦–ã€å»£æ’­ï¼‰ä»æœ‰é‡è¦å½±éŸ¿åŠ›',
                        'KOL å’Œç¶²ç´…è¡ŒéŠ·æ•ˆæœé¡¯è‘—ï¼Œä¿¡ä»»åº¦é«˜',
                        'æ‰‹æ©Ÿå„ªå…ˆçš„åª’é«”æ¶ˆè²»ç¿’æ…£',
                        'ç•¶åœ°èªè¨€ï¼ˆTagalogï¼‰å…§å®¹æ›´å—æ­¡è¿',
                        'å£ç¢‘è¡ŒéŠ·å’Œæ¨è–¦æ–‡åŒ–ç››è¡Œ'
                    ],
                    business_culture: [
                        'é—œä¿‚å°å‘æ–‡åŒ–ï¼Œå€‹äººé—œä¿‚å°å•†å‹™æˆåŠŸæ¥µç‚ºé‡è¦',
                        'éšç´šè§€å¿µæ˜é¡¯ï¼Œå°Šé‡æ¬Šå¨å’Œå¹´é•·è€…',
                        'é›†é«”ä¸»ç¾©æ–‡åŒ–ï¼Œé‡è¦–ç¾¤é«”å’Œè«§å’Œå…±è­˜',
                        'é–“æ¥æºé€šé¢¨æ ¼ï¼Œé¿å…ç›´æ¥æ‹’çµ•å’Œè¡çª',
                        '"Pakikipagkapwa" æ–‡åŒ– - é‡è¦–å…±åŒé«”å’Œé€£çµ',
                        'æ™‚é–“è§€å¿µè¼ƒå½ˆæ€§ï¼Œ"Filipino Time" ç¾è±¡æ™®é',
                        'å®¶åº­ä¼æ¥­æ–‡åŒ–æ¿ƒåšï¼Œæ±ºç­–å¸¸æ¶‰åŠå®¶åº­æˆå“¡',
                        'é‡è¦–é¢å­å’Œå°Šåš´ï¼Œå…¬é–‹æ‰¹è©•éœ€è¬¹æ…',
                        '"Utang na Loob" æ©æƒ…æ–‡åŒ–ï¼Œé‡è¦–å›å ±å’Œæ„Ÿæ©',
                        'å®—æ•™åƒ¹å€¼è§€å½±éŸ¿å•†æ¥­é“å¾·å’Œæ±ºç­–'
                    ],
                    b2b_strategy: [
                        'å»ºç«‹å€‹äººé—œä¿‚å’Œä¿¡ä»»ï¼ŒæŠ•è³‡æ™‚é–“åœ¨é—œä¿‚ç¶“ç‡Ÿä¸Š',
                        'å°Šé‡éšç´šçµæ§‹ï¼Œå¾é«˜å±¤é–‹å§‹å»ºç«‹é—œä¿‚',
                        'æä¾›æœ¬åœ°åŒ–çš„è§£æ±ºæ–¹æ¡ˆå’Œæ”¯æ´æœå‹™',
                        'é‡è¦–é•·æœŸåˆä½œé—œä¿‚ï¼Œé¿å…çŸ­æœŸäº¤æ˜“æ€ç¶­',
                        'è€ƒæ…®ç•¶åœ°åˆä½œå¤¥ä¼´æˆ–ä»£ç†å•†çš„é‡è¦æ€§',
                        'åƒèˆ‡ç•¶åœ°å•†æ¥­çµ„ç¹”å’Œç¤¾åœ˜æ´»å‹•',
                        'æä¾›åŸ¹è¨“å’Œèƒ½åŠ›å»ºè¨­æ”¯æ´',
                        'é©æ‡‰ç•¶åœ°çš„æ”¯ä»˜æ¢ä»¶å’Œè²¡å‹™æµç¨‹',
                        'é‡è¦–ç¤¾æœƒè²¬ä»»å’Œç¤¾å€è²¢ç»',
                        'æº–å‚™è²å¾‹è³“èªå’Œè‹±èªé›™èªææ–™'
                    ],
                    localization_recommendations: [
                        'ä½¿ç”¨è²å¾‹è³“è‹±èªå’Œç•¶åœ°ä¿šèªè¡¨é”',
                        'é©æ‡‰è²å¾‹è³“çš„ç¯€å‡æ—¥å’Œå®—æ•™æ…¶å…¸',
                        'è€ƒæ…®å³¶å¶¼ç¶“æ¿Ÿçš„ç‰©æµå’Œé…é€æŒ‘æˆ°',
                        'é©æ‡‰ç•¶åœ°çš„æ”¯ä»˜ç¿’æ…£ï¼ˆç¾é‡‘ã€åŒ¯æ¬¾ã€é›»å­éŒ¢åŒ…ï¼‰',
                        'é‡è¦–å®¶åº­å’Œç¤¾ç¾¤åƒ¹å€¼åœ¨è¡ŒéŠ·è¨Šæ¯ä¸­',
                        'é©æ‡‰è²å¾‹è³“çš„æ™‚é–“æ–‡åŒ–å’Œå·¥ä½œç¯€å¥',
                        'è€ƒæ…®é¢±é¢¨å­£ç¯€å’Œå¤©ç½å°ç‡Ÿé‹çš„å½±éŸ¿',
                        'å°Šé‡ç•¶åœ°å®—æ•™ç¿’ä¿—å’Œå‚³çµ±',
                        'å»ºç«‹æœ¬åœ°å®¢æœå’ŒæŠ€è¡“æ”¯æ´åœ˜éšŠ',
                        'é©æ‡‰è²å¾‹è³“çš„ç¨…å‹™å’Œæ³•è¦ç’°å¢ƒ'
                    ],
                    regulatory_compliance: [
                        'éµå®ˆè²å¾‹è³“æŠ•è³‡å§”å“¡æœƒ (BOI) çš„æŠ•è³‡æ³•è¦',
                        'ç¬¦åˆè²å¾‹è³“è­‰åˆ¸äº¤æ˜“å§”å“¡æœƒ (SEC) çš„å…¬å¸æ³•è¦æ±‚',
                        'éµå®ˆè²å¾‹è³“å‹å‹•æ³•å’Œæœ€ä½å·¥è³‡è¦å®š',
                        'ç¬¦åˆè²å¾‹è³“åœ‹ç¨…å±€ (BIR) çš„ç¨…å‹™è¦æ±‚',
                        'éµå®ˆæ•¸æ“šéš±ç§æ³• (Data Privacy Act of 2012)',
                        'ç¬¦åˆè²å¾‹è³“ä¸­å¤®éŠ€è¡Œ (BSP) çš„é‡‘èæ³•è¦',
                        'éµå®ˆç’°å¢ƒå’Œè‡ªç„¶è³‡æºéƒ¨çš„ç’°ä¿æ³•è¦',
                        'ç¬¦åˆé£Ÿå“è—¥å“ç®¡ç†å±€ (FDA) çš„ç”¢å“å®‰å…¨è¦æ±‚',
                        'éµå®ˆè²¿æ˜“å·¥æ¥­éƒ¨çš„æ¶ˆè²»è€…ä¿è­·æ³•è¦',
                        'ç¬¦åˆåæ´—éŒ¢æ³• (AMLA) çš„é‡‘èåˆè¦è¦æ±‚'
                    ],
                    competitive_analysis_template: {
                        'direct_competitors': [
                            'åˆ†æè²å¾‹è³“æœ¬åœŸå“ç‰Œå’Œä¼æ¥­',
                            'è©•ä¼°å…¶ä»–æ±å—äºåœ‹å®¶å“ç‰Œçš„å½±éŸ¿',
                            'åˆ†æè·¨åœ‹ä¼æ¥­åœ¨è²å¾‹è³“çš„è¡¨ç¾',
                            'è©•ä¼°ä¸­åœ‹å’ŒéŸ“åœ‹å“ç‰Œçš„ç«¶çˆ­å¨è„…'
                        ],
                        'competitive_advantages': [
                            'åƒ¹æ ¼å„ªå‹¢å’Œæˆæœ¬æ•ˆç›Š',
                            'æœ¬åœ°åŒ–ç¨‹åº¦å’Œæ–‡åŒ–é©æ‡‰',
                            'å“ç‰ŒçŸ¥ååº¦å’Œä¿¡ä»»åº¦',
                            'é€šè·¯è¦†è“‹å’Œå¯åŠæ€§',
                            'æœå‹™å“è³ªå’Œå®¢æˆ¶æ”¯æ´'
                        ],
                        'market_positioning': [
                            'å¹³åƒ¹å„ªè³ªå®šä½',
                            'å®¶åº­å‹å–„å®šä½',
                            'ç¤¾ç¾¤ä¿¡ä»»å®šä½',
                            'å‰µæ–°ç§‘æŠ€å®šä½',
                            'ç¤¾æœƒè²¬ä»»å®šä½'
                        ]
                    },
                    success_case_database: [
                        'Jollibee åœ¨å¿«é¤æ¥­çš„æœ¬åœŸåŒ–æˆåŠŸ',
                        'GCash åœ¨æ•¸ä½æ”¯ä»˜é ˜åŸŸçš„çªç ´',
                        'Shopee åœ¨é›»å•†å¸‚å ´çš„é ˜å…ˆåœ°ä½',
                        'Globe å’Œ Smart åœ¨é›»ä¿¡æ¥­çš„é›™é ­ç«¶çˆ­',
                        'Ayala é›†åœ˜åœ¨å¤šå…ƒåŒ–æŠ•è³‡çš„æˆåŠŸ',
                        'SM é›†åœ˜åœ¨é›¶å”®å’Œæˆ¿åœ°ç”¢çš„éœ¸ä¸»åœ°ä½',
                        'Grab åœ¨å…±äº«ç¶“æ¿Ÿçš„å¸‚å ´æ»²é€',
                        'Lazada åœ¨é›»å­å•†å‹™çš„æ—©æœŸå¸ƒå±€'
                    ],
                    roi_prediction_model: {
                        'short_term_roi': '6-12 å€‹æœˆï¼Œé æœŸ ROI: 20-35%',
                        'medium_term_roi': '1-2 å¹´ï¼Œé æœŸ ROI: 40-60%',
                        'long_term_roi': '3-5 å¹´ï¼Œé æœŸ ROI: 60-100%',
                        'key_factors': [
                            'æœ¬åœ°åŒ–ç­–ç•¥å’Œæ–‡åŒ–é©æ‡‰ç¨‹åº¦',
                            'é€šè·¯å»ºç«‹å’Œå¸‚å ´æ»²é€é€Ÿåº¦',
                            'å“ç‰Œä¿¡ä»»åº¦å»ºç«‹å’Œå£ç¢‘å‚³æ’­',
                            'åƒ¹æ ¼ç­–ç•¥å’Œå¸‚å ´æ¥å—åº¦',
                            'æ”¿ç­–ç’°å¢ƒç©©å®šæ€§å’Œæ³•è¦é¢¨éšª'
                        ]
                    }
                }
            };

            return insights[market] || insights['taiwan'];
        }

        // é¡¯ç¤ºå¸‚å ´æ´å¯Ÿ
        function showMarketInsights(insights) {
            const existingInsights = document.getElementById('market-insights');
            if (existingInsights) {
                existingInsights.remove();
            }

            // æª¢æŸ¥æ˜¯å¦ç‚ºå¾·åœ‹æˆ–è²å¾‹è³“å¸‚å ´ï¼Œå¦‚æœæ˜¯å‰‡é¡¯ç¤ºå®Œæ•´æ·±åº¦åˆ†æ
            const isGermanyMarket = insights.title && insights.title.includes('å¾·åœ‹');
            const isPhilippinesMarket = insights.title && insights.title.includes('è²å¾‹è³“');
            
            let insightsHtml = `
                <div id="market-insights" class="mt-4 p-4 bg-indigo-50 border-l-4 border-indigo-400 rounded-lg">
                    <div class="flex items-start">
                        <div class="flex-shrink-0">
                            <svg class="h-5 w-5 text-indigo-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path>
                            </svg>
                        </div>
                        <div class="ml-3 flex-1">
                            <h4 class="text-sm font-medium text-indigo-800">${insights.title}</h4>
                            <div class="mt-2 text-sm text-indigo-700">
                                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                    <div>
                                        <h5 class="font-medium mb-1">å¸‚å ´ç‰¹å¾µ</h5>
                                        <ul class="list-disc list-inside space-y-1">
                                            ${insights.characteristics.map(char => `<li>${char}</li>`).join('')}
                                        </ul>
                                    </div>
                                    <div>
                                        <h5 class="font-medium mb-1">åª’é«”åå¥½</h5>
                                        <ul class="list-disc list-inside space-y-1">
                                            ${insights.media_preferences.map(pref => `<li>${pref}</li>`).join('')}
                                        </ul>
                                    </div>
                                    <div>
                                        <h5 class="font-medium mb-1">å•†æ¥­æ–‡åŒ–</h5>
                                        <ul class="list-disc list-inside space-y-1">
                                            ${insights.business_culture.map(culture => `<li>${culture}</li>`).join('')}
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;

            // å¦‚æœæ˜¯å¾·åœ‹æˆ–è²å¾‹è³“å¸‚å ´ï¼Œæ·»åŠ é¡å¤–çš„æ·±åº¦åˆ†æå…§å®¹
            if (isGermanyMarket && insights.b2b_strategy) {
                insightsHtml += `
                    <div id="germany-deep-insights" class="mt-4 space-y-4">
                        <!-- B2B ç­–ç•¥å»ºè­° -->
                        <div class="p-4 bg-blue-50 border-l-4 border-blue-400 rounded-lg">
                            <h5 class="font-medium text-blue-800 mb-2">ğŸ‡©ğŸ‡ª å¾·åœ‹å¸‚å ´ B2B ç­–ç•¥å»ºè­°</h5>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <ul class="list-disc list-inside space-y-1 text-sm text-blue-700">
                                    ${insights.b2b_strategy.slice(0, 5).map(strategy => `<li>${strategy}</li>`).join('')}
                                </ul>
                                <ul class="list-disc list-inside space-y-1 text-sm text-blue-700">
                                    ${insights.b2b_strategy.slice(5).map(strategy => `<li>${strategy}</li>`).join('')}
                                </ul>
                            </div>
                        </div>

                        <!-- æœ¬åœ°åŒ–å»ºè­° -->
                        <div class="p-4 bg-green-50 border-l-4 border-green-400 rounded-lg">
                            <h5 class="font-medium text-green-800 mb-2">ğŸŒ å¾·åœ‹å¸‚å ´æœ¬åœ°åŒ–å»ºè­°</h5>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <ul class="list-disc list-inside space-y-1 text-sm text-green-700">
                                    ${insights.localization_recommendations.slice(0, 5).map(rec => `<li>${rec}</li>`).join('')}
                                </ul>
                                <ul class="list-disc list-inside space-y-1 text-sm text-green-700">
                                    ${insights.localization_recommendations.slice(5).map(rec => `<li>${rec}</li>`).join('')}
                                </ul>
                            </div>
                        </div>

                        <!-- æ³•è¦åˆè¦æ€§ -->
                        <div class="p-4 bg-red-50 border-l-4 border-red-400 rounded-lg">
                            <h5 class="font-medium text-red-800 mb-2">âš–ï¸ å¾·åœ‹æ³•è¦åˆè¦æ€§è¦æ±‚</h5>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <ul class="list-disc list-inside space-y-1 text-sm text-red-700">
                                    ${insights.regulatory_compliance.slice(0, 5).map(compliance => `<li>${compliance}</li>`).join('')}
                                </ul>
                                <ul class="list-disc list-inside space-y-1 text-sm text-red-700">
                                    ${insights.regulatory_compliance.slice(5).map(compliance => `<li>${compliance}</li>`).join('')}
                                </ul>
                            </div>
                        </div>

                        <!-- ç«¶çˆ­åˆ†ææ¨¡æ¿ -->
                        <div class="p-4 bg-purple-50 border-l-4 border-purple-400 rounded-lg">
                            <h5 class="font-medium text-purple-800 mb-2">ğŸ¯ å¾·åœ‹å¸‚å ´ç«¶çˆ­åˆ†ææ¨¡æ¿</h5>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                <div>
                                    <h6 class="font-medium text-purple-700 mb-1">ç›´æ¥ç«¶çˆ­å°æ‰‹</h6>
                                    <ul class="list-disc list-inside space-y-1 text-sm text-purple-600">
                                        ${insights.competitive_analysis_template.direct_competitors.map(comp => `<li>${comp}</li>`).join('')}
                                    </ul>
                                </div>
                                <div>
                                    <h6 class="font-medium text-purple-700 mb-1">ç«¶çˆ­å„ªå‹¢</h6>
                                    <ul class="list-disc list-inside space-y-1 text-sm text-purple-600">
                                        ${insights.competitive_analysis_template.competitive_advantages.map(adv => `<li>${adv}</li>`).join('')}
                                    </ul>
                                </div>
                                <div>
                                    <h6 class="font-medium text-purple-700 mb-1">å¸‚å ´å®šä½</h6>
                                    <ul class="list-disc list-inside space-y-1 text-sm text-purple-600">
                                        ${insights.competitive_analysis_template.market_positioning.map(pos => `<li>${pos}</li>`).join('')}
                                    </ul>
                                </div>
                            </div>
                        </div>

                        <!-- æˆåŠŸæ¡ˆä¾‹è³‡æ–™åº« -->
                        <div class="p-4 bg-yellow-50 border-l-4 border-yellow-400 rounded-lg">
                            <h5 class="font-medium text-yellow-800 mb-2">ğŸ† å¾·åœ‹å¸‚å ´æˆåŠŸæ¡ˆä¾‹è³‡æ–™åº«</h5>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <ul class="list-disc list-inside space-y-1 text-sm text-yellow-700">
                                    ${insights.success_case_database.slice(0, 4).map(case_study => `<li>${case_study}</li>`).join('')}
                                </ul>
                                <ul class="list-disc list-inside space-y-1 text-sm text-yellow-700">
                                    ${insights.success_case_database.slice(4).map(case_study => `<li>${case_study}</li>`).join('')}
                                </ul>
                            </div>
                        </div>

                        <!-- ROI é æ¸¬æ¨¡å‹ -->
                        <div class="p-4 bg-indigo-50 border-l-4 border-indigo-400 rounded-lg">
                            <h5 class="font-medium text-indigo-800 mb-2">ğŸ“Š å¾·åœ‹å¸‚å ´ ROI é æ¸¬æ¨¡å‹</h5>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <h6 class="font-medium text-indigo-700 mb-2">é æœŸæŠ•è³‡å›å ±</h6>
                                    <ul class="space-y-2 text-sm text-indigo-600">
                                        <li><strong>çŸ­æœŸ (6-12å€‹æœˆ):</strong> ${insights.roi_prediction_model.short_term_roi}</li>
                                        <li><strong>ä¸­æœŸ (1-2å¹´):</strong> ${insights.roi_prediction_model.medium_term_roi}</li>
                                        <li><strong>é•·æœŸ (3-5å¹´):</strong> ${insights.roi_prediction_model.long_term_roi}</li>
                                    </ul>
                                </div>
                                <div>
                                    <h6 class="font-medium text-indigo-700 mb-2">é—œéµå½±éŸ¿å› ç´ </h6>
                                    <ul class="list-disc list-inside space-y-1 text-sm text-indigo-600">
                                        ${insights.roi_prediction_model.key_factors.map(factor => `<li>${factor}</li>`).join('')}
                                    </ul>
                                </div>
                            </div>
                        </div>

                        <!-- å¾·åœ‹å¸‚å ´å°ˆç”¨å·¥å…· -->
                        <div class="p-4 bg-gray-50 border-l-4 border-gray-400 rounded-lg">
                            <h5 class="font-medium text-gray-800 mb-3">ğŸ› ï¸ å¾·åœ‹å¸‚å ´å°ˆç”¨åˆ†æå·¥å…·</h5>
                            
                            <!-- ç­–ç•¥å»ºè­°ç”Ÿæˆå™¨ -->
                            <div class="mb-4">
                                <h6 class="font-medium text-gray-700 mb-2">ğŸ¯ ç­–ç•¥å»ºè­°ç”Ÿæˆå™¨</h6>
                                <div class="flex gap-2 mb-2">
                                    <select id="german-strategy-type" class="px-3 py-1 text-sm border border-gray-300 rounded">
                                        <option value="b2b">B2B ç­–ç•¥</option>
                                        <option value="localization">æœ¬åœ°åŒ–ç­–ç•¥</option>
                                        <option value="compliance">åˆè¦ç­–ç•¥</option>
                                        <option value="marketing">è¡ŒéŠ·ç­–ç•¥</option>
                                    </select>
                                    <button onclick="generateGermanStrategy()" class="px-4 py-1 bg-blue-600 text-white text-sm rounded hover:bg-blue-700">
                                        ç”Ÿæˆå»ºè­°
                                    </button>
                                </div>
                                <div id="german-strategy-output" class="p-3 bg-white border border-gray-200 rounded text-sm text-gray-700 min-h-[60px]">
                                    é¸æ“‡ç­–ç•¥é¡å‹ä¸¦é»æ“Šç”Ÿæˆå»ºè­°...
                                </div>
                            </div>

                            <!-- å¾·åœ‹å¸‚å ´åˆ†ææª¢æŸ¥æ¸…å–® -->
                            <div class="mb-4">
                                <h6 class="font-medium text-gray-700 mb-2">âœ… å¾·åœ‹å¸‚å ´é€²å…¥æª¢æŸ¥æ¸…å–®</h6>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-2">
                                    <label class="flex items-center space-x-2">
                                        <input type="checkbox" class="german-checklist" value="legal"> 
                                        <span class="text-sm">æ³•å¾‹åˆè¦æ€§ç¢ºèª</span>
                                    </label>
                                    <label class="flex items-center space-x-2">
                                        <input type="checkbox" class="german-checklist" value="localization"> 
                                        <span class="text-sm">å¾·æ–‡æœ¬åœ°åŒ–å®Œæˆ</span>
                                    </label>
                                    <label class="flex items-center space-x-2">
                                        <input type="checkbox" class="german-checklist" value="certification"> 
                                        <span class="text-sm">æŠ€è¡“èªè­‰å–å¾—</span>
                                    </label>
                                    <label class="flex items-center space-x-2">
                                        <input type="checkbox" class="german-checklist" value="partnership"> 
                                        <span class="text-sm">æœ¬åœ°åˆä½œå¤¥ä¼´</span>
                                    </label>
                                    <label class="flex items-center space-x-2">
                                        <input type="checkbox" class="german-checklist" value="cultural"> 
                                        <span class="text-sm">æ–‡åŒ–é©æ‡‰æ€§è©•ä¼°</span>
                                    </label>
                                    <label class="flex items-center space-x-2">
                                        <input type="checkbox" class="german-checklist" value="pricing"> 
                                        <span class="text-sm">å®šåƒ¹ç­–ç•¥èª¿æ•´</span>
                                    </label>
                                </div>
                                <button onclick="checkGermanMarketReadiness()" class="mt-2 px-4 py-1 bg-green-600 text-white text-sm rounded hover:bg-green-700">
                                    æª¢æŸ¥æº–å‚™åº¦
                                </button>
                                <div id="german-readiness-score" class="mt-2 text-sm"></div>
                            </div>

                            <!-- å¾·åœ‹å¸‚å ´è¶¨å‹¢åˆ†æ -->
                            <div>
                                <h6 class="font-medium text-gray-700 mb-2">ğŸ“ˆ å¾·åœ‹å¸‚å ´è¶¨å‹¢åˆ†æ</h6>
                                <div class="grid grid-cols-1 md:grid-cols-3 gap-3 text-xs">
                                    <div class="p-2 bg-blue-100 rounded">
                                        <div class="font-medium text-blue-800">æ•¸ä½åŒ–è¶¨å‹¢</div>
                                        <div class="text-blue-600">å·¥æ¥­4.0 åŠ é€Ÿ</div>
                                    </div>
                                    <div class="p-2 bg-green-100 rounded">
                                        <div class="font-medium text-green-800">æ°¸çºŒç™¼å±•</div>
                                        <div class="text-green-600">ç¢³ä¸­å’Œç›®æ¨™</div>
                                    </div>
                                    <div class="p-2 bg-purple-100 rounded">
                                        <div class="font-medium text-purple-800">å‰µæ–°æŠ•è³‡</div>
                                        <div class="text-purple-600">ç ”ç™¼æ”¯å‡ºå¢åŠ </div>
                                    </div>
                                </div>
                            </div>

                            <!-- å¾·åœ‹å¸‚å ´é€²å…¥ç­–ç•¥è¦åŠƒå™¨ -->
                            <div class="mt-4 p-3 bg-gradient-to-r from-blue-50 to-indigo-50 border border-blue-200 rounded-lg">
                                <h6 class="font-medium text-blue-800 mb-3">ğŸš€ å¾·åœ‹å¸‚å ´é€²å…¥ç­–ç•¥è¦åŠƒå™¨</h6>
                                <div class="space-y-3">
                                    <div>
                                        <label class="block text-xs font-medium text-blue-700 mb-1">ç”¢å“/æœå‹™é¡å‹</label>
                                        <select id="german-product-type" class="w-full px-2 py-1 text-xs border border-blue-300 rounded">
                                            <option value="b2b-software">B2B è»Ÿé«”/æŠ€è¡“</option>
                                            <option value="manufacturing">è£½é€ æ¥­è¨­å‚™</option>
                                            <option value="consulting">è«®è©¢æœå‹™</option>
                                            <option value="ecommerce">é›»å­å•†å‹™</option>
                                            <option value="healthcare">é†«ç™‚å¥åº·</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="block text-xs font-medium text-blue-700 mb-1">é€²å…¥æ¨¡å¼</label>
                                        <select id="german-entry-mode" class="w-full px-2 py-1 text-xs border border-blue-300 rounded">
                                            <option value="direct">ç›´æ¥é€²å…¥</option>
                                            <option value="partnership">åˆè³‡/åˆä½œ</option>
                                            <option value="acquisition">æ”¶è³¼ç¾æœ‰ä¼æ¥­</option>
                                            <option value="licensing">æˆæ¬Šç¶“ç‡Ÿ</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="block text-xs font-medium text-blue-700 mb-1">æ™‚é–“æ¡†æ¶</label>
                                        <select id="german-timeline" class="w-full px-2 py-1 text-xs border border-blue-300 rounded">
                                            <option value="6months">6å€‹æœˆå…§</option>
                                            <option value="1year">1å¹´å…§</option>
                                            <option value="2years">2å¹´å…§</option>
                                            <option value="3years">3å¹´å…§</option>
                                        </select>
                                    </div>
                                    <button onclick="generateGermanEntryStrategy()" class="w-full px-3 py-2 bg-blue-600 text-white text-sm rounded hover:bg-blue-700">
                                        ç”Ÿæˆé€²å…¥ç­–ç•¥
                                    </button>
                                </div>
                                <div id="german-entry-strategy-output" class="mt-3 p-3 bg-white border border-blue-200 rounded text-xs text-blue-700 min-h-[80px]">
                                    å¡«å¯«åƒæ•¸ä¸¦é»æ“Šç”Ÿæˆé€²å…¥ç­–ç•¥...
                                </div>
                            </div>

                            <!-- å¾·åœ‹å¸‚å ´å ±å‘Šç”Ÿæˆå™¨ -->
                            <div class="mt-4 p-3 bg-gradient-to-r from-green-50 to-emerald-50 border border-green-200 rounded-lg">
                                <h6 class="font-medium text-green-800 mb-3">ğŸ“Š å¾·åœ‹å¸‚å ´å ±å‘Šç”Ÿæˆå™¨</h6>
                                <div class="space-y-3">
                                    <div class="grid grid-cols-2 gap-2">
                                        <label class="flex items-center space-x-2">
                                            <input type="checkbox" id="german-report-market" value="market" checked> 
                                            <span class="text-xs">å¸‚å ´åˆ†æ</span>
                                        </label>
                                        <label class="flex items-center space-x-2">
                                            <input type="checkbox" id="german-report-competition" value="competition" checked> 
                                            <span class="text-xs">ç«¶çˆ­åˆ†æ</span>
                                        </label>
                                        <label class="flex items-center space-x-2">
                                            <input type="checkbox" id="german-report-strategy" value="strategy" checked> 
                                            <span class="text-xs">ç­–ç•¥å»ºè­°</span>
                                        </label>
                                        <label class="flex items-center space-x-2">
                                            <input type="checkbox" id="german-report-compliance" value="compliance" checked> 
                                            <span class="text-xs">åˆè¦è¦æ±‚</span>
                                        </label>
                                    </div>
                                    <div class="flex gap-2">
                                        <button onclick="generateGermanReport()" class="flex-1 px-3 py-2 bg-green-600 text-white text-sm rounded hover:bg-green-700">
                                            ç”Ÿæˆå ±å‘Š
                                        </button>
                                        <button onclick="exportGermanReport()" class="px-3 py-2 bg-emerald-600 text-white text-sm rounded hover:bg-emerald-700">
                                            å°å‡ºPDF
                                        </button>
                                    </div>
                                </div>
                                <div id="german-report-output" class="mt-3 p-3 bg-white border border-green-200 rounded text-xs text-green-700 min-h-[100px] max-h-[200px] overflow-y-auto">
                                    é¸æ“‡å ±å‘Šå…§å®¹ä¸¦é»æ“Šç”Ÿæˆå ±å‘Š...
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }

            // å¦‚æœæ˜¯è²å¾‹è³“å¸‚å ´ï¼Œæ·»åŠ é¡å¤–çš„æ·±åº¦åˆ†æå…§å®¹
            if (isPhilippinesMarket && insights.b2b_strategy) {
                insightsHtml += `
                    <div id="philippines-deep-insights" class="mt-4 space-y-4">
                        <!-- B2B ç­–ç•¥å»ºè­° -->
                        <div class="p-4 bg-blue-50 border-l-4 border-blue-400 rounded-lg">
                            <h5 class="font-medium text-blue-800 mb-2">ğŸ‡µğŸ‡­ è²å¾‹è³“å¸‚å ´ B2B ç­–ç•¥å»ºè­°</h5>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <ul class="list-disc list-inside space-y-1 text-sm text-blue-700">
                                    ${insights.b2b_strategy.slice(0, 5).map(strategy => `<li>${strategy}</li>`).join('')}
                                </ul>
                                <ul class="list-disc list-inside space-y-1 text-sm text-blue-700">
                                    ${insights.b2b_strategy.slice(5).map(strategy => `<li>${strategy}</li>`).join('')}
                                </ul>
                            </div>
                        </div>

                        <!-- æœ¬åœ°åŒ–å»ºè­° -->
                        <div class="p-4 bg-green-50 border-l-4 border-green-400 rounded-lg">
                            <h5 class="font-medium text-green-800 mb-2">ğŸŒ´ è²å¾‹è³“å¸‚å ´æœ¬åœ°åŒ–å»ºè­°</h5>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <ul class="list-disc list-inside space-y-1 text-sm text-green-700">
                                    ${insights.localization_recommendations.slice(0, 5).map(rec => `<li>${rec}</li>`).join('')}
                                </ul>
                                <ul class="list-disc list-inside space-y-1 text-sm text-green-700">
                                    ${insights.localization_recommendations.slice(5).map(rec => `<li>${rec}</li>`).join('')}
                                </ul>
                            </div>
                        </div>

                        <!-- æ³•è¦åˆè¦æ€§ -->
                        <div class="p-4 bg-orange-50 border-l-4 border-orange-400 rounded-lg">
                            <h5 class="font-medium text-orange-800 mb-2">âš–ï¸ è²å¾‹è³“å¸‚å ´æ³•è¦åˆè¦æ€§</h5>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <ul class="list-disc list-inside space-y-1 text-sm text-orange-700">
                                    ${insights.regulatory_compliance.slice(0, 5).map(req => `<li>${req}</li>`).join('')}
                                </ul>
                                <ul class="list-disc list-inside space-y-1 text-sm text-orange-700">
                                    ${insights.regulatory_compliance.slice(5).map(req => `<li>${req}</li>`).join('')}
                                </ul>
                            </div>
                        </div>

                        <!-- æˆåŠŸæ¡ˆä¾‹è³‡æ–™åº« -->
                        <div class="p-4 bg-yellow-50 border-l-4 border-yellow-400 rounded-lg">
                            <h5 class="font-medium text-yellow-800 mb-2">ğŸ† è²å¾‹è³“å¸‚å ´æˆåŠŸæ¡ˆä¾‹è³‡æ–™åº«</h5>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <ul class="list-disc list-inside space-y-1 text-sm text-yellow-700">
                                    ${insights.success_case_database.slice(0, 4).map(case_study => `<li>${case_study}</li>`).join('')}
                                </ul>
                                <ul class="list-disc list-inside space-y-1 text-sm text-yellow-700">
                                    ${insights.success_case_database.slice(4).map(case_study => `<li>${case_study}</li>`).join('')}
                                </ul>
                            </div>
                        </div>

                        <!-- ROI é æ¸¬æ¨¡å‹ -->
                        <div class="p-4 bg-indigo-50 border-l-4 border-indigo-400 rounded-lg">
                            <h5 class="font-medium text-indigo-800 mb-2">ğŸ“Š è²å¾‹è³“å¸‚å ´ ROI é æ¸¬æ¨¡å‹</h5>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <h6 class="font-medium text-indigo-700 mb-2">é æœŸæŠ•è³‡å›å ±</h6>
                                    <ul class="space-y-2 text-sm text-indigo-600">
                                        <li><strong>çŸ­æœŸ (6-12å€‹æœˆ):</strong> ${insights.roi_prediction_model.short_term_roi}</li>
                                        <li><strong>ä¸­æœŸ (1-2å¹´):</strong> ${insights.roi_prediction_model.medium_term_roi}</li>
                                        <li><strong>é•·æœŸ (3-5å¹´):</strong> ${insights.roi_prediction_model.long_term_roi}</li>
                                    </ul>
                                </div>
                                <div>
                                    <h6 class="font-medium text-indigo-700 mb-2">é—œéµæˆåŠŸå› ç´ </h6>
                                    <ul class="list-disc list-inside space-y-1 text-sm text-indigo-600">
                                        ${insights.roi_prediction_model.key_factors.map(factor => `<li>${factor}</li>`).join('')}
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }

            const primaryMarketField = document.getElementById('primaryMarket');
            if (primaryMarketField) {
                primaryMarketField.parentElement.insertAdjacentHTML('afterend', insightsHtml);
            }
        }

        // å¾·åœ‹å¸‚å ´ç­–ç•¥å»ºè­°ç”Ÿæˆå™¨
        function generateGermanStrategy() {
            const strategyType = document.getElementById('german-strategy-type').value;
            const output = document.getElementById('german-strategy-output');
            
            const strategies = {
                b2b: [
                    'å»ºç«‹æŠ€è¡“å°ˆå®¶åœ˜éšŠï¼Œæä¾›æ·±åº¦æŠ€è¡“æ”¯æ´',
                    'åƒèˆ‡å¾·åœ‹å·¥æ¥­å±•è¦½æœƒ (å¦‚ Hannover Messe)',
                    'èˆ‡å¾·åœ‹æŠ€è¡“å¤§å­¸å»ºç«‹åˆä½œé—œä¿‚',
                    'æä¾›å¾·èªæŠ€è¡“æ–‡æª”å’ŒåŸ¹è¨“ææ–™',
                    'å»ºç«‹æœ¬åœ°æŠ€è¡“æ”¯æ´ä¸­å¿ƒ'
                ],
                localization: [
                    'è˜è«‹å¾·èªæ¯èªè€…é€²è¡Œå…§å®¹å¯©æ ¸',
                    'é©æ‡‰å¾·åœ‹æ–‡åŒ–ç¿’ä¿—å’Œå•†æ¥­ç¦®å„€',
                    'èª¿æ•´ç”¢å“åŒ…è£ç¬¦åˆå¾·åœ‹æ¨™æº–',
                    'æä¾›å¾·èªå®¢æˆ¶æœå‹™å’Œæ”¯æ´',
                    'è€ƒæ…®å¾·åœ‹å€åŸŸå·®ç•° (å—åŒ—å·®ç•°)'
                ],
                compliance: [
                    'ç¢ºä¿ç¬¦åˆ EU GDPR æ•¸æ“šä¿è­·æ³•è¦',
                    'å–å¾—å¾·åœ‹æŠ€è¡“èªè­‰ (å¦‚ TÃœV, VDE)',
                    'éµå®ˆå¾·åœ‹å‹å‹•æ³•å’Œç¨…å‹™è¦å®š',
                    'ç¬¦åˆå¾·åœ‹ç’°ä¿æ¨™æº–å’Œæ³•è¦',
                    'å»ºç«‹åˆè¦æ€§ç›£æ§æ©Ÿåˆ¶'
                ],
                marketing: [
                    'ä½¿ç”¨ LinkedIn é€²è¡Œ B2B è¡ŒéŠ·',
                    'åœ¨å°ˆæ¥­åª’é«”æŠ•æ”¾å»£å‘Š',
                    'å»ºç«‹å¾·åœ‹æœ¬åœ°ç¤¾ç¾¤åª’é«”å­˜åœ¨',
                    'èˆ‰è¾¦å¾·åœ‹æœ¬åœ°æ´»å‹•å’Œç ”è¨æœƒ',
                    'èˆ‡å¾·åœ‹å½±éŸ¿è€…åˆä½œæ¨å»£'
                ]
            };
            
            const selectedStrategies = strategies[strategyType];
            const randomStrategies = selectedStrategies.sort(() => 0.5 - Math.random()).slice(0, 3);
            
            output.innerHTML = `
                <div class="font-medium text-gray-800 mb-2">ğŸ¯ ${strategyType.toUpperCase()} ç­–ç•¥å»ºè­°:</div>
                <ul class="list-disc list-inside space-y-1">
                    ${randomStrategies.map(strategy => `<li>${strategy}</li>`).join('')}
                </ul>
            `;
        }

        // æª¢æŸ¥å¾·åœ‹å¸‚å ´æº–å‚™åº¦
        function checkGermanMarketReadiness() {
            const checkboxes = document.querySelectorAll('.german-checklist:checked');
            const totalCheckboxes = document.querySelectorAll('.german-checklist').length;
            const readinessScore = Math.round((checkboxes.length / totalCheckboxes) * 100);
            
            const scoreElement = document.getElementById('german-readiness-score');
            let scoreClass = 'text-red-600';
            let scoreText = 'éœ€è¦æ›´å¤šæº–å‚™';
            
            if (readinessScore >= 80) {
                scoreClass = 'text-green-600';
                scoreText = 'æº–å‚™å……åˆ†ï¼Œå¯ä»¥é€²å…¥å¸‚å ´';
            } else if (readinessScore >= 60) {
                scoreClass = 'text-yellow-600';
                scoreText = 'åŸºæœ¬æº–å‚™å®Œæˆï¼Œå»ºè­°é€²ä¸€æ­¥å®Œå–„';
            }
            
            scoreElement.innerHTML = `
                <div class="font-medium ${scoreClass}">
                    æº–å‚™åº¦: ${readinessScore}% - ${scoreText}
                </div>
                <div class="text-xs text-gray-600 mt-1">
                    å·²å®Œæˆ ${checkboxes.length}/${totalCheckboxes} é …æª¢æŸ¥
                </div>
            `;
        }

        // ç”Ÿæˆå¾·åœ‹å¸‚å ´é€²å…¥ç­–ç•¥
        function generateGermanEntryStrategy() {
            const productType = document.getElementById('german-product-type').value;
            const entryMode = document.getElementById('german-entry-mode').value;
            const timeline = document.getElementById('german-timeline').value;
            const output = document.getElementById('german-entry-strategy-output');
            
            const strategies = {
                'b2b-software': {
                    'direct': 'å»ºç«‹å¾·åœ‹å­å…¬å¸ï¼Œçµ„å»ºæœ¬åœ°éŠ·å”®å’ŒæŠ€è¡“åœ˜éšŠ',
                    'partnership': 'èˆ‡å¾·åœ‹ç³»çµ±æ•´åˆå•†åˆä½œï¼Œæä¾›æœ¬åœ°åŒ–æ”¯æ´',
                    'acquisition': 'æ”¶è³¼å¾·åœ‹æœ¬åœŸè»Ÿé«”å…¬å¸ï¼Œå¿«é€Ÿç²å¾—å¸‚å ´ä»½é¡',
                    'licensing': 'æˆæ¬Šå¾·åœ‹åˆä½œå¤¥ä¼´é€²è¡Œæœ¬åœ°åŒ–é–‹ç™¼å’ŒéŠ·å”®'
                },
                'manufacturing': {
                    'direct': 'åœ¨å¾·åœ‹å»ºç«‹ç”Ÿç”¢åŸºåœ°ï¼Œç¬¦åˆå¾·åœ‹è£½é€ æ¨™æº–',
                    'partnership': 'èˆ‡å¾·åœ‹è£½é€ å•†åˆä½œï¼Œå…±äº«æŠ€è¡“å’Œå¸‚å ´è³‡æº',
                    'acquisition': 'æ”¶è³¼å¾·åœ‹è£½é€ ä¼æ¥­ï¼Œç²å¾—æŠ€è¡“å’Œèªè­‰',
                    'licensing': 'æˆæ¬Šå¾·åœ‹è£½é€ å•†ä½¿ç”¨æŠ€è¡“ï¼Œæ”¶å–æˆæ¬Šè²»'
                },
                'consulting': {
                    'direct': 'å»ºç«‹å¾·åœ‹è«®è©¢è¾¦å…¬å®¤ï¼Œè˜è«‹æœ¬åœ°å°ˆå®¶',
                    'partnership': 'èˆ‡å¾·åœ‹è«®è©¢å…¬å¸åˆä½œï¼Œæä¾›å°ˆæ¥­æœå‹™',
                    'acquisition': 'æ”¶è³¼å¾·åœ‹è«®è©¢å…¬å¸ï¼Œå¿«é€Ÿé€²å…¥å¸‚å ´',
                    'licensing': 'æˆæ¬Šå¾·åœ‹åˆä½œå¤¥ä¼´ä½¿ç”¨è«®è©¢æ–¹æ³•å’Œå·¥å…·'
                },
                'ecommerce': {
                    'direct': 'å»ºç«‹å¾·åœ‹é›»å•†å¹³å°ï¼Œæä¾›æœ¬åœ°åŒ–æœå‹™',
                    'partnership': 'èˆ‡å¾·åœ‹é›»å•†å¹³å°åˆä½œï¼Œå…±äº«ç”¨æˆ¶åŸºç¤',
                    'acquisition': 'æ”¶è³¼å¾·åœ‹é›»å•†ä¼æ¥­ï¼Œç²å¾—ç”¨æˆ¶å’Œå“ç‰Œ',
                    'licensing': 'æˆæ¬Šå¾·åœ‹åˆä½œå¤¥ä¼´ä½¿ç”¨é›»å•†æŠ€è¡“å’Œå“ç‰Œ'
                },
                'healthcare': {
                    'direct': 'å»ºç«‹å¾·åœ‹é†«ç™‚è¨­å‚™å…¬å¸ï¼Œç¬¦åˆæ­ç›Ÿæ¨™æº–',
                    'partnership': 'èˆ‡å¾·åœ‹é†«ç™‚æ©Ÿæ§‹åˆä½œï¼Œé€²è¡Œè‡¨åºŠè©¦é©—',
                    'acquisition': 'æ”¶è³¼å¾·åœ‹é†«ç™‚ä¼æ¥­ï¼Œç²å¾—èªè­‰å’Œæ¸ é“',
                    'licensing': 'æˆæ¬Šå¾·åœ‹é†«ç™‚ä¼æ¥­ä½¿ç”¨æŠ€è¡“å’Œå°ˆåˆ©'
                }
            };
            
            const timelineStrategies = {
                '6months': 'å¿«é€Ÿé€²å…¥ç­–ç•¥ï¼šå»ºç«‹ä»£è¡¨è™•ï¼Œå°‹æ‰¾åˆä½œå¤¥ä¼´',
                '1year': 'ç©©å¥é€²å…¥ç­–ç•¥ï¼šå®Œæˆæ³•å¾‹è¨»å†Šï¼Œçµ„å»ºæ ¸å¿ƒåœ˜éšŠ',
                '2years': 'å…¨é¢é€²å…¥ç­–ç•¥ï¼šå»ºç«‹å®Œæ•´æ¥­å‹™é«”ç³»ï¼Œé–‹å±•æœ¬åœ°è¡ŒéŠ·',
                '3years': 'é•·æœŸç™¼å±•ç­–ç•¥ï¼šå»ºç«‹ç ”ç™¼ä¸­å¿ƒï¼Œé€²è¡Œæ·±åº¦æœ¬åœ°åŒ–'
            };
            
            const selectedStrategy = strategies[productType][entryMode];
            const timelineStrategy = timelineStrategies[timeline];
            
            output.innerHTML = `
                <div class="font-medium text-blue-800 mb-2">ğŸš€ å¾·åœ‹å¸‚å ´é€²å…¥ç­–ç•¥:</div>
                <div class="space-y-2">
                    <div><strong>ç”¢å“é¡å‹:</strong> ${document.getElementById('german-product-type').options[document.getElementById('german-product-type').selectedIndex].text}</div>
                    <div><strong>é€²å…¥æ¨¡å¼:</strong> ${selectedStrategy}</div>
                    <div><strong>æ™‚é–“æ¡†æ¶:</strong> ${timelineStrategy}</div>
                </div>
                <div class="mt-2 p-2 bg-blue-50 rounded text-xs">
                    <strong>å»ºè­°:</strong> æ ¹æ“šé¸æ“‡çš„åƒæ•¸ï¼Œå»ºè­°å„ªå…ˆè€ƒæ…® ${entryMode === 'partnership' ? 'å»ºç«‹æˆ°ç•¥åˆä½œé—œä¿‚' : entryMode === 'acquisition' ? 'å°‹æ‰¾åˆé©çš„æ”¶è³¼ç›®æ¨™' : entryMode === 'licensing' ? 'ç™¼å±•æˆæ¬Šåˆä½œå¤¥ä¼´' : 'ç›´æ¥å»ºç«‹æœ¬åœ°åœ˜éšŠ'}ï¼Œä¸¦åœ¨ ${timeline} å…§å®Œæˆå¸‚å ´é€²å…¥æº–å‚™ã€‚
                </div>
            `;
        }

        // ç”Ÿæˆå¾·åœ‹å¸‚å ´å ±å‘Š
        function generateGermanReport() {
            const output = document.getElementById('german-report-output');
            const marketChecked = document.getElementById('german-report-market').checked;
            const competitionChecked = document.getElementById('german-report-competition').checked;
            const strategyChecked = document.getElementById('german-report-strategy').checked;
            const complianceChecked = document.getElementById('german-report-compliance').checked;
            
            let reportContent = '<div class="space-y-3">';
            reportContent += '<div class="font-medium text-green-800">ğŸ“Š å¾·åœ‹å¸‚å ´åˆ†æå ±å‘Š</div>';
            reportContent += '<div class="text-xs text-gray-600">ç”Ÿæˆæ™‚é–“: ' + new Date().toLocaleString('zh-TW') + '</div>';
            
            if (marketChecked) {
                reportContent += `
                    <div class="p-2 bg-green-50 rounded">
                        <div class="font-medium text-green-700">ğŸ­ å¸‚å ´ç‰¹æ€§</div>
                        <ul class="text-xs text-green-600 mt-1 space-y-1">
                            <li>â€¢ é«˜åº¦æˆç†Ÿçš„å·¥æ¥­åŒ–ç¶“æ¿Ÿé«”ï¼ŒGDP å…¨çƒç¬¬å››</li>
                            <li>â€¢ å“è³ªè¦æ±‚æ¥µé«˜ï¼Œé‡è¦–æŠ€è¡“æ¨™æº–å’Œèªè­‰</li>
                            <li>â€¢ æ±ºç­–éç¨‹åš´è¬¹ï¼Œéœ€è¦è©³ç´°æŠ€è¡“æ–‡ä»¶å’Œæ•¸æ“šæ”¯æŒ</li>
                            <li>â€¢ ç’°ä¿æ„è­˜å¼·ï¼Œæ°¸çºŒç™¼å±•å’Œç¶ è‰²æŠ€è¡“å„ªå…ˆ</li>
                        </ul>
                    </div>
                `;
            }
            
            if (competitionChecked) {
                reportContent += `
                    <div class="p-2 bg-blue-50 rounded">
                        <div class="font-medium text-blue-700">ğŸ¯ ç«¶çˆ­åˆ†æ</div>
                        <ul class="text-xs text-blue-600 mt-1 space-y-1">
                            <li>â€¢ ç›´æ¥ç«¶çˆ­å°æ‰‹ï¼šSiemens, Bosch, SAP</li>
                            <li>â€¢ ç«¶çˆ­å„ªå‹¢ï¼šæŠ€è¡“å‰µæ–°ã€å“è³ªä¿è­‰ã€æœ¬åœ°åŒ–æœå‹™</li>
                            <li>â€¢ å¸‚å ´å®šä½ï¼šé«˜ç«¯æŠ€è¡“è§£æ±ºæ–¹æ¡ˆæä¾›å•†</li>
                        </ul>
                    </div>
                `;
            }
            
            if (strategyChecked) {
                reportContent += `
                    <div class="p-2 bg-purple-50 rounded">
                        <div class="font-medium text-purple-700">ğŸ’¡ ç­–ç•¥å»ºè­°</div>
                        <ul class="text-xs text-purple-600 mt-1 space-y-1">
                            <li>â€¢ å»ºç«‹æŠ€è¡“å°ˆå®¶åœ˜éšŠï¼Œæä¾›æ·±åº¦æŠ€è¡“æ”¯æ´</li>
                            <li>â€¢ åƒèˆ‡å¾·åœ‹å·¥æ¥­å±•è¦½æœƒï¼Œå»ºç«‹å“ç‰ŒçŸ¥ååº¦</li>
                            <li>â€¢ èˆ‡å¾·åœ‹æŠ€è¡“å¤§å­¸å»ºç«‹åˆä½œé—œä¿‚</li>
                            <li>â€¢ æä¾›å¾·èªæŠ€è¡“æ–‡æª”å’ŒåŸ¹è¨“ææ–™</li>
                        </ul>
                    </div>
                `;
            }
            
            if (complianceChecked) {
                reportContent += `
                    <div class="p-2 bg-red-50 rounded">
                        <div class="font-medium text-red-700">âš–ï¸ åˆè¦è¦æ±‚</div>
                        <ul class="text-xs text-red-600 mt-1 space-y-1">
                            <li>â€¢ ç¬¦åˆ EU GDPR æ•¸æ“šä¿è­·æ³•è¦</li>
                            <li>â€¢ å–å¾—å¾·åœ‹æŠ€è¡“èªè­‰ (TÃœV, VDE)</li>
                            <li>â€¢ éµå®ˆå¾·åœ‹å‹å‹•æ³•å’Œç¨…å‹™è¦å®š</li>
                            <li>â€¢ ç¬¦åˆå¾·åœ‹ç’°ä¿æ¨™æº–å’Œæ³•è¦</li>
                        </ul>
                    </div>
                `;
            }
            
            reportContent += '</div>';
            output.innerHTML = reportContent;
        }

        // å°å‡ºå¾·åœ‹å¸‚å ´å ±å‘Šç‚ºPDF
        function exportGermanReport() {
            const output = document.getElementById('german-report-output');
            if (output.innerHTML.includes('é¸æ“‡å ±å‘Šå…§å®¹ä¸¦é»æ“Šç”Ÿæˆå ±å‘Š')) {
                alert('è«‹å…ˆç”Ÿæˆå ±å‘Šå…§å®¹');
                return;
            }
            
            // å‰µå»ºå¯åˆ—å°çš„å ±å‘Šå…§å®¹
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <!DOCTYPE html>
                <html>
                <head>
                    <title>å¾·åœ‹å¸‚å ´åˆ†æå ±å‘Š</title>
                    <style>
                        body { font-family: Arial, sans-serif; margin: 20px; }
                        .header { text-align: center; margin-bottom: 30px; }
                        .section { margin-bottom: 20px; }
                        .section-title { font-weight: bold; color: #1f2937; margin-bottom: 10px; }
                        .content { margin-left: 20px; }
                        @media print { body { margin: 0; } }
                    </style>
                </head>
                <body>
                    <div class="header">
                        <h1>ğŸ‡©ğŸ‡ª å¾·åœ‹å¸‚å ´åˆ†æå ±å‘Š</h1>
                        <p>ç”Ÿæˆæ™‚é–“: ${new Date().toLocaleString('zh-TW')}</p>
                    </div>
                    ${output.innerHTML.replace(/<[^>]*>/g, '').replace(/â€¢/g, 'â€¢ ')}
                </body>
                </html>
            `);
            printWindow.document.close();
            printWindow.print();
        }

        // è²å¾‹è³“å¸‚å ´ç­–ç•¥å»ºè­°ç”Ÿæˆå™¨
        function generatePhilippinesStrategy() {
            const strategyType = document.getElementById('philippines-strategy-type').value;
            const output = document.getElementById('philippines-strategy-output');
            
            const strategies = {
                b2b: [
                    'å»ºç«‹å€‹äººé—œä¿‚å’Œä¿¡ä»»ï¼ŒæŠ•è³‡æ™‚é–“åœ¨é—œä¿‚ç¶“ç‡Ÿä¸Š',
                    'å°Šé‡éšç´šçµæ§‹ï¼Œå¾é«˜å±¤é–‹å§‹å»ºç«‹é—œä¿‚',
                    'æä¾›æœ¬åœ°åŒ–çš„è§£æ±ºæ–¹æ¡ˆå’Œæ”¯æ´æœå‹™',
                    'é‡è¦–é•·æœŸåˆä½œé—œä¿‚ï¼Œé¿å…çŸ­æœŸäº¤æ˜“æ€ç¶­',
                    'åƒèˆ‡ç•¶åœ°å•†æ¥­çµ„ç¹”å’Œç¤¾åœ˜æ´»å‹•'
                ],
                localization: [
                    'ä½¿ç”¨è²å¾‹è³“è‹±èªå’Œç•¶åœ°ä¿šèªè¡¨é”',
                    'é©æ‡‰è²å¾‹è³“çš„ç¯€å‡æ—¥å’Œå®—æ•™æ…¶å…¸',
                    'é‡è¦–å®¶åº­å’Œç¤¾ç¾¤åƒ¹å€¼åœ¨è¡ŒéŠ·è¨Šæ¯ä¸­',
                    'å»ºç«‹æœ¬åœ°å®¢æœå’ŒæŠ€è¡“æ”¯æ´åœ˜éšŠ',
                    'å°Šé‡ç•¶åœ°å®—æ•™ç¿’ä¿—å’Œå‚³çµ±'
                ],
                compliance: [
                    'éµå®ˆè²å¾‹è³“æŠ•è³‡å§”å“¡æœƒ (BOI) çš„æŠ•è³‡æ³•è¦',
                    'ç¬¦åˆè²å¾‹è³“è­‰åˆ¸äº¤æ˜“å§”å“¡æœƒ (SEC) çš„å…¬å¸æ³•è¦æ±‚',
                    'éµå®ˆæ•¸æ“šéš±ç§æ³• (Data Privacy Act of 2012)',
                    'ç¬¦åˆè²å¾‹è³“ä¸­å¤®éŠ€è¡Œ (BSP) çš„é‡‘èæ³•è¦',
                    'éµå®ˆè²¿æ˜“å·¥æ¥­éƒ¨çš„æ¶ˆè²»è€…ä¿è­·æ³•è¦'
                ],
                marketing: [
                    'ä½¿ç”¨ Facebook å’Œ Instagram é€²è¡Œç¤¾ç¾¤è¡ŒéŠ·',
                    'èˆ‡ç•¶åœ° KOL å’Œç¶²ç´…åˆä½œæ¨å»£',
                    'é‡è¦–å£ç¢‘è¡ŒéŠ·å’Œæ¨è–¦æ–‡åŒ–',
                    'ä½¿ç”¨ YouTube è£½ä½œæ•™è‚²å’Œå¨›æ¨‚å…§å®¹',
                    'å»ºç«‹è²å¾‹è³“æœ¬åœ°ç¤¾ç¾¤åª’é«”å­˜åœ¨'
                ]
            };
            
            const selectedStrategies = strategies[strategyType];
            const randomStrategies = selectedStrategies.sort(() => 0.5 - Math.random()).slice(0, 3);
            
            output.innerHTML = `
                <div class="font-medium text-gray-800 mb-2">ğŸ¯ ${strategyType.toUpperCase()} ç­–ç•¥å»ºè­°:</div>
                <ul class="list-disc list-inside space-y-1">
                    ${randomStrategies.map(strategy => `<li>${strategy}</li>`).join('')}
                </ul>
            `;
        }

        // æª¢æŸ¥è²å¾‹è³“å¸‚å ´æº–å‚™åº¦
        function checkPhilippinesMarketReadiness() {
            const checkboxes = document.querySelectorAll('.philippines-checklist:checked');
            const totalCheckboxes = document.querySelectorAll('.philippines-checklist').length;
            const readinessScore = Math.round((checkboxes.length / totalCheckboxes) * 100);
            
            const scoreElement = document.getElementById('philippines-readiness-score');
            let scoreClass = 'text-red-600';
            let scoreText = 'éœ€è¦æ›´å¤šæº–å‚™';
            
            if (readinessScore >= 80) {
                scoreClass = 'text-green-600';
                scoreText = 'æº–å‚™å……åˆ†ï¼Œå¯ä»¥é€²å…¥å¸‚å ´';
            } else if (readinessScore >= 60) {
                scoreClass = 'text-yellow-600';
                scoreText = 'åŸºæœ¬æº–å‚™å®Œæˆï¼Œå»ºè­°é€²ä¸€æ­¥å®Œå–„';
            }
            
            scoreElement.innerHTML = `
                <div class="font-medium ${scoreClass}">
                    æº–å‚™åº¦: ${readinessScore}% - ${scoreText}
                </div>
                <div class="text-xs text-gray-600 mt-1">
                    å·²å®Œæˆ ${checkboxes.length}/${totalCheckboxes} é …æª¢æŸ¥
                </div>
            `;
        }

        // ç”Ÿæˆè²å¾‹è³“å¸‚å ´é€²å…¥è¨ˆç•«
        function generatePhilippinesEntryPlan() {
            const productType = document.getElementById('philippines-product-type').value;
            const entryMode = document.getElementById('philippines-entry-mode').value;
            const output = document.getElementById('philippines-entry-plan');
            
            const entryPlans = {
                'æ•¸ä½æœå‹™': {
                    'ç›´æ¥æŠ•è³‡': 'å»ºç«‹è²å¾‹è³“å­å…¬å¸ï¼Œç›´æ¥æä¾›æ•¸ä½æœå‹™ï¼Œé‡é»ç™¼å±•æ‰‹æ©ŸAPPå’Œç¶²ç«™å¹³å°',
                    'åˆä½œå¤¥ä¼´': 'èˆ‡ç•¶åœ°é›»ä¿¡å•†æˆ–ç§‘æŠ€å…¬å¸åˆä½œï¼Œå…±åŒæ¨å»£æ•¸ä½æœå‹™',
                    'ç¶“éŠ·å•†': 'é¸æ“‡æœ‰ç¶“é©—çš„æœ¬åœ°ç¶“éŠ·å•†ï¼Œè² è²¬éŠ·å”®å’Œå®¢æˆ¶æœå‹™',
                    'ç·šä¸Šå¹³å°': 'é€é Lazadaã€Shopee ç­‰é›»å•†å¹³å°éŠ·å”®æ•¸ä½ç”¢å“'
                },
                'æ¶ˆè²»æ€§ç”¢å“': {
                    'ç›´æ¥æŠ•è³‡': 'è¨­ç«‹è²å¾‹è³“åˆ†å…¬å¸ï¼Œå»ºç«‹å®Œæ•´çš„ä¾›æ‡‰éˆå’ŒéŠ·å”®ç¶²è·¯',
                    'åˆä½œå¤¥ä¼´': 'èˆ‡ SMã€Ayala ç­‰å¤§å‹é›¶å”®é›†åœ˜åˆä½œé€²å…¥å¸‚å ´',
                    'ç¶“éŠ·å•†': 'é¸æ“‡æœ‰é€šè·¯å„ªå‹¢çš„æœ¬åœ°ç¶“éŠ·å•†ï¼Œå¿«é€Ÿè¦†è“‹å¸‚å ´',
                    'ç·šä¸Šå¹³å°': 'çµåˆç·šä¸Šé›»å•†å’Œå¯¦é«”é€šè·¯çš„O2Oæ¨¡å¼'
                }
            };
            
            const plan = entryPlans[productType]?.[entryMode] || 'è«‹é¸æ“‡æœ‰æ•ˆçš„ç”¢å“é¡å‹å’Œé€²å…¥æ¨¡å¼çµ„åˆ';
            
            output.innerHTML = `
                <div class="font-medium text-purple-800 mb-1">ğŸ“‹ ${productType} - ${entryMode} ç­–ç•¥:</div>
                <div class="text-purple-700">${plan}</div>
            `;
        }

        // ç”Ÿæˆè²å¾‹è³“å¸‚å ´å ±å‘Š
        function generatePhilippinesReport() {
            const modules = Array.from(document.querySelectorAll('.philippines-report-module:checked')).map(cb => cb.value);
            const output = document.getElementById('philippines-report-output');
            
            if (modules.length === 0) {
                output.innerHTML = 'è«‹è‡³å°‘é¸æ“‡ä¸€å€‹å ±å‘Šæ¨¡çµ„';
                return;
            }
            
            const reportContent = {
                'market-overview': 'è²å¾‹è³“å¸‚å ´æ¦‚æ³ï¼šå¿«é€Ÿæˆé•·çš„æ–°èˆˆç¶“æ¿Ÿé«”ï¼Œå¹´è¼•åŒ–äººå£çµæ§‹ï¼Œæ•¸ä½åŒ–ç¨‹åº¦é«˜...',
                'cultural-analysis': 'æ–‡åŒ–åˆ†æï¼šå®¶åº­å’Œç¤¾ç¾¤å°å‘æ–‡åŒ–ï¼Œé‡è¦–å€‹äººé—œä¿‚å’Œä¿¡ä»»å»ºç«‹...',
                'competitive-landscape': 'ç«¶çˆ­ç’°å¢ƒï¼šæœ¬åœŸå“ç‰Œç«¶çˆ­æ¿€çƒˆï¼Œè·¨åœ‹ä¼æ¥­éœ€è¦æœ¬åœ°åŒ–ç­–ç•¥...',
                'regulatory-requirements': 'æ³•è¦è¦æ±‚ï¼šéœ€éµå®ˆBOIæŠ•è³‡æ³•è¦ã€SECå…¬å¸æ³•ã€æ•¸æ“šéš±ç§æ³•ç­‰...'
            };
            
            let reportHtml = '<div class="font-medium text-green-800 mb-2">ğŸ‡µğŸ‡­ è²å¾‹è³“å¸‚å ´åˆ†æå ±å‘Š</div>';
            modules.forEach(module => {
                const title = module.split('-').map(word => word.charAt(0).toUpperCase() + word.slice(1)).join(' ');
                reportHtml += `
                    <div class="mb-2">
                        <div class="font-medium text-green-700">${title}</div>
                        <div class="text-green-600 text-xs">${reportContent[module]}</div>
                    </div>
                `;
            });
            
            output.innerHTML = reportHtml;
        }

        // å°å‡ºè²å¾‹è³“å¸‚å ´å ±å‘Šç‚ºPDF
        function exportPhilippinesReport() {
            const output = document.getElementById('philippines-report-output');
            if (!output.innerHTML || output.innerHTML.includes('é¸æ“‡å ±å‘Šå…§å®¹')) {
                alert('è«‹å…ˆç”Ÿæˆå ±å‘Šå…§å®¹');
                return;
            }
            
            // å‰µå»ºå¯åˆ—å°çš„å ±å‘Šå…§å®¹
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <!DOCTYPE html>
                <html>
                <head>
                    <title>è²å¾‹è³“å¸‚å ´åˆ†æå ±å‘Š</title>
                    <style>
                        body { font-family: Arial, sans-serif; margin: 20px; }
                        .header { text-align: center; margin-bottom: 30px; }
                        .section { margin-bottom: 20px; }
                        .section-title { font-weight: bold; color: #1f2937; margin-bottom: 10px; }
                        .content { margin-left: 20px; }
                        @media print { body { margin: 0; } }
                    </style>
                </head>
                <body>
                    <div class="header">
                        <h1>ğŸ‡µğŸ‡­ è²å¾‹è³“å¸‚å ´åˆ†æå ±å‘Š</h1>
                        <p>ç”Ÿæˆæ™‚é–“: ${new Date().toLocaleString('zh-TW')}</p>
                    </div>
                    ${output.innerHTML.replace(/<[^>]*>/g, '').replace(/â€¢/g, 'â€¢ ')}
                </body>
                </html>
            `);
            printWindow.document.close();
            printWindow.print();
        }

        // å¼·åˆ¶æ¸…é™¤å¿«å–ä¸¦æª¢æŸ¥ç‰ˆæœ¬çš„åŠŸèƒ½
        function forceRefresh() {
            const timestamp = new Date().getTime();
            window.location.href = window.location.href.split('?')[0] + '?_refresh=' + timestamp;
        }

        // æª¢æŸ¥ç‰ˆæœ¬ä¸¦æä¾›å¿«å–æ¸…é™¤æç¤º
        function checkVersionAndCache() {
            const currentVersion = '2.5.1';
            const lastVersion = localStorage.getItem('mediaplan_version');
            
            if (!lastVersion || lastVersion !== currentVersion) {
                localStorage.setItem('mediaplan_version', currentVersion);
                console.log('ç‰ˆæœ¬æ›´æ–°åˆ°:', currentVersion);
                
                if (lastVersion) {
                    // é¡¯ç¤ºç‰ˆæœ¬æ›´æ–°æˆåŠŸæç¤º
                    setTimeout(() => {
                        const alert = document.createElement('div');
                        alert.className = 'fixed top-4 right-4 bg-green-600 text-white px-4 py-2 rounded-lg shadow-lg z-50 transform translate-x-full transition-transform';
                        alert.innerHTML = 'âœ… v2.5.1 JSONè§£æå·²ä¿®å¾©';
                        document.body.appendChild(alert);
                        
                        setTimeout(() => alert.classList.remove('translate-x-full'), 100);
                        setTimeout(() => {
                            alert.classList.add('translate-x-full');
                            setTimeout(() => alert.remove(), 300);
                        }, 4000);
                    }, 1000);
                }
            }
        }

        // åˆå§‹åŒ–å‡½æ•¸
        function initializeApp() {
            checkVersionAndCache();
            
            // å¦‚æœé é¢URLåŒ…å«éŒ¯èª¤åƒæ•¸ï¼Œæä¾›å¿«é€Ÿä¿®å¾©é¸é …
            const urlParams = new URLSearchParams(window.location.search);
            if (urlParams.has('error') || document.referrer.includes('error')) {
                const fixButton = document.createElement('div');
                fixButton.className = 'fixed top-4 left-4 bg-yellow-500 text-white px-3 py-2 rounded cursor-pointer z-50';
                fixButton.innerHTML = 'ğŸ”§ é»æ“Šå¼·åˆ¶é‡æ–°è¼‰å…¥';
                fixButton.onclick = forceRefresh;
                document.body.appendChild(fixButton);
            }
        }

        // APIé‡‘é‘°é©—è­‰å‡½æ•¸
        async function validateApiKey() {
            const apiKey = document.getElementById('apiKeyInput').value.trim();
            const result = document.getElementById('apiValidationResult');
            const btn = document.getElementById('validateApiBtn');
            
            if (!apiKey) {
                result.innerHTML = '<span class="text-red-600">âš ï¸ è«‹å…ˆè¼¸å…¥APIé‡‘é‘°</span>';
                return;
            }
            
            // æª¢æŸ¥åŸºæœ¬æ ¼å¼
            if (!apiKey.startsWith('AIzaSy') || apiKey.length < 35) {
                result.innerHTML = '<span class="text-red-600">âŒ APIé‡‘é‘°æ ¼å¼ä¸æ­£ç¢º</span>';
                return;
            }
            
            btn.innerHTML = 'â³ é©—è­‰ä¸­...';
            btn.disabled = true;
            
            try {
                // å˜—è©¦é€²è¡Œä¸€å€‹ç°¡å–®çš„APIèª¿ç”¨ä¾†é©—è­‰é‡‘é‘°
                const testResponse = await fetch(`https://generativelanguage.googleapis.com/v1beta/models?key=${apiKey}`);
                
                if (testResponse.ok) {
                    result.innerHTML = '<span class="text-green-600">âœ… APIé‡‘é‘°æœ‰æ•ˆï¼</span>';
                } else if (testResponse.status === 400) {
                    result.innerHTML = '<span class="text-red-600">âŒ APIé‡‘é‘°ç„¡æ•ˆ</span>';
                } else if (testResponse.status === 403) {
                    result.innerHTML = '<span class="text-orange-600">âš ï¸ APIé‡‘é‘°æ¬Šé™ä¸è¶³</span>';
                } else {
                    result.innerHTML = '<span class="text-yellow-600">âš ï¸ ç„¡æ³•é©—è­‰ï¼ˆç¶²è·¯å•é¡Œï¼‰</span>';
                }
            } catch (error) {
                result.innerHTML = '<span class="text-yellow-600">âš ï¸ é©—è­‰å¤±æ•—ï¼ˆç¶²è·¯éŒ¯èª¤ï¼‰</span>';
                console.error('APIé‡‘é‘°é©—è­‰éŒ¯èª¤:', error);
            }
            
            btn.innerHTML = 'ğŸ” é©—è­‰é‡‘é‘°';
            btn.disabled = false;
        }

        // é é¢è¼‰å…¥å®Œæˆå¾ŒåŸ·è¡Œ
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initializeApp);
        } else {
            initializeApp();
        }
    </script>
</body>
</html>

