<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è‡ªå‹•åŒ–åª’é«”ææ¡ˆå¼•æ“ (å°ç£å¸‚å ´ç‰¹åŒ–ç‰ˆ MVP)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', 'Noto Sans TC', sans-serif;
        }
        .gradient-bg {
            background: linear-gradient(135deg, #f0f9ff 0%, #e0e7ff 100%);
        }
        .card {
            background-color: white;
            border-radius: 1rem;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }
        .btn-primary {
            background: linear-gradient(135deg, #4f46e5 0%, #818cf8 100%);
            color: white;
            transition: all 0.3s ease;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 7px 14px rgba(0,0,0,0.1);
        }
        .btn-primary:disabled {
            background: #a5b4fc;
            cursor: not-allowed;
            transform: translateY(0);
            box-shadow: none;
        }
        #proposalOutput h2 {
            font-size: 1.5rem;
            font-weight: 700;
            color: #1e3a8a;
            margin-top: 1.5rem;
            margin-bottom: 1rem;
            border-bottom: 2px solid #60a5fa;
            padding-bottom: 0.5rem;
        }
        #proposalOutput h3 {
            font-size: 1.25rem;
            font-weight: 600;
            color: #1d4ed8;
            margin-top: 1.25rem;
            margin-bottom: 0.75rem;
        }
        #proposalOutput p, #proposalOutput li, #proposalOutput td, #proposalOutput th {
            color: #374151;
            line-height: 1.7;
        }
        #proposalOutput p, #proposalOutput ul {
             margin-bottom: 1rem;
        }
        #proposalOutput ul {
            list-style-type: disc;
            padding-left: 1.5rem;
        }
        #proposalOutput strong {
            color: #1e40af;
            font-weight: 600;
        }
        .status-update {
            transition: all 0.5s ease;
            overflow: hidden;
            max-height: 0;
            opacity: 0;
        }
        .status-update.active {
            max-height: 100px; /* or a suitable max-height */
            opacity: 1;
            margin-top: 1rem;
        }
        .input-grid {
            display: grid;
            grid-template-columns: repeat(1, 1fr);
            gap: 1.5rem;
        }
        @media (min-width: 1024px) {
            .input-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }
        #proposalOutput table {
            width: 100%;
            margin-top: 1rem;
            margin-bottom: 1rem;
            border-collapse: collapse;
        }
        #proposalOutput th, #proposalOutput td {
            border: 1px solid #e5e7eb;
            padding: 0.75rem;
            text-align: left;
        }
        #proposalOutput th {
            background-color: #f9fafb;
            font-weight: 600;
        }
    </style>
</head>
<body class="gradient-bg min-h-screen flex items-center justify-center p-4">
    <div class="w-full max-w-6xl mx-auto">
        <div class="card p-8">
            <div class="text-center mb-8">
                <h1 class="text-3xl font-bold text-gray-800">è‡ªå‹•åŒ–åª’é«”ææ¡ˆå¼•æ“</h1>
                <p class="mt-2 text-gray-600">v2.5 å®‰å…¨é‡‘é‘°ç‰ˆ (MVP)</p>
            </div>

            <!-- Module 1: ä½¿ç”¨è€…èˆ‡é…ç½®ä»‹é¢ ('é§•é§›è‰™') -->
            <div class="space-y-6">
                 <!-- API é‡‘é‘°è¼¸å…¥ -->
                <div class="p-4 bg-yellow-50 border border-yellow-200 rounded-lg">
                    <label for="apiKeyInput" class="block text-sm font-medium text-yellow-800 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M18 8a6 6 0 11-12 0 6 6 0 0112 0zM7 8a1 1 0 11-2 0 1 1 0 012 0zm5 0a1 1 0 11-2 0 1 1 0 012 0zm5 0a1 1 0 11-2 0 1 1 0 012 0z" clip-rule="evenodd"></path></svg>
                        Google Gemini API é‡‘é‘° <span class="text-red-500 ml-1">*</span>
                    </label>
                    <input type="password" id="apiKeyInput" class="mt-1 block w-full px-3 py-2 border border-yellow-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500" placeholder="è«‹åœ¨æ­¤è²¼ä¸Šæ‚¨çš„ API é‡‘é‘°">
                    <p class="mt-2 text-xs text-yellow-700">æ­¤é‡‘é‘°åƒ…å­˜æ–¼æ‚¨ç›®å‰çš„ç€è¦½å™¨åˆ†é ï¼Œé—œé–‰å¾Œå³æ¶ˆå¤±ï¼Œä¸æœƒè¢«å„²å­˜ã€‚</p>
                </div>
                
                <!-- Project ID è¼¸å…¥ -->
                <div class="p-4 bg-blue-50 border border-blue-200 rounded-lg">
                    <label for="projectIdInput" class="block text-sm font-medium text-blue-800 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M4 4a2 2 0 00-2 2v4a2 2 0 002 2V6h10a2 2 0 00-2-2H4zm2 6a2 2 0 012-2h8a2 2 0 012 2v4a2 2 0 01-2 2H8a2 2 0 01-2-2v-4zm6 4a2 2 0 100-4 2 2 0 000 4z" clip-rule="evenodd"></path></svg>
                        å°ˆæ¡ˆ ID <span class="text-gray-500 ml-1">(å¯é¸)</span>
                    </label>
                    <input type="text" id="projectIdInput" class="mt-1 block w-full px-3 py-2 border border-blue-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500" placeholder="è«‹è¼¸å…¥å°ˆæ¡ˆ ID (å¯é¸)">
                    <p class="mt-2 text-xs text-blue-700">å¦‚ç„¡å°ˆæ¡ˆIDï¼Œç³»çµ±å°‡è‡ªå‹•ç”¢ç”Ÿè‡¨æ™‚IDç”¨æ–¼æª”æ¡ˆå‘½å</p>
                </div>
                
                <!-- é›†ä¸­åŒ–è³‡æ–™å¤¾ç®¡ç†è¨­å®š -->
                <div class="p-4 bg-green-50 border border-green-200 rounded-lg">
                    <label class="block text-sm font-medium text-green-800 flex items-center mb-3">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M2 6a2 2 0 012-2h4l2 2h4a2 2 0 012 2v1H8a3 3 0 00-3 3v1.5a1.5 1.5 0 01-3 0V6z" clip-rule="evenodd"></path><path d="M6 12a2 2 0 012-2h8a2 2 0 012 2v2a2 2 0 01-2 2H2h2a2 2 0 01-2-2v-2z"></path></svg>
                        é›†ä¸­åŒ–è³‡æ–™å¤¾ç®¡ç† <span class="text-gray-500 ml-1">(å¯é¸)</span>
                    </label>
                    <div class="space-y-3">
                        <div>
                            <label for="centralFolderName" class="block text-xs font-medium text-green-700">ä¸»è¦å°ˆæ¡ˆè³‡æ–™å¤¾åç¨±</label>
                            <input type="text" id="centralFolderName" class="mt-1 block w-full px-3 py-2 border border-green-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 text-sm" value="iStaging_å°ˆæ¡ˆç®¡ç†" placeholder="ä¾‹å¦‚: iStaging_å°ˆæ¡ˆç®¡ç†">
                        </div>
                        <div>
                            <label for="mediaplanSubfolder" class="block text-xs font-medium text-green-700">åª’é«”ææ¡ˆå­è³‡æ–™å¤¾åç¨±</label>
                            <input type="text" id="mediaplanSubfolder" class="mt-1 block w-full px-3 py-2 border border-green-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 text-sm" value="02_åª’é«”ææ¡ˆ" placeholder="ä¾‹å¦‚: 02_åª’é«”ææ¡ˆ">
                        </div>
                    </div>
                    <p class="mt-2 text-xs text-green-700">è¨­å®šå¾Œå°‡è‡ªå‹•å»ºç«‹å°ˆæ¡ˆè³‡æ–™å¤¾çµæ§‹ä¸¦å„²å­˜çµæœ</p>
                </div>

                <div class="border-t border-gray-200 pt-6">
                    <div class="input-grid">
                        <div>
                            <label for="targetBrand" class="block text-sm font-medium text-gray-700">ç›®æ¨™å“ç‰Œ / ç”¢å“ <span class="text-red-500">*</span></label>
                            <input type="text" id="targetBrand" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500" placeholder="ä¾‹å¦‚ï¼šgogoro, æ˜Ÿå®‡èˆªç©º">
                        </div>
                        <div>
                            <label for="competitorBrand" class="block text-sm font-medium text-gray-700">ä¸»è¦ç«¶çˆ­å°æ‰‹ <span class="text-red-500">*</span></label>
                            <input type="text" id="competitorBrand" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500" placeholder="ä¾‹å¦‚ï¼šå…‰é™½, é•·æ¦®èˆªç©º">
                        </div>
                         <div>
                            <label for="industry" class="block text-sm font-medium text-gray-700">ç›®æ¨™å¸‚å ´ / ç”¢æ¥­ <span class="text-red-500">*</span></label>
                            <select id="industry" class="mt-1 block w-full px-3 py-2 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                <option>æ¶ˆè²»æ€§é›»å­ç”¢å“</option>
                                <option>æ™‚å°šæœé£¾èˆ‡é…ä»¶</option>
                                <option>ç¾å¦ä¿é¤Š</option>
                                <option>æ—…éŠèˆ‡èˆªç©ºæœå‹™</option>
                                <option>é¤é£²æ¥­</option>
                                <option>B2B è»Ÿé«”æœå‹™</option>
                                <option>é‡‘èèˆ‡ä¿éšªæœå‹™</option>
                                <option>å…¶ä»–</option>
                            </select>
                        </div>
                        <div>
                            <label for="businessModel" class="block text-sm font-medium text-gray-700">å•†æ¥­æ¨¡å¼ <span class="text-red-500">*</span></label>
                             <select id="businessModel" class="mt-1 block w-full px-3 py-2 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                <option value="B2C">B2C (ä¼æ¥­å°æ¶ˆè²»è€…)</option>
                                <option value="B2B">B2B (ä¼æ¥­å°ä¼æ¥­)</option>
                            </select>
                        </div>
                         <div>
                            <label for="salesChannels" class="block text-sm font-medium text-gray-700">ä¸»è¦éŠ·å”®é€šè·¯</label>
                            <input type="text" id="salesChannels" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500" placeholder="ä¾‹å¦‚ï¼šç·šä¸Šå®˜ç¶²ã€MOMOã€å¯¦é«”é–€å¸‚">
                        </div>
                        <div>
                            <label for="targetAudience" class="block text-sm font-medium text-gray-700">ç›®æ¨™äººç¾¤æè¿°</label>
                            <input type="text" id="targetAudience" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500" placeholder="ä¾‹å¦‚ï¼š25-35æ­²éƒ½æœƒå¥³æ€§ã€ç§‘æŠ€æ¥­æ¡è³¼ä¸»ç®¡">
                        </div>
                         <div class="md:col-span-3">
                            <label for="advertisingBudget" class="block text-sm font-medium text-gray-700">é è¨ˆå»£å‘Šé ç®— (å°å¹£)</label>
                            <input type="number" id="advertisingBudget" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500" placeholder="ä¾‹å¦‚ï¼š300000">
                        </div>
                    </div>
                </div>

                <button id="generateBtn" class="w-full btn-primary font-bold py-3 px-4 rounded-lg flex items-center justify-center text-lg">
                    <svg class="w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path></svg>
                    ç”Ÿæˆ AI åˆ†æå ±å‘Š
                </button>
            </div>

            <!-- å‹•æ…‹ç‹€æ…‹æ›´æ–°å€åŸŸ -->
            <div id="statusContainer" class="mt-4 space-y-2"></div>

            <!-- Module 4: è¼¸å‡ºèˆ‡äº¤ä»˜æ¨¡çµ„ ('æ¸²æŸ“å±¤') -->
            <div id="proposalOutput" class="mt-8 border-t-2 border-gray-200 pt-6">
                <!-- AI ç”Ÿæˆçš„å…§å®¹å°‡æœƒé¡¯ç¤ºåœ¨é€™è£¡ -->
            </div>
        </div>
        <footer class="text-center mt-4 text-sm text-gray-500">
            <p>æœ¬åŸå‹ç”± Google Gemini é©…å‹•ï¼Œæ‰€æœ‰åˆ†æçš†ç‚ºå³æ™‚ç”Ÿæˆã€‚</p>
        </footer>
    </div>

    <script type="module">
        // --- UI å…ƒç´  ---
        const apiKeyInput = document.getElementById('apiKeyInput');
        const projectIdInput = document.getElementById('projectIdInput');
        const generateBtn = document.getElementById('generateBtn');
        const targetBrandInput = document.getElementById('targetBrand');
        const competitorBrandInput = document.getElementById('competitorBrand');
        const industryInput = document.getElementById('industry');
        const businessModelInput = document.getElementById('businessModel');
        const salesChannelsInput = document.getElementById('salesChannels');
        const targetAudienceInput = document.getElementById('targetAudience');
        const advertisingBudgetInput = document.getElementById('advertisingBudget');
        const statusContainer = document.getElementById('statusContainer');
        const proposalOutput = document.getElementById('proposalOutput');

        // å…¨åŸŸè®Šæ•¸å„²å­˜ project ID
        let currentProjectId = null;

        // æ–°å¢ï¼šé›†ä¸­åŒ–è³‡æ–™å¤¾ç®¡ç†è®Šæ•¸
        let folderStructure = {
            centralFolder: 'iStaging_å°ˆæ¡ˆç®¡ç†',
            mediaplanSubfolder: '02_åª’é«”ææ¡ˆ'
        };
        let folderIds = {
            central: null,
            project: null,
            mediaplan: null
        };
        let isGoogleDriveEnabled = false;

        // æ–°å¢ï¼šå¾ URL åƒæ•¸è®€å– project ID
        function loadProjectIdFromUrl() {
            const urlParams = new URLSearchParams(window.location.search);
            const projectId = urlParams.get('projectId');
            if (projectId) {
                projectIdInput.value = projectId;
                currentProjectId = projectId;
                console.log('å¾ URL è®€å–åˆ°å°ˆæ¡ˆ ID:', projectId);
            }
        }

        // é é¢è¼‰å…¥æ™‚è®€å– project ID
        loadProjectIdFromUrl();

        // --- Module 2: AI ä»»å‹™å”èª¿èˆ‡åŸ·è¡Œæ ¸å¿ƒ ('èåˆä¸­æ¨') ---
        async function callGeminiAPI(prompt, apiKey, isJsonMode = false) {
            if (!apiKey) {
                throw new Error("Google Gemini API é‡‘é‘°ç‚ºç©ºï¼Œè«‹åœ¨ä»‹é¢ä¸Šæ–¹è¼¸å…¥ã€‚");
            }
            const payload = {
                contents: [{ role: "user", parts: [{ text: prompt }] }],
            };
            if (isJsonMode) {
                payload.generationConfig = { responseMimeType: "application/json" };
            }
            
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;
            
            const response = await fetch(apiUrl, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });
            if (!response.ok) {
                const errorBody = await response.text();
                throw new Error(`AI API è«‹æ±‚å¤±æ•— (ç‹€æ…‹ ${response.status}): ${errorBody}`);
            }
            const result = await response.json();
            if (result.candidates && result.candidates[0]?.content?.parts[0]?.text) {
                const rawText = result.candidates[0].content.parts[0].text;
                return isJsonMode ? JSON.parse(rawText) : rawText;
            } else {
                console.error("AI å›æ‡‰æ ¼å¼ä¸ç¬¦:", result);
                throw new Error("AI æœªèƒ½ç”Ÿæˆæœ‰æ•ˆçš„åˆ†æå ±å‘Šï¼Œè«‹æª¢æŸ¥ä¸»æ§å°ã€‚");
            }
        }
        
        function updateStatus(text, state = 'running') {
            const statusId = `status-${Date.now()}`;
            const icon = {
                running: `<svg class="animate-spin h-5 w-5 mr-3 text-indigo-500" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>`,
                done: `<svg class="h-5 w-5 mr-3 text-green-500" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" /></svg>`,
                error: `<svg class="h-5 w-5 mr-3 text-red-500" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd" /></svg>`,
            };
            const div = document.createElement('div');
            div.id = statusId;
            div.className = 'status-update flex items-center p-3 bg-gray-100 rounded-lg';
            div.innerHTML = `${icon[state]}<p class="text-gray-700">${text}</p>`;
            statusContainer.appendChild(div);
            setTimeout(() => div.classList.add('active'), 10);
            return statusId;
        }

        function markStatusDone(statusId) {
             const statusElement = document.getElementById(statusId);
             if (statusElement) {
                 statusElement.innerHTML = statusElement.innerHTML.replace(/<svg.*?<\/svg>/, 
                    `<svg class="h-5 w-5 mr-3 text-green-500" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" /></svg>`
                 );
             }
        }
        
        // --- åˆ†æä»»å‹™å®šç¾© ---
        async function analyzeForumSentiment(context, apiKey) {
            const prompt = `
                ä½ æ˜¯ä¸€ä½å°ˆç²¾å°ç£å¸‚å ´çš„è³‡æ·±å¸‚å ´åˆ†æå¸«ã€‚è«‹ä½ æ ¹æ“šä»¥ä¸‹å“ç‰Œæƒ…å¢ƒï¼Œåœ¨å°ç£ä¸»æµè«–å£‡ Dcard å’Œ PTT ä¸Šé€²è¡Œè¼¿æƒ…åˆ†æã€‚

                **å“ç‰Œæƒ…å¢ƒ:**
                - **ç›®æ¨™å“ç‰Œ:** ${context.target}
                - **ç«¶çˆ­å“ç‰Œ:** ${context.competitor}
                - **æ‰€å±¬ç”¢æ¥­:** ${context.industry}
                - **å•†æ¥­æ¨¡å¼:** ${context.businessModel}
                - **ä¸»è¦éŠ·å”®é€šè·¯:** ${context.salesChannels}
                - **æ ¸å¿ƒç›®æ¨™äººç¾¤:** ${context.targetAudience}

                ä½ çš„ä»»å‹™æ˜¯ç¸½çµæ¯”è¼ƒçš„çµæœï¼Œä¸¦ä»¥ä¸€å€‹ JSON ç‰©ä»¶çš„æ ¼å¼å›å‚³ã€‚JSON ç‰©ä»¶å¿…é ˆåŒ…å«ä»¥ä¸‹å¹¾å€‹ key: 
                "target_profile", "target_pros", "target_cons", "competitor_pros", "competitor_cons", "market_opportunity"ã€‚

                - **target_profile:** åœ¨è«–å£‡ä¸­ï¼Œæœ€æ¥è¿‘ã€Œ${context.targetAudience}ã€é€™å€‹è¼ªå»“çš„è¨è«–è€…æ˜¯èª°ï¼Ÿä»–å€‘æœ‰ä»€éº¼ç‰¹å¾µï¼Ÿ
                - **target_pros:** é€™äº›ç›®æ¨™äººç¾¤è®šè³ç›®æ¨™å“ç‰Œçš„å„ªé»æ˜¯ä»€éº¼ï¼Ÿ (è‡³å°‘ 2 é»)ã€‚
                - **target_cons:** é€™äº›ç›®æ¨™äººç¾¤æŠ±æ€¨ç›®æ¨™å“ç‰Œçš„ç¼ºé»æ˜¯ä»€éº¼ï¼Ÿ (è‡³å°‘ 2 é»)ã€‚
                - **competitor_pros:** ç«¶çˆ­å“ç‰Œå¸å¼•é€™äº›ç›®æ¨™äººç¾¤çš„å„ªé»ã€‚
                - **competitor_cons:** ç«¶çˆ­å“ç‰Œè®“é€™äº›ç›®æ¨™äººç¾¤å»æ­¥çš„ç¼ºé»ã€‚
                - **market_opportunity:** æ ¹æ“šä»¥ä¸Šåˆ†æï¼Œæ‰¾å‡ºä¸€å€‹èƒ½ç²¾æº–æ‰“å‹•ã€Œ${context.targetAudience}ã€çš„å¸‚å ´æºé€šæ©Ÿæœƒé»ã€‚

                è«‹ç¢ºä¿å›å‚³çš„å…§å®¹æ˜¯ç´”ç²¹çš„ JSON æ ¼å¼ï¼Œæ²’æœ‰ä»»ä½•é¡å¤–çš„æ–‡å­—æˆ–è¨»è§£ã€‚
            `;
            return await callGeminiAPI(prompt, apiKey, true);
        }

        async function analyzeSeoStrategy(context, apiKey) {
            const prompt = `
                ä½ æ˜¯ä¸€ä½é ‚å°–çš„ SEO ç­–ç•¥é¡§å•ï¼Œç‰¹åˆ¥ç†Ÿæ‚‰å°ç£çš„ google.com.tw æœå°‹å¼•æ“ç”Ÿæ…‹ã€‚
                è«‹æ¨¡æ“¬ã€Œ${context.targetAudience}ã€é€™å€‹ç›®æ¨™äººç¾¤ï¼Œåœ¨æœå°‹èˆ‡ã€Œ${context.target}ã€ç›¸é—œçš„é—œéµå­—æ™‚ï¼Œä»–å€‘æœƒçœ‹åˆ°ä»€éº¼æ¨£çš„æœå°‹çµæœé é¢ (SERP)ã€‚

                **å“ç‰Œæƒ…å¢ƒ:**
                - **ç›®æ¨™å“ç‰Œ:** ${context.target}
                - **å•†æ¥­æ¨¡å¼:** ${context.businessModel}
                - **æ ¸å¿ƒç›®æ¨™äººç¾¤:** ${context.targetAudience}

                ä½ çš„ä»»å‹™æ˜¯ç¸½çµä½ çš„ç™¼ç¾ï¼Œä¸¦ä»¥ä¸€å€‹ JSON ç‰©ä»¶çš„æ ¼å¼å›å‚³ã€‚JSON ç‰©ä»¶å¿…é ˆåŒ…å«ä»¥ä¸‹å¹¾å€‹ key: 
                "main_competitors_in_serp", "dominant_content_format", "user_intent", "content_gap_opportunity"ã€‚

                - **main_competitors_in_serp:** é™¤äº†ã€Œ${context.competitor}ã€ä¹‹å¤–ï¼Œåœ¨è‡ªç„¶æœå°‹çµæœä¸­é‚„å¸¸å‡ºç¾å“ªäº›ç«¶çˆ­è€…ï¼Ÿ
                - **dominant_content_format:** æ’åé å‰çš„å…§å®¹ä¸»è¦æ˜¯é•·ç¯‡æ–‡ç« ã€ç”¢å“æ¯”è¼ƒé ã€æ–°èç¨¿ï¼Œé‚„æ˜¯ YouTube å½±ç‰‡ï¼Ÿ
                - **user_intent:** ã€Œ${context.targetAudience}ã€åœ¨æœå°‹æ™‚ï¼Œå…¶ä¸»è¦çš„ã€Œæœå°‹æ„åœ–ã€æ˜¯ä»€éº¼ï¼Ÿè«‹æ ¹æ“š ${context.businessModel} çš„ç‰¹æ€§ä¾†åˆ†æã€‚
                - **content_gap_opportunity:** æ ¹æ“š Google çš„ã€Œå…¶ä»–äººä¹Ÿå•äº†ã€æˆ–ã€Œç›¸é—œæœå°‹ã€ï¼Œæ‰¾å‡ºä¸€å€‹èƒ½è§£æ±ºã€Œ${context.targetAudience}ã€ç—›é»ï¼Œä½†å¸‚å ´ä¸Šé‚„æ²’æœ‰å„ªè³ªå…§å®¹å›ç­”çš„å•é¡Œï¼Œä½œç‚ºå…§å®¹ç­–ç•¥åˆ‡å…¥é»ã€‚

                è«‹ç¢ºä¿å›å‚³çš„å…§å®¹æ˜¯ç´”ç²¹çš„ JSON æ ¼å¼ï¼Œæ²’æœ‰ä»»ä½•é¡å¤–çš„æ–‡å­—æˆ–è¨»è§£ã€‚
            `;
            return await callGeminiAPI(prompt, apiKey, true);
        }

        async function estimateKpiAndBudget(context, opportunity, apiKey) {
            if (!context.budget || context.budget <= 0) {
                 return { budget_allocation: [], kpi_estimations: [], rationale: "æœªæä¾›é ç®—ï¼Œç„¡æ³•é€²è¡Œä¼°ç®—ã€‚" };
            }
            const prompt = `
                ä½ æ˜¯ä¸€ä½ç¶“é©—è±å¯Œçš„æ•¸ä½åª’é«”è¦åŠƒå¸« (Media Planner)ï¼Œæ“…é•·å°ç£å¸‚å ´çš„åª’é«”æŠ•è³‡èˆ‡æˆæ•ˆé ä¼°ã€‚
                æ ¹æ“šä»¥ä¸‹å®¢æˆ¶æƒ…å¢ƒèˆ‡ä½ å·²çŸ¥çš„å¸‚å ´æ©Ÿæœƒé»ï¼Œè¦åŠƒä¸€ä»½åˆæ­¥çš„é ç®—åˆ†é…èˆ‡ KPI é ä¼°ã€‚

                **å®¢æˆ¶æƒ…å¢ƒ:**
                - **ç”¢æ¥­:** ${context.industry}
                - **å•†æ¥­æ¨¡å¼:** ${context.businessModel}
                - **ç›®æ¨™äººç¾¤:** ${context.targetAudience}
                - **ç¸½é ç®— (TWD):** ${context.budget.toLocaleString()}
                - **æ ¸å¿ƒç­–ç•¥æ©Ÿæœƒé»:** ${opportunity}

                ä½ çš„ä»»å‹™æ˜¯ç”¢å‡ºä¸€å€‹ JSON ç‰©ä»¶ï¼ŒåŒ…å« "budget_allocation", "kpi_estimations", "rationale" ä¸‰å€‹ keyã€‚

                1.  **budget_allocation:** ä¸€å€‹é™£åˆ—ã€‚æ ¹æ“šã€Œæ ¸å¿ƒç­–ç•¥æ©Ÿæœƒé»ã€ï¼Œå»ºè­°å°‡é ç®—åˆ†é…åˆ° 2-3 å€‹æœ€ç›¸é—œçš„åª’é«”æ¸ é“ (ä¾‹å¦‚ï¼šä»˜è²»æœå°‹, ç¤¾ç¾¤å»£å‘Š, å…§å®¹è¡ŒéŠ·, å½±éŸ³å»£å‘Š)ï¼Œä¸¦çµ¦å‡ºæ¯å€‹æ¸ é“çš„**ç™¾åˆ†æ¯”**å’Œ**é‡‘é¡**ã€‚
                2.  **kpi_estimations:** ä¸€å€‹é™£åˆ—ã€‚ç‚ºæ¯å€‹å»ºè­°çš„æ¸ é“ï¼Œæä¾›**å¯é‡åŒ–çš„ KPI é ä¼°**ã€‚è«‹ä½¿ç”¨å°ç£å¸‚å ´çš„å…¸å‹ benchmarks (åŸºæº–)ã€‚
                    -   **å°æ–¼ B2C:** éœ€åŒ…å« "Impressions" (æ›å…‰), "CTR" (é»æ“Šç‡), "Clicks" (é»æ“Š), "CPC" (å–®æ¬¡é»æ“Šæˆæœ¬), "Est_Conversions" (é ä¼°è¨‚å–®æ•¸ï¼Œè«‹è‡ªè¨‚ä¸€å€‹åˆç†çš„è½‰æ›ç‡)ã€‚
                    -   **å°æ–¼ B2B:** éœ€åŒ…å« "Impressions", "CTR", "Clicks", "CPC", "Est_Leads" (é ä¼°æ½›åœ¨å®¢æˆ¶æ•¸ï¼Œè«‹è‡ªè¨‚ä¸€å€‹åˆç†çš„è½‰æ›ç‡)ã€‚
                3.  **rationale:** ä¸€æ®µç°¡çŸ­æ–‡å­—ï¼Œèªªæ˜ä½ é€™æ¨£è¦åŠƒé ç®—å„ªå…ˆç´šçš„ç†ç”±ã€‚

                è«‹ç¢ºä¿å›å‚³çš„å…§å®¹æ˜¯ç´”ç²¹çš„ JSON æ ¼å¼ã€‚
            `;
            return await callGeminiAPI(prompt, apiKey, true);
        }


        // --- Module 3: ææ¡ˆç”Ÿæˆå¼•æ“ ('åˆæˆå¼•æ“') ---
        async function synthesizeFinalReport(context, forumAnalysis, seoAnalysis, kpiEstimation, apiKey) {
             const prompt = `
                ä½ æ˜¯ä¸€ä½é¦–å¸­åª’é«”ç­–ç•¥ç¸½ç›£ï¼Œä½ çš„ä»»å‹™æ˜¯å°‡ä¸‹å±¬åˆ†æå¸«æäº¤çš„æ‰€æœ‰ JSON è³‡æ–™ï¼Œæ•´åˆæˆä¸€ä»½çµ¦å®¢æˆ¶çœ‹çš„ã€å°ˆæ¥­ä¸”æœ‰èªªæœåŠ›çš„ã€Œå¸‚å ´æ©Ÿæœƒèˆ‡åˆæ­¥ç­–ç•¥å»ºè­°ã€å ±å‘Šã€‚å ±å‘Šéœ€ä»¥ HTML æ ¼å¼å‘ˆç¾ã€‚

                **å®¢æˆ¶è³‡æ–™:**
                - **ç›®æ¨™å“ç‰Œ:** ${context.target}
                - **æ ¸å¿ƒç›®æ¨™äººç¾¤:** ${context.targetAudience}
                - **ç¸½é ç®— (TWD):** ${context.budget > 0 ? context.budget.toLocaleString() : 'æœªæä¾›'}

                **åˆ†æå¸«æäº¤çš„è³‡æ–™:**
                1.  **è«–å£‡è¼¿æƒ…åˆ†æ:** ${JSON.stringify(forumAnalysis, null, 2)}
                2.  **SEO èˆ‡å…§å®¹ç­–ç•¥åˆ†æ:** ${JSON.stringify(seoAnalysis, null, 2)}
                3.  **é ç®—èˆ‡ KPI é ä¼°:** ${JSON.stringify(kpiEstimation, null, 2)}

                **ä½ çš„ä»»å‹™:**
                è«‹æ ¹æ“šä»¥ä¸Šæ‰€æœ‰è³‡è¨Šï¼Œæ’°å¯«ä¸€ä»½åŒ…å«ä»¥ä¸‹ç« ç¯€çš„ HTML å ±å‘Šï¼Œä¸¦åœ¨ä½ çš„åˆ†æèˆ‡å»ºè­°ä¸­ï¼Œ**å§‹çµ‚ç·Šæ‰£å¦‚ä½•æ‰“å‹•ã€Œ${context.targetAudience}ã€é€™å€‹æ ¸å¿ƒç›®æ¨™äººç¾¤**ï¼š

                1.  **<h2>å¸‚å ´ç¸½é«”å°è±¡</h2>**
                    - ä¸€æ®µç°¡çŸ­ç¸½çµï¼Œé»å‡º ${context.target} ç›®å‰åœ¨ã€Œ${context.targetAudience}ã€å¿ƒä¸­çš„å½¢è±¡èˆ‡æŒ‘æˆ°ã€‚

                2.  **<h2>æ ¸å¿ƒæ´å¯Ÿèˆ‡æ©Ÿæœƒé»</h2>**
                    -   <h3>æ´å¯Ÿä¸€ï¼šç›®æ¨™äººç¾¤çš„çœŸå¯¦å¿ƒè²</h3>
                    -   <h3>æ´å¯ŸäºŒï¼šæœå°‹æˆ°å ´çš„å…§å®¹ç¼ºå£</h3>
                    -   <h3>ç­–ç•¥æ©Ÿæœƒé»ï¼šæˆ‘å€‘è©²å¾ä½•è™•åˆ‡å…¥ï¼Ÿ</h3>

                3.  **<h2>åˆæ­¥ç­–ç•¥å»ºè­°</h2>**
                    -   <h3>å»ºè­°ä¸€ï¼šå…§å®¹ç­–ç•¥æ–¹å‘</h3>
                    -   <h3>å»ºè­°äºŒï¼šæºé€šè¨Šæ¯åˆ‡è§’</h3>
                
                4.  **<h2>é ç®—è¦åŠƒèˆ‡é æœŸæ•ˆç›Š</h2>**
                    -   <p>åŸºæ–¼å°å¹£ **${context.budget > 0 ? context.budget.toLocaleString() : 'æœªæä¾›'}** çš„é ç®—ï¼Œæˆ‘å€‘å»ºè­°åˆæ­¥çš„è³‡æºåˆ†é…èˆ‡æ•ˆç›Šé ä¼°å¦‚ä¸‹ï¼š</p>
                    -   <h3>é ç®—åˆ†é…å»ºè­°</h3>
                    -   (æ­¤è™•ä½¿ç”¨ HTML table å‘ˆç¾ kpiEstimation.budget_allocation çš„å…§å®¹)
                    -   <h3>é æœŸæ•ˆç›Š (KPI) ä¼°ç®—</h3>
                    -   (æ­¤è™•ä½¿ç”¨ HTML table å‘ˆç¾ kpiEstimation.kpi_estimations çš„å…§å®¹)
                    -   <h3>è¦åŠƒèªªæ˜</h3>
                    -   (æ­¤è™•ç”¨ <p> å‘ˆç¾ kpiEstimation.rationale çš„å…§å®¹)
                
                **æ ¼å¼è¦æ±‚:**
                -   è«‹åš´æ ¼ä½¿ç”¨ <h2> å’Œ <h3> ä½œç‚ºæ¨™é¡Œã€‚
                -   æ®µè½ä½¿ç”¨ <p>ï¼Œåˆ—è¡¨ä½¿ç”¨ <ul> å’Œ <li>ã€‚è¡¨æ ¼ä½¿ç”¨ <table>, <th>, <tr>, <td>ã€‚
                -   å°æ–¼å“ç‰Œåç¨±æˆ–é—œéµå­—è©ï¼Œä½¿ç”¨ <strong> æ¨™ç±¤å¼·èª¿ã€‚
                -   å›æ‡‰å…§å®¹**åƒ…åŒ…å« HTML**ï¼Œä¸è¦åŒ…å« \`\`\`html, \`\`\`, <html>, <body> ç­‰æ¨™ç±¤ã€‚
            `;
             return await callGeminiAPI(prompt, apiKey, false);
        }

        // --- ä¸»åŸ·è¡Œæµç¨‹ ---
        async function handleGenerateClick() {
            // å°ˆæ¡ˆ ID è®Šæˆå¯é¸çš„
            const projectId = projectIdInput.value.trim();
            if (projectId) {
                // å¦‚æœæœ‰è¼¸å…¥å°ˆæ¡ˆIDï¼Œå„²å­˜åˆ°å…¨åŸŸè®Šæ•¸
                currentProjectId = projectId;
                console.log('ä½¿ç”¨å°ˆæ¡ˆID:', projectId);
            } else {
                // å¦‚æœæ²’æœ‰å°ˆæ¡ˆIDï¼Œä½¿ç”¨æ™‚é–“æˆ³ä½œç‚ºè‡¨æ™‚ID
                currentProjectId = `temp_${Date.now()}`;
                console.log('ä½¿ç”¨è‡¨æ™‚ID:', currentProjectId);
            }
            
            const userApiKey = apiKeyInput.value.trim();
            if (!userApiKey) {
                alert('è«‹åœ¨æœ€ä¸Šæ–¹è¼¸å…¥æ‚¨çš„ Google Gemini API é‡‘é‘°ã€‚');
                return;
            }

            const analysisContext = {
                target: targetBrandInput.value.trim(),
                competitor: competitorBrandInput.value.trim(),
                industry: industryInput.value,
                businessModel: businessModelInput.value,
                salesChannels: salesChannelsInput.value.trim() || 'æœªæä¾›',
                targetAudience: targetAudienceInput.value.trim() || 'æœªæŒ‡å®š',
                budget: parseInt(advertisingBudgetInput.value, 10) || 0,
                projectId: currentProjectId // åŠ å…¥ project ID åˆ°åˆ†æä¸Šä¸‹æ–‡
            };

            if (!analysisContext.target || !analysisContext.competitor) {
                alert('è«‹å‹™å¿…è¼¸å…¥ç›®æ¨™å“ç‰Œå’Œç«¶çˆ­å°æ‰‹ã€‚');
                return;
            }

            generateBtn.disabled = true;
            generateBtn.innerHTML = `åˆ†æä¸­...`;
            statusContainer.innerHTML = '';
            proposalOutput.innerHTML = '';

            try {
                const status1 = updateStatus(`åˆ†æ **${analysisContext.target}** åœ¨ç›®æ¨™äººç¾¤ä¸­çš„è«–å£‡è¼¿æƒ…...`);
                const forumData = await analyzeForumSentiment(analysisContext, userApiKey);
                markStatusDone(status1);

                const status2 = updateStatus(`åˆ†æ **${analysisContext.target}** çš„ SEO èˆ‡å…§å®¹ç­–ç•¥...`);
                const seoData = await analyzeSeoStrategy(analysisContext, userApiKey);
                markStatusDone(status2);
                
                const opportunity = forumData.market_opportunity || seoData.content_gap_opportunity;
                
                const status3 = updateStatus(`é€²è¡Œé ç®—è¦åŠƒèˆ‡ KPI ä¼°ç®—...`);
                const kpiData = await estimateKpiAndBudget(analysisContext, opportunity, userApiKey);
                markStatusDone(status3);

                const status4 = updateStatus(`ç¶œåˆæ‰€æœ‰æ´å¯Ÿï¼Œç”Ÿæˆæœ€çµ‚å ±å‘Š...`);
                const finalReportHtml = await synthesizeFinalReport(analysisContext, forumData, seoData, kpiData, userApiKey);
                markStatusDone(status4);

                // åœ¨å ±å‘Šé–‹é ­åŠ å…¥ project ID è³‡è¨Š
                const projectInfoHtml = `
                    <div style="background-color: #f0f9ff; border: 1px solid #0ea5e9; border-radius: 8px; padding: 16px; margin-bottom: 24px;">
                        <h3 style="color: #0c4a6e; margin: 0 0 8px 0; font-size: 18px;">ğŸ“‹ å°ˆæ¡ˆè³‡è¨Š</h3>
                        <p style="color: #0369a1; margin: 0; font-weight: 500;">å°ˆæ¡ˆ ID: <strong>${currentProjectId}</strong></p>
                        <p style="color: #0369a1; margin: 4px 0 0 0; font-size: 14px;">ç”Ÿæˆæ™‚é–“: ${new Date().toLocaleString('zh-TW')}</p>
                    </div>
                `;
                
                proposalOutput.innerHTML = projectInfoHtml + finalReportHtml;

            } catch (error) {
                console.error('ç”Ÿæˆææ¡ˆæ™‚ç™¼ç”ŸéŒ¯èª¤:', error);
                updateStatus(`ç”Ÿæˆå ±å‘Šæ™‚ç™¼ç”ŸéŒ¯èª¤: ${error.message}`, 'error');
                proposalOutput.innerHTML = `<p class="text-red-600 font-bold">æŠ±æ­‰ï¼Œè™•ç†éç¨‹ä¸­ç™¼ç”ŸéŒ¯èª¤ã€‚è«‹æª¢æŸ¥ç€è¦½å™¨çš„ä¸»æ§å°ä»¥ç²å–è©³ç´°æŠ€è¡“è³‡è¨Šï¼Œç„¶å¾Œå†è©¦ä¸€æ¬¡ã€‚</p>`;
            } finally {
                generateBtn.disabled = false;
                generateBtn.innerHTML = `é‡æ–°ç”Ÿæˆ AI åˆ†æå ±å‘Š`;
            }
        }

        generateBtn.addEventListener('click', handleGenerateClick);

        // æ–°å¢ï¼šGoogle Drive ç›¸é—œå‡½æ•¸
        async function setupGoogleDrive() {
            try {
                // è¼‰å…¥ Google Drive API
                await new Promise((resolve, reject) => {
                    const script = document.createElement('script');
                    script.src = 'https://apis.google.com/js/api.js';
                    script.onload = () => {
                        gapi.load('client', async () => {
                            try {
                                await gapi.client.init({});
                                await gapi.client.load('drive', 'v3');
                                resolve();
                            } catch (error) {
                                reject(error);
                            }
                        });
                    };
                    script.onerror = reject;
                    document.head.appendChild(script);
                });

                // è®€å–è³‡æ–™å¤¾è¨­å®š
                folderStructure.centralFolder = document.getElementById('centralFolderName')?.value || 'iStaging_å°ˆæ¡ˆç®¡ç†';
                folderStructure.mediaplanSubfolder = document.getElementById('mediaplanSubfolder')?.value || '02_åª’é«”ææ¡ˆ';

                // å»ºç«‹è³‡æ–™å¤¾çµæ§‹
                await setupCentralizedFolderStructure();
                isGoogleDriveEnabled = true;
                
                console.log('Google Drive è¨­å®šå®Œæˆ');
                return true;
            } catch (error) {
                console.error('Google Drive è¨­å®šå¤±æ•—:', error);
                return false;
            }
        }

        async function setupCentralizedFolderStructure() {
            try {
                // 1. å»ºç«‹æˆ–æ‰¾åˆ°ä¸»è¦å°ˆæ¡ˆè³‡æ–™å¤¾
                const centralFolderId = await findOrCreateFolder(folderStructure.centralFolder, null);
                folderIds.central = centralFolderId;
                
                // 2. å»ºç«‹æˆ–æ‰¾åˆ°å°ˆæ¡ˆå­è³‡æ–™å¤¾
                if (currentProjectId) {
                    const projectFolderName = `[${currentProjectId}]_å°ˆæ¡ˆè³‡æ–™`;
                    const projectFolderId = await findOrCreateFolder(projectFolderName, centralFolderId);
                    folderIds.project = projectFolderId;
                    
                    // 3. å»ºç«‹æˆ–æ‰¾åˆ°åª’é«”ææ¡ˆå­è³‡æ–™å¤¾
                    const mediaplanFolderId = await findOrCreateFolder(folderStructure.mediaplanSubfolder, projectFolderId);
                    folderIds.mediaplan = mediaplanFolderId;
                    
                    console.log('é›†ä¸­åŒ–è³‡æ–™å¤¾çµæ§‹å»ºç«‹å®Œæˆ:', {
                        central: centralFolderId,
                        project: projectFolderId,
                        mediaplan: mediaplanFolderId
                    });
                    
                    return true;
                }
                
                return false;
            } catch (error) {
                console.error('å»ºç«‹è³‡æ–™å¤¾çµæ§‹å¤±æ•—:', error);
                throw error;
            }
        }

        async function findOrCreateFolder(folderName, parentId) {
            try {
                let query = `mimeType='application/vnd.google-apps.folder' and name='${folderName}' and trashed=false`;
                if (parentId) {
                    query += ` and '${parentId}' in parents`;
                }
                
                const response = await gapi.client.drive.files.list({ 
                    q: query, 
                    fields: 'files(id)' 
                });
                
                if (response.result.files && response.result.files.length > 0) {
                    return response.result.files[0].id;
                } else {
                    const folderMetadata = {
                        name: folderName,
                        mimeType: 'application/vnd.google-apps.folder'
                    };
                    
                    if (parentId) {
                        folderMetadata.parents = [parentId];
                    }
                    
                    const createResponse = await gapi.client.drive.files.create({ 
                        resource: folderMetadata, 
                        fields: 'id' 
                    });
                    
                    return createResponse.result.id;
                }
            } catch (error) {
                console.error(`å»ºç«‹è³‡æ–™å¤¾ ${folderName} å¤±æ•—:`, error);
                throw error;
            }
        }

        async function saveToGoogleDrive(content, fileName) {
            try {
                if (!isGoogleDriveEnabled) {
                    const driveEnabled = await setupGoogleDrive();
                    if (!driveEnabled) {
                        console.log('Google Drive æœªå•Ÿç”¨ï¼Œè·³éå„²å­˜');
                        return false;
                    }
                }

                // ç¢ºä¿è³‡æ–™å¤¾çµæ§‹å·²å»ºç«‹
                if (!folderIds.mediaplan) {
                    await setupCentralizedFolderStructure();
                }

                // å»ºç«‹æª”æ¡ˆå…§å®¹
                const fileContent = {
                    projectId: currentProjectId,
                    content: content,
                    generatedAt: new Date().toISOString(),
                    tool: 'mediaplan'
                };

                const blob = new Blob([JSON.stringify(fileContent, null, 2)], { type: 'application/json' });
                const metadata = { 
                    name: fileName, 
                    mimeType: 'application/json', 
                    parents: [folderIds.mediaplan] 
                };
                
                const form = new FormData();
                form.append('metadata', new Blob([JSON.stringify(metadata)], { type: 'application/json' }));
                form.append('file', blob);
                
                // éœ€è¦ç”¨æˆ¶æˆæ¬Šæ‰èƒ½ä¸Šå‚³
                console.log('éœ€è¦ç”¨æˆ¶æˆæ¬Šæ‰èƒ½ä¸Šå‚³åˆ° Google Drive');
                return false;
                
            } catch (error) {
                console.error('å„²å­˜åˆ° Google Drive å¤±æ•—:', error);
                return false;
            }
        }
    </script>
</body>
</html>

