<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TourPage AI ç¶²ç«™æ–‡æ¡ˆç”Ÿæˆå™¨</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Noto Sans TC', sans-serif; }
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <div class="container mx-auto px-4 py-8 max-w-6xl">
        <!-- Header -->
        <div class="text-center mb-8">
            <h1 class="text-4xl font-bold text-gray-800 mb-2">ğŸŒ TourPage AI ç¶²ç«™æ–‡æ¡ˆç”Ÿæˆå™¨</h1>
            <p class="text-gray-600">æ ¹æ“šæ‚¨çš„ç´ æéœ€æ±‚è¡¨èˆ‡è¡ŒéŠ·åƒæ•¸ï¼Œè‡ªå‹•ç”Ÿæˆå¤šèªè¨€ç¶²é æ–‡æ¡ˆ</p>
        </div>

        <!-- API Key è¨­å®š -->
        <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
            <h2 class="text-xl font-semibold text-gray-800 mb-4">ğŸ”‘ API è¨­å®š</h2>
            <div class="flex gap-4">
                <input type="password" id="gemini-api-key" placeholder="è«‹è¼¸å…¥ Google Gemini API Key" 
                    class="flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500">
                <button onclick="saveApiKey()" class="px-6 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700">
                    å„²å­˜ API Key
                </button>
            </div>
            <p class="text-sm text-gray-500 mt-2">
                ğŸ’¡ å‰å¾€ <a href="https://aistudio.google.com/" target="_blank" class="text-purple-600 underline">Google AI Studio</a> å–å¾—å…è²» API Key
            </p>
        </div>

        <!-- æ­¥é©Ÿå°èˆª -->
        <div class="flex justify-center mb-6">
            <div class="flex space-x-4">
                <div class="step-indicator active" data-step="1">
                    <div class="step-number">1</div>
                    <div class="step-label">ä¸Šå‚³ CSV</div>
                </div>
                <div class="step-indicator" data-step="2">
                    <div class="step-number">2</div>
                    <div class="step-label">åƒæ•¸è¨­å®š</div>
                </div>
                <div class="step-indicator" data-step="3">
                    <div class="step-number">3</div>
                    <div class="step-label">ç”Ÿæˆæ–‡æ¡ˆ</div>
                </div>
                <div class="step-indicator" data-step="4">
                    <div class="step-number">4</div>
                    <div class="step-label">ä¸‹è¼‰çµæœ</div>
                </div>
            </div>
        </div>

        <!-- æ­¥é©Ÿ 1: ä¸Šå‚³ CSV -->
        <div id="step-1" class="step-panel active bg-white rounded-lg shadow-lg p-6 mb-6">
            <h2 class="text-xl font-semibold text-gray-800 mb-4">ğŸ“ æ­¥é©Ÿ 1: ä¸Šå‚³ TourPage ç´ æéœ€æ±‚è¡¨</h2>
            <div class="border-2 border-dashed border-gray-300 rounded-lg p-8 text-center">
                <input type="file" id="csv-file-input" accept=".csv" class="hidden" onchange="handleFileUpload(event)">
                <label for="csv-file-input" class="cursor-pointer">
                    <svg class="mx-auto h-12 w-12 text-gray-400 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path>
                    </svg>
                    <p class="text-gray-600 mb-2">é»æ“Šä¸Šå‚³ CSV æª”æ¡ˆ</p>
                    <p class="text-sm text-gray-400">æ”¯æ´æ ¼å¼ï¼šCSV UTF-8ï¼ˆé€—è™Ÿåˆ†éš”ï¼‰</p>
                </label>
            </div>
            <div id="file-preview" class="mt-4 hidden">
                <h3 class="font-semibold text-gray-700 mb-2">æª”æ¡ˆé è¦½ï¼š</h3>
                <div class="bg-gray-50 rounded p-4 max-h-64 overflow-y-auto">
                    <table id="preview-table" class="w-full text-sm"></table>
                </div>
            </div>
        </div>

        <!-- æ­¥é©Ÿ 2: åƒæ•¸è¨­å®š -->
        <div id="step-2" class="step-panel hidden bg-white rounded-lg shadow-lg p-6 mb-6">
            <h2 class="text-xl font-semibold text-gray-800 mb-4">âš™ï¸ æ­¥é©Ÿ 2: è¡ŒéŠ·åƒæ•¸è¨­å®š</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">ç›®æ¨™äººç¾¤</label>
                    <select id="target-audience" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500">
                        <option value="B2C">B2Cï¼ˆå¼·èª¿æƒ…æ„Ÿã€é«”é©—ï¼‰</option>
                        <option value="B2B">B2Bï¼ˆå¼·èª¿æ•ˆç›Šã€è§£æ±ºæ–¹æ¡ˆï¼‰</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">ç›®æ¨™å¸‚å ´</label>
                    <select id="target-market" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500">
                        <option value="zh-TW">ç¹é«”ä¸­æ–‡ï¼ˆå°ç£ï¼‰</option>
                        <option value="zh-CN">ç®€ä½“ä¸­æ–‡ï¼ˆä¸­åœ‹ï¼‰</option>
                        <option value="en">Englishï¼ˆç¾åœ‹/é€šç”¨ï¼‰</option>
                        <option value="ja">æ—¥æœ¬èªï¼ˆæ—¥æœ¬ï¼‰</option>
                        <option value="ko">í•œêµ­ì–´ï¼ˆéŸ“åœ‹ï¼‰</option>
                        <option value="de">Deutschï¼ˆå¾·åœ‹ï¼‰</option>
                        <option value="fr">FranÃ§aisï¼ˆæ³•åœ‹ï¼‰</option>
                        <option value="it">Italianoï¼ˆç¾©å¤§åˆ©ï¼‰</option>
                        <option value="th">à¸ à¸²à¸©à¸²à¹„à¸—à¸¢ï¼ˆæ³°åœ‹ï¼‰</option>
                        <option value="vi">Tiáº¿ng Viá»‡tï¼ˆè¶Šå—ï¼‰</option>
                        <option value="es">EspaÃ±olï¼ˆå¢¨è¥¿å“¥/è¥¿ç­ç‰™ï¼‰</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">è¡ŒéŠ·é‡é»</label>
                    <select id="marketing-focus" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500">
                        <option value="brand">å“ç‰Œä»‹ç´¹</option>
                        <option value="product">å•†å“ä»‹ç´¹</option>
                        <option value="usp">USP å¼·åŒ–</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">å¿…æå…§å®¹ï¼ˆé¸å¡«ï¼‰</label>
                    <input type="text" id="required-content" placeholder="é—œéµå­—æˆ– Slogan" 
                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500">
                </div>
            </div>
        </div>

        <!-- æ­¥é©Ÿ 3: ç”Ÿæˆæ–‡æ¡ˆ -->
        <div id="step-3" class="step-panel hidden bg-white rounded-lg shadow-lg p-6 mb-6">
            <h2 class="text-xl font-semibold text-gray-800 mb-4">ğŸ¤– æ­¥é©Ÿ 3: ç”Ÿæˆæ–‡æ¡ˆ</h2>
            <button onclick="generateCopy()" id="generate-btn" 
                class="w-full px-6 py-3 bg-gradient-to-r from-purple-600 to-indigo-600 text-white rounded-lg hover:from-purple-700 hover:to-indigo-700 font-semibold text-lg">
                é»æ“Šç”Ÿæˆæ–‡æ¡ˆ
            </button>
            <div id="generation-status" class="mt-4 hidden">
                <div class="flex items-center space-x-2 text-gray-600">
                    <div class="spinner border-4 border-purple-200 border-t-purple-600 rounded-full w-6 h-6 animate-spin"></div>
                    <span id="status-text">æ­£åœ¨ç”Ÿæˆæ–‡æ¡ˆ...</span>
                </div>
            </div>
        </div>

        <!-- æ­¥é©Ÿ 4: ä¸‹è¼‰çµæœ -->
        <div id="step-4" class="step-panel hidden bg-white rounded-lg shadow-lg p-6 mb-6">
            <h2 class="text-xl font-semibold text-gray-800 mb-4">ğŸ“¥ æ­¥é©Ÿ 4: ä¸‹è¼‰çµæœ</h2>
            <div id="results-preview" class="mb-4">
                <h3 class="font-semibold text-gray-700 mb-2">ç”Ÿæˆçµæœé è¦½ï¼š</h3>
                <div class="bg-gray-50 rounded p-4 max-h-96 overflow-y-auto">
                    <table id="results-table" class="w-full text-sm"></table>
                </div>
            </div>
            <button onclick="downloadResults()" 
                class="w-full px-6 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 font-semibold">
                ä¸‹è¼‰ Excel (CSV) è¼¸å‡ºæª”
            </button>
        </div>
    </div>

    <script>
        // å…¨åŸŸç‹€æ…‹
        let csvData = null;
        let generatedCopy = null;
        let currentStep = 1;

        // è¼‰å…¥å„²å­˜çš„ API Key
        window.addEventListener('load', function() {
            const savedApiKey = localStorage.getItem('gemini-api-key');
            if (savedApiKey) {
                document.getElementById('gemini-api-key').value = savedApiKey;
            }
        });

        // å„²å­˜ API Key
        function saveApiKey() {
            const apiKey = document.getElementById('gemini-api-key').value.trim();
            if (!apiKey) {
                alert('è«‹è¼¸å…¥ API Key');
                return;
            }
            localStorage.setItem('gemini-api-key', apiKey);
            alert('API Key å·²å„²å­˜');
        }

        // è™•ç†æª”æ¡ˆä¸Šå‚³
        function handleFileUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            Papa.parse(file, {
                header: true,
                complete: function(results) {
                    csvData = results.data;
                    displayPreview(csvData);
                    showStep(2);
                },
                error: function(error) {
                    alert('CSV æª”æ¡ˆè§£æå¤±æ•—ï¼š' + error.message);
                }
            });
        }

        // é¡¯ç¤ºé è¦½
        function displayPreview(data) {
            if (!data || data.length === 0) return;

            const preview = document.getElementById('file-preview');
            const table = document.getElementById('preview-table');
            
            // å–å¾—æ‰€æœ‰æ¬„ä½
            const headers = Object.keys(data[0]);
            
            // å»ºç«‹è¡¨é ­
            let html = '<thead class="bg-gray-200"><tr>';
            headers.forEach(header => {
                html += `<th class="px-3 py-2 text-left font-semibold">${header}</th>`;
            });
            html += '</tr></thead><tbody>';

            // é¡¯ç¤ºå‰ 5 ç­†è³‡æ–™
            data.slice(0, 5).forEach(row => {
                html += '<tr class="border-b">';
                headers.forEach(header => {
                    html += `<td class="px-3 py-2">${row[header] || ''}</td>`;
                });
                html += '</tr>';
            });
            html += '</tbody>';

            table.innerHTML = html;
            preview.classList.remove('hidden');
        }

        // é¡¯ç¤ºæ­¥é©Ÿ
        function showStep(step) {
            // éš±è—æ‰€æœ‰æ­¥é©Ÿ
            document.querySelectorAll('.step-panel').forEach(panel => {
                panel.classList.add('hidden');
                panel.classList.remove('active');
            });

            // é¡¯ç¤ºæŒ‡å®šæ­¥é©Ÿ
            const stepPanel = document.getElementById(`step-${step}`);
            if (stepPanel) {
                stepPanel.classList.remove('hidden');
                stepPanel.classList.add('active');
            }

            // æ›´æ–°æ­¥é©ŸæŒ‡ç¤ºå™¨
            document.querySelectorAll('.step-indicator').forEach((indicator, index) => {
                if (index + 1 <= step) {
                    indicator.classList.add('active');
                } else {
                    indicator.classList.remove('active');
                }
            });

            currentStep = step;
        }

        // ç”Ÿæˆæ–‡æ¡ˆ
        async function generateCopy() {
            if (!csvData || csvData.length === 0) {
                alert('è«‹å…ˆä¸Šå‚³ CSV æª”æ¡ˆ');
                return;
            }

            const apiKey = localStorage.getItem('gemini-api-key');
            if (!apiKey) {
                alert('è«‹å…ˆè¨­å®š API Key');
                return;
            }

            const targetAudience = document.getElementById('target-audience').value;
            const targetMarket = document.getElementById('target-market').value;
            const marketingFocus = document.getElementById('marketing-focus').value;
            const requiredContent = document.getElementById('required-content').value;

            // é¡¯ç¤ºç”Ÿæˆç‹€æ…‹
            const statusDiv = document.getElementById('generation-status');
            const statusText = document.getElementById('status-text');
            statusDiv.classList.remove('hidden');
            statusText.textContent = 'æ­£åœ¨ç”Ÿæˆæ–‡æ¡ˆ...';

            try {
                generatedCopy = await generateCopyWithAI(csvData, {
                    targetAudience,
                    targetMarket,
                    marketingFocus,
                    requiredContent
                }, apiKey);

                displayResults(generatedCopy);
                showStep(4);
            } catch (error) {
                alert('ç”Ÿæˆå¤±æ•—ï¼š' + error.message);
                console.error(error);
            } finally {
                statusDiv.classList.add('hidden');
            }
        }

        // ä½¿ç”¨ AI ç”Ÿæˆæ–‡æ¡ˆ
        async function generateCopyWithAI(data, params, apiKey) {
            const languageNames = {
                'zh-TW': 'ç¹é«”ä¸­æ–‡ï¼ˆå°ç£ï¼‰',
                'zh-CN': 'ç®€ä½“ä¸­æ–‡ï¼ˆä¸­åœ‹ï¼‰',
                'en': 'Englishï¼ˆç¾åœ‹/é€šç”¨ï¼‰',
                'ja': 'æ—¥æœ¬èªï¼ˆæ—¥æœ¬ï¼‰',
                'ko': 'í•œêµ­ì–´ï¼ˆéŸ“åœ‹ï¼‰',
                'de': 'Deutschï¼ˆå¾·åœ‹ï¼‰',
                'fr': 'FranÃ§aisï¼ˆæ³•åœ‹ï¼‰',
                'it': 'Italianoï¼ˆç¾©å¤§åˆ©ï¼‰',
                'th': 'à¸ à¸²à¸©à¸²à¹„à¸—à¸¢ï¼ˆæ³°åœ‹ï¼‰',
                'vi': 'Tiáº¿ng Viá»‡tï¼ˆè¶Šå—ï¼‰',
                'es': 'EspaÃ±olï¼ˆå¢¨è¥¿å“¥/è¥¿ç­ç‰™ï¼‰'
            };

            const languageName = languageNames[params.targetMarket] || params.targetMarket;
            const isChinese = params.targetMarket.startsWith('zh');

            const results = [];

            for (const row of data) {
                const blockName = row['å€å¡Šåç¨±'] || row['å€å¡Šåç¨±'] || '';
                const itemCode = row['é …ç›®ä»£ç¢¼'] || row['é …ç›®ä»£ç¢¼'] || '';
                const itemDesc = row['é …ç›®èªªæ˜'] || row['é …ç›®èªªæ˜'] || '';
                const originalText = row['å®¢æˆ¶å¡«å¯«ï¼†æä¾›'] || row['å®¢æˆ¶å¡«å¯«ï¼†æä¾›'] || row['ç¯„ä¾‹'] || '';

                if (!blockName || !itemCode) continue;

                const prompt = `ä½ æ˜¯ä¸€ä½å°ˆæ¥­çš„${languageName}æ–‡æ¡ˆæ’°å¯«å°ˆå®¶ï¼Œå°ˆç²¾æ–¼${params.targetAudience === 'B2C' ? 'B2C æ¶ˆè²»è€…è¡ŒéŠ·' : 'B2B ä¼æ¥­è¡ŒéŠ·'}ã€‚

è«‹æ ¹æ“šä»¥ä¸‹è³‡è¨Šï¼Œç”Ÿæˆå„ªåŒ–çš„${languageName}æ–‡æ¡ˆï¼š

**å€å¡Šé¡å‹**: ${blockName}
**é …ç›®**: ${itemDesc}
**åŸå§‹æ–‡æ¡ˆ**: ${originalText}
**è¡ŒéŠ·é‡é»**: ${params.marketingFocus === 'brand' ? 'å“ç‰Œä»‹ç´¹' : params.marketingFocus === 'product' ? 'å•†å“ä»‹ç´¹' : 'USP å¼·åŒ–'}
**ç›®æ¨™äººç¾¤**: ${params.targetAudience}
${params.requiredContent ? `**å¿…æå…§å®¹**: ${params.requiredContent}` : ''}

è¦æ±‚ï¼š
1. ç”Ÿæˆå°ˆæ¥­ã€å¸å¼•äººçš„${languageName}æ–‡æ¡ˆ
2. ç¬¦åˆ${params.targetAudience}çš„æºé€šé¢¨æ ¼
3. ${params.marketingFocus === 'brand' ? 'å¼·èª¿å“ç‰Œåƒ¹å€¼å’Œå½¢è±¡' : params.marketingFocus === 'product' ? 'çªå‡ºç”¢å“ç‰¹è‰²å’Œå„ªå‹¢' : 'å¼·åŒ–ç¨ç‰¹è³£é»'}
4. ${params.requiredContent ? 'å¿…é ˆåŒ…å«ï¼š' + params.requiredContent : ''}
5. ä¿æŒç°¡æ½”æœ‰åŠ›ï¼Œé©åˆç¶²é ä½¿ç”¨

${isChinese ? 'åªè¼¸å‡ºå„ªåŒ–å¾Œçš„æ–‡æ¡ˆï¼Œä¸éœ€è¦å…¶ä»–èªªæ˜ã€‚' : 'è«‹è¼¸å‡ºå…©è¡Œï¼šç¬¬ä¸€è¡Œæ˜¯ç›®æ¨™èªè¨€æ–‡æ¡ˆï¼Œç¬¬äºŒè¡Œæ˜¯ä¸­æ–‡ç¿»è­¯ï¼Œæ ¼å¼ç‚ºï¼š\n[ç›®æ¨™èªè¨€æ–‡æ¡ˆ]\n[ä¸­æ–‡ç¿»è­¯]'}`;

                try {
                    const response = await fetch(
                        `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=${apiKey}`,
                        {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                contents: [{
                                    parts: [{ text: prompt }]
                                }]
                            })
                        }
                    );

                    const result = await response.json();
                    let aiText = result.candidates?.[0]?.content?.parts?.[0]?.text || '';

                    // è™•ç†éä¸­æ–‡å¸‚å ´çš„é›™èªè¼¸å‡º
                    let aiCopy = '';
                    let chineseTranslation = '';

                    if (!isChinese && aiText.includes('\n')) {
                        const lines = aiText.split('\n').filter(l => l.trim());
                        aiCopy = lines[0] || aiText;
                        chineseTranslation = lines[1] || '';
                    } else {
                        aiCopy = aiText.trim();
                    }

                    results.push({
                        'å€å¡Šåç¨±': blockName,
                        'é …ç›®ä»£ç¢¼': itemCode,
                        'é …ç›®èªªæ˜': itemDesc,
                        'å®¢æˆ¶åŸæ–‡': originalText,
                        'AI ç”Ÿæˆæ–‡æ¡ˆ': aiCopy,
                        ...(chineseTranslation ? { 'ä¸­æ–‡ç¿»è­¯': chineseTranslation } : {})
                    });

                    // æ›´æ–°ç‹€æ…‹
                    document.getElementById('status-text').textContent = 
                        `æ­£åœ¨è™•ç†ï¼š${blockName} - ${itemCode} (${results.length}/${data.length})`;

                    // é¿å… API é™æµï¼Œç¨ä½œå»¶é²
                    await new Promise(resolve => setTimeout(resolve, 500));

                } catch (error) {
                    console.error(`ç”Ÿæˆ ${blockName}-${itemCode} å¤±æ•—:`, error);
                    results.push({
                        'å€å¡Šåç¨±': blockName,
                        'é …ç›®ä»£ç¢¼': itemCode,
                        'é …ç›®èªªæ˜': itemDesc,
                        'å®¢æˆ¶åŸæ–‡': originalText,
                        'AI ç”Ÿæˆæ–‡æ¡ˆ': 'ç”Ÿæˆå¤±æ•—ï¼š' + error.message
                    });
                }
            }

            return results;
        }

        // é¡¯ç¤ºçµæœ
        function displayResults(results) {
            const table = document.getElementById('results-table');
            if (!results || results.length === 0) return;

            const headers = Object.keys(results[0]);
            
            let html = '<thead class="bg-gray-200"><tr>';
            headers.forEach(header => {
                html += `<th class="px-3 py-2 text-left font-semibold">${header}</th>`;
            });
            html += '</tr></thead><tbody>';

            results.forEach(row => {
                html += '<tr class="border-b hover:bg-gray-50">';
                headers.forEach(header => {
                    html += `<td class="px-3 py-2">${row[header] || ''}</td>`;
                });
                html += '</tr>';
            });
            html += '</tbody>';

            table.innerHTML = html;
        }

        // ä¸‹è¼‰çµæœ
        function downloadResults() {
            if (!generatedCopy || generatedCopy.length === 0) {
                alert('æ²’æœ‰å¯ä¸‹è¼‰çš„çµæœ');
                return;
            }

            // è½‰æ›ç‚º CSV
            const headers = Object.keys(generatedCopy[0]);
            let csv = headers.join(',') + '\n';

            generatedCopy.forEach(row => {
                const values = headers.map(header => {
                    const value = row[header] || '';
                    // è™•ç†åŒ…å«é€—è™Ÿæˆ–å¼•è™Ÿçš„å€¼
                    return `"${value.toString().replace(/"/g, '""')}"`;
                });
                csv += values.join(',') + '\n';
            });

            // å»ºç«‹ BOM ä»¥æ”¯æ´ UTF-8
            const BOM = '\uFEFF';
            const blob = new Blob([BOM + csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            
            const targetMarket = document.getElementById('target-market').value;
            const languageNames = {
                'zh-TW': 'ç¹é«”ä¸­æ–‡',
                'zh-CN': 'ç®€ä½“ä¸­æ–‡',
                'en': 'English',
                'ja': 'æ—¥æœ¬èª',
                'ko': 'í•œêµ­ì–´',
                'de': 'Deutsch',
                'fr': 'FranÃ§ais',
                'it': 'Italiano',
                'th': 'à¸ à¸²à¸©à¸²à¹„à¸—à¸¢',
                'vi': 'Tiáº¿ng Viá»‡t',
                'es': 'EspaÃ±ol'
            };
            const langName = languageNames[targetMarket] || targetMarket;
            
            link.setAttribute('href', url);
            link.setAttribute('download', `TourPage_AIæ–‡æ¡ˆ_${langName}_${new Date().toISOString().split('T')[0]}.csv`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // æ­¥é©ŸæŒ‡ç¤ºå™¨æ¨£å¼
        const style = document.createElement('style');
        style.textContent = `
            .step-indicator {
                display: flex;
                flex-direction: column;
                align-items: center;
                opacity: 0.5;
                transition: opacity 0.3s;
            }
            .step-indicator.active {
                opacity: 1;
            }
            .step-number {
                width: 40px;
                height: 40px;
                border-radius: 50%;
                background: #e5e7eb;
                color: #6b7280;
                display: flex;
                align-items: center;
                justify-content: center;
                font-weight: bold;
                margin-bottom: 8px;
                transition: all 0.3s;
            }
            .step-indicator.active .step-number {
                background: #9333ea;
                color: white;
            }
            .step-label {
                font-size: 0.875rem;
                color: #6b7280;
            }
            .step-indicator.active .step-label {
                color: #9333ea;
                font-weight: 600;
            }
            .spinner {
                animation: spin 1s linear infinite;
            }
            @keyframes spin {
                from { transform: rotate(0deg); }
                to { transform: rotate(360deg); }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>

