<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>å¸‚å ´æƒ…è³‡èˆ‡ç«¶å“åˆ†æå¹³å° (V6 - é€²éšåˆ†æç‰ˆ)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://apis.google.com/js/api.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // Tailwind CSS configuration
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        techbg: '#181D27',
                        techpanel: '#22283A',
                        techaccent: '#2EE9E4',
                        techprimary: '#3762F0',
                        techsecondary: '#7D5FFF'
                    },
                    fontFamily: {
                        'tech': ['"Segoe UI"', 'Roboto', 'Arial', 'sans-serif']
                    }
                }
            }
        }

        // å…¨åŸŸç‹€æ…‹ç®¡ç†
        window.state = {
            isAuthenticated: false,
            apiConfigured: false,
            currentStep: 1,
            analysisData: {},
            settings: {
                googleApiKey: '',
                searchEngineId: '',
                centralFolderName: 'iStaging_å°ˆæ¡ˆç®¡ç†',
                intelligenceSubfolder: '01_å¸‚å ´æƒ…è³‡åˆ†æ',
                mediaplanSubfolder: '02_åª’é«”ææ¡ˆ',
                workflowSubfolder: '03_å·¥ä½œæµç¨‹æ–‡ä»¶'
            }
        };

        // é é¢è¼‰å…¥å®Œæˆå¾Œåˆå§‹åŒ–
        window.addEventListener('load', function() {
            console.log('é é¢è¼‰å…¥å®Œæˆï¼Œé–‹å§‹åˆå§‹åŒ–...');
            
            // ä½¿ç”¨ Promise åŒ…è£åˆå§‹åŒ–ï¼Œé¿å…æœªæ•ç²çš„éŒ¯èª¤
            initializeApp()
                .then(() => {
                    console.log('åˆå§‹åŒ–å®Œæˆ');
                })
                .catch(error => {
                    console.error('åˆå§‹åŒ–éç¨‹ä¸­ç™¼ç”ŸéŒ¯èª¤:', error);
                    showAlert('åˆå§‹åŒ–éŒ¯èª¤', 'é é¢åˆå§‹åŒ–å¤±æ•—ï¼Œè«‹é‡æ–°æ•´ç†é é¢', 'error');
                });
        });

        // å…¨åŸŸéŒ¯èª¤è™•ç†
        window.addEventListener('error', function(event) {
            console.error('å…¨åŸŸéŒ¯èª¤:', event.error);
        });

        window.addEventListener('unhandledrejection', function(event) {
            console.error('æœªè™•ç†çš„ Promise æ‹’çµ•:', event.reason);
            event.preventDefault(); // é˜²æ­¢é è¨­çš„éŒ¯èª¤è™•ç†
        });

        // åˆå§‹åŒ–æ‡‰ç”¨ç¨‹å¼
        function initializeApp() {
            return new Promise((resolve, reject) => {
                try {
                    console.log('åˆå§‹åŒ–æ‡‰ç”¨ç¨‹å¼...');
                    
                    // è¼‰å…¥è¨­å®š
                    loadSettings();
                    
                    // è¨­å®šäº‹ä»¶ç›£è½å™¨
                    setupEventListeners();
                    
                    // æª¢æŸ¥ URL åƒæ•¸
                    checkUrlParameters();
                    
                    // æ›´æ–° UI ç‹€æ…‹
                    updateUIState();
                    
                    console.log('æ‡‰ç”¨ç¨‹å¼åˆå§‹åŒ–å®Œæˆ');
                    resolve();
                } catch (error) {
                    console.error('æ‡‰ç”¨ç¨‹å¼åˆå§‹åŒ–å¤±æ•—:', error);
                    reject(error);
                }
            });
        }

        // è¼‰å…¥è¨­å®š
        function loadSettings() {
            try {
                const savedSettings = localStorage.getItem('intelligence_settings');
                if (savedSettings) {
                    const parsed = JSON.parse(savedSettings);
                    state.settings = { ...state.settings, ...parsed };
                    
                    // æ›´æ–°è¡¨å–®æ¬„ä½
                    const apiKeyInput = document.getElementById('google-api-key');
                    const searchEngineInput = document.getElementById('search-engine-id');
                    const centralFolderInput = document.getElementById('central-folder-name');
                    const intelligenceSubfolderInput = document.getElementById('intelligence-subfolder');
                    const mediaplanSubfolderInput = document.getElementById('mediaplan-subfolder');
                    const workflowSubfolderInput = document.getElementById('workflow-subfolder');
                    
                    if (apiKeyInput) apiKeyInput.value = state.settings.googleApiKey || '';
                    if (searchEngineInput) searchEngineInput.value = state.settings.searchEngineId || '';
                    if (centralFolderInput) centralFolderInput.value = state.settings.centralFolderName || '';
                    if (intelligenceSubfolderInput) intelligenceSubfolderInput.value = state.settings.intelligenceSubfolder || '';
                    if (mediaplanSubfolderInput) mediaplanSubfolderInput.value = state.settings.mediaplanSubfolder || '';
                    if (workflowSubfolderInput) workflowSubfolderInput.value = state.settings.workflowSubfolder || '';
                }
            } catch (error) {
                console.warn('è¼‰å…¥è¨­å®šå¤±æ•—:', error);
                // ä¸æ‹‹å‡ºéŒ¯èª¤ï¼Œè®“ç¨‹å¼ç¹¼çºŒåŸ·è¡Œ
            }
        }

        // è¨­å®šäº‹ä»¶ç›£è½å™¨
        function setupEventListeners() {
            try {
                // æ¨™ç±¤é åˆ‡æ›
                const tabButtons = document.querySelectorAll('.tab-btn');
                tabButtons.forEach(btn => {
                    if (btn) {
                        btn.addEventListener('click', function(e) {
                            e.preventDefault();
                            const tab = this.dataset.tab;
                            switchTab(tab);
                        });
                    }
                });

                // å„²å­˜è¨­å®šæŒ‰éˆ•
                const saveSettingsBtn = document.getElementById('save-settings-btn');
                if (saveSettingsBtn) {
                    saveSettingsBtn.addEventListener('click', saveSettings);
                }

                // Google ç™»å…¥æŒ‰éˆ•
                const authorizeBtn = document.getElementById('authorize_button');
                if (authorizeBtn) {
                    authorizeBtn.addEventListener('click', handleGoogleAuth);
                }

                // ç™»å‡ºæŒ‰éˆ•
                const signoutBtn = document.getElementById('signout_button');
                if (signoutBtn) {
                    signoutBtn.addEventListener('click', handleSignOut);
                }

                // æ­¥é©Ÿåˆ‡æ› - ä¿®æ­£äº‹ä»¶ç›£è½å™¨
                const stepCircles = document.querySelectorAll('.step-circle');
                stepCircles.forEach((circle, index) => {
                    if (circle) {
                        circle.addEventListener('click', function(e) {
                            e.preventDefault();
                            e.stopPropagation();
                            const step = index + 1;
                            console.log(`é»æ“Šæ­¥é©Ÿ ${step}`);
                            goToStep(step);
                        });
                    }
                });

                // è¨­å®šæ­¥é©Ÿ 1 çš„äº‹ä»¶ç›£è½å™¨
                setupStep1EventListeners();

                console.log('äº‹ä»¶ç›£è½å™¨è¨­å®šå®Œæˆ');
            } catch (error) {
                console.error('è¨­å®šäº‹ä»¶ç›£è½å™¨å¤±æ•—:', error);
                // ä¸æ‹‹å‡ºéŒ¯èª¤ï¼Œè®“ç¨‹å¼ç¹¼çºŒåŸ·è¡Œ
            }
        }

        // æª¢æŸ¥ URL åƒæ•¸
        function checkUrlParameters() {
            try {
                const urlParams = new URLSearchParams(window.location.search);
                const projectId = urlParams.get('projectId');
                
                if (projectId) {
                    const projectIdInput = document.getElementById('project-id');
                    if (projectIdInput) {
                        projectIdInput.value = projectId;
                    }
                }
            } catch (error) {
                console.warn('æª¢æŸ¥ URL åƒæ•¸å¤±æ•—:', error);
                // ä¸æ‹‹å‡ºéŒ¯èª¤ï¼Œè®“ç¨‹å¼ç¹¼çºŒåŸ·è¡Œ
            }
        }

        // æ›´æ–° UI ç‹€æ…‹
        function updateUIState() {
            try {
                const appContainer = document.getElementById('app-container');
                const analysisPanel = document.getElementById('analysis-panel');
                const historyPanel = document.getElementById('history-panel');
                const isConfigured = state.settings.googleApiKey && state.settings.searchEngineId;
                
                // ç§»é™¤ app-container çš„ locked classï¼Œæ”¹ç‚ºåªé–å®šç‰¹å®šé¢æ¿
                if (appContainer) {
                    appContainer.classList.remove('locked');
                }
                
                // åªæœ‰åˆ†æç³»çµ±å’Œæ­·å²ç´€éŒ„éœ€è¦ API è¨­å®š
                if (analysisPanel) {
                    if (isConfigured) {
                        analysisPanel.classList.remove('locked');
                        state.apiConfigured = true;
                    } else {
                        analysisPanel.classList.add('locked');
                        state.apiConfigured = false;
                    }
                }
                
                if (historyPanel) {
                    if (isConfigured) {
                        historyPanel.classList.remove('locked');
                    } else {
                        historyPanel.classList.add('locked');
                    }
                }

                // é è¨­é¡¯ç¤º API è¨­å®šåˆ†é 
                switchTab('settings');
            } catch (error) {
                console.error('æ›´æ–° UI ç‹€æ…‹å¤±æ•—:', error);
            }
        }

        // åˆ‡æ›æ¨™ç±¤é 
        function switchTab(tabName) {
            try {
                // ç§»é™¤æ‰€æœ‰æ¨™ç±¤é çš„ active ç‹€æ…‹
                const tabButtons = document.querySelectorAll('.tab-btn');
                const panels = document.querySelectorAll('.panel');
                
                tabButtons.forEach(btn => btn.classList.remove('active'));
                panels.forEach(panel => panel.classList.remove('active'));
                
                // å•Ÿç”¨é¸ä¸­çš„æ¨™ç±¤é 
                const activeTab = document.querySelector(`[data-tab="${tabName}"]`);
                const activePanel = document.getElementById(`${tabName}-panel`);
                
                if (activeTab) activeTab.classList.add('active');
                if (activePanel) activePanel.classList.add('active');
                
                console.log(`åˆ‡æ›åˆ°æ¨™ç±¤é : ${tabName}`);
            } catch (error) {
                console.error('åˆ‡æ›æ¨™ç±¤é å¤±æ•—:', error);
            }
        }

        // å„²å­˜è¨­å®š
        function saveSettings() {
            try {
                const apiKey = document.getElementById('google-api-key')?.value || '';
                const searchEngineId = document.getElementById('search-engine-id')?.value || '';
                const centralFolderName = document.getElementById('central-folder-name')?.value || '';
                const intelligenceSubfolder = document.getElementById('intelligence-subfolder')?.value || '';
                const mediaplanSubfolder = document.getElementById('mediaplan-subfolder')?.value || '';
                const workflowSubfolder = document.getElementById('workflow-subfolder')?.value || '';

                // æ›´æ–°ç‹€æ…‹
                state.settings = {
                    googleApiKey: apiKey,
                    searchEngineId: searchEngineId,
                    centralFolderName: centralFolderName,
                    intelligenceSubfolder: intelligenceSubfolder,
                    mediaplanSubfolder: mediaplanSubfolder,
                    workflowSubfolder: workflowSubfolder
                };

                // å„²å­˜åˆ° localStorage
                localStorage.setItem('intelligence_settings', JSON.stringify(state.settings));

                // æ›´æ–° UI ç‹€æ…‹
                updateUIState();

                showAlert('è¨­å®šå·²å„²å­˜', 'API è¨­å®šå·²æˆåŠŸå„²å­˜', 'success');
                
                // å¦‚æœ API å·²è¨­å®šï¼Œåˆ‡æ›åˆ°åˆ†æç³»çµ±
                if (apiKey && searchEngineId) {
                    setTimeout(() => {
                        switchTab('analysis');
                    }, 1000);
                }
            } catch (error) {
                console.error('å„²å­˜è¨­å®šå¤±æ•—:', error);
                showAlert('å„²å­˜å¤±æ•—', error.message, 'error');
            }
        }

        // é–‹å§‹åˆ†æ
        function startAnalysis() {
            try {
                // æ”¶é›†æ‰€æœ‰è³‡æ–™
                const brandName = document.getElementById('brand-name')?.value?.trim();
                const brandWebsite = document.getElementById('brand-website')?.value?.trim();
                const brandDescription = document.getElementById('brand-description')?.value?.trim();
                const industryCategory = document.getElementById('industry-category')?.value;
                const marketSize = document.getElementById('market-size')?.value;
                const topic = document.getElementById('analysis-topic')?.value?.trim();
                const projectId = document.getElementById('project-id')?.value?.trim();
                const competitorCount = document.getElementById('competitor-count')?.value;
                const analysisDepth = document.querySelector('input[name="analysis-depth"]:checked')?.value;

                // é©—è­‰å¿…å¡«æ¬„ä½
                if (!brandName) {
                    showAlert('è«‹å¡«å¯«å“ç‰Œåç¨±', 'å“ç‰Œåç¨±ç‚ºå¿…å¡«é …ç›®', 'warning');
                    return;
                }

                if (!industryCategory) {
                    showAlert('è«‹é¸æ“‡è¡Œæ¥­é¡åˆ¥', 'è¡Œæ¥­é¡åˆ¥ç‚ºå¿…å¡«é …ç›®', 'warning');
                    return;
                }

                if (!topic) {
                    showAlert('è«‹å¡«å¯«åˆ†æä¸»é¡Œ', 'åˆ†æä¸»é¡Œç‚ºå¿…å¡«é …ç›®', 'warning');
                    return;
                }

                // æ”¶é›†ç”¢å“å’Œé—œéµå­—è³‡æ–™
                const products = collectProductsData();
                const keywords = collectKeywordsData();

                // å„²å­˜åˆ†æè¨­å®š
                state.analysisData = {
                    brand: {
                        name: brandName,
                        website: brandWebsite,
                        description: brandDescription
                    },
                    products: products,
                    industry: {
                        category: industryCategory,
                        marketSize: marketSize
                    },
                    topic: topic,
                    projectId: projectId || `TEMP_${Date.now()}`,
                    competitorCount: parseInt(competitorCount),
                    analysisDepth: analysisDepth,
                    keywords: keywords,
                    timestamp: new Date().toISOString()
                };

                showAlert('åˆ†æè¨­å®šå·²å„²å­˜', 'æ­£åœ¨æº–å‚™ç«¶çˆ­å°æ‰‹åˆ†æ...', 'success');
                
                // åˆ‡æ›åˆ°æ­¥é©Ÿ 2
                setTimeout(() => {
                    goToStep(2);
                }, 1000);

            } catch (error) {
                console.error('é–‹å§‹åˆ†æå¤±æ•—:', error);
                showAlert('åˆ†æå¤±æ•—', error.message, 'error');
            }
        }

        // æ”¶é›†ç”¢å“è³‡æ–™
        function collectProductsData() {
            try {
                const products = [];
                const productItems = document.querySelectorAll('.product-item');
                
                productItems.forEach(item => {
                    const name = item.querySelector('.product-name')?.value?.trim();
                    const pricing = item.querySelector('.product-pricing')?.value;
                    const target = item.querySelector('.product-target')?.value?.trim();
                    
                    if (name) {
                        products.push({
                            name: name,
                            pricing: pricing,
                            target: target
                        });
                    }
                });
                
                return products;
            } catch (error) {
                console.error('æ”¶é›†ç”¢å“è³‡æ–™å¤±æ•—:', error);
                return [];
            }
        }

        // æ”¶é›†é—œéµå­—è³‡æ–™
        function collectKeywordsData() {
            try {
                const primaryKeywords = document.getElementById('primary-keywords')?.value?.split('\n').filter(k => k.trim()) || [];
                const longTailKeywords = document.getElementById('long-tail-keywords')?.value?.split('\n').filter(k => k.trim()) || [];
                const keywordDepth = document.querySelector('input[name="keyword-depth"]:checked')?.value || 'standard';
                
                return {
                    primary: primaryKeywords,
                    longTail: longTailKeywords,
                    depth: keywordDepth
                };
            } catch (error) {
                console.error('æ”¶é›†é—œéµå­—è³‡æ–™å¤±æ•—:', error);
                return { primary: [], longTail: [], depth: 'standard' };
            }
        }

        // Google èªè­‰è™•ç† - å¯¦ä½œåŸºæœ¬åŠŸèƒ½
        function handleGoogleAuth() {
            try {
                // æª¢æŸ¥æ˜¯å¦å·²è¼‰å…¥ Google API
                if (typeof gapi === 'undefined') {
                    showAlert('Google API æœªè¼‰å…¥', 'è«‹æª¢æŸ¥ç¶²è·¯é€£ç·šä¸¦é‡æ–°æ•´ç†é é¢', 'error');
                    return;
                }

                // åˆå§‹åŒ– Google API
                gapi.load('auth2', function() {
                    gapi.auth2.init({
                        client_id: 'YOUR_GOOGLE_CLIENT_ID' // éœ€è¦è¨­å®šä½ çš„ Google Client ID
                    }).then(function(auth2) {
                        // ç™»å…¥
                        auth2.signIn().then(function(googleUser) {
                            const profile = googleUser.getBasicProfile();
                            state.isAuthenticated = true;
                            state.userProfile = {
                                id: profile.getId(),
                                name: profile.getName(),
                                email: profile.getEmail(),
                                imageUrl: profile.getImageUrl()
                            };
                            
                            updateAuthUI();
                            showAlert('ç™»å…¥æˆåŠŸ', `æ­¡è¿ ${profile.getName()}`, 'success');
                            
                            // åˆå§‹åŒ– Google Drive API
                            initializeGoogleDrive();
                        }).catch(function(error) {
                            console.error('Google ç™»å…¥å¤±æ•—:', error);
                            showAlert('ç™»å…¥å¤±æ•—', 'Google ç™»å…¥å¤±æ•—ï¼Œè«‹é‡è©¦', 'error');
                        });
                    }).catch(function(error) {
                        console.error('Google API åˆå§‹åŒ–å¤±æ•—:', error);
                        showAlert('åˆå§‹åŒ–å¤±æ•—', 'Google API åˆå§‹åŒ–å¤±æ•—', 'error');
                    });
                });
            } catch (error) {
                console.error('Google èªè­‰å¤±æ•—:', error);
                showAlert('èªè­‰å¤±æ•—', error.message, 'error');
            }
        }

        // åˆå§‹åŒ– Google Drive API
        function initializeGoogleDrive() {
            try {
                gapi.load('client', function() {
                    gapi.client.init({
                        apiKey: state.settings.googleApiKey,
                        discoveryDocs: ['https://www.googleapis.com/discovery/v1/apis/drive/v3/rest']
                    }).then(function() {
                        console.log('Google Drive API åˆå§‹åŒ–æˆåŠŸ');
                        showAlert('Google Drive å·²æº–å‚™å°±ç·’', 'å¯ä»¥é–‹å§‹å„²å­˜æª”æ¡ˆåˆ° Google Drive', 'success');
                    }).catch(function(error) {
                        console.error('Google Drive API åˆå§‹åŒ–å¤±æ•—:', error);
                        showAlert('Drive API åˆå§‹åŒ–å¤±æ•—', 'è«‹æª¢æŸ¥ API é‡‘é‘°è¨­å®š', 'error');
                    });
                });
            } catch (error) {
                console.error('åˆå§‹åŒ– Google Drive å¤±æ•—:', error);
            }
        }

        // ç™»å‡ºè™•ç†
        function handleSignOut() {
            try {
                state.isAuthenticated = false;
                updateAuthUI();
                showAlert('å·²ç™»å‡º', 'æ‚¨å·²æˆåŠŸç™»å‡º', 'info');
            } catch (error) {
                console.error('ç™»å‡ºå¤±æ•—:', error);
            }
        }

        // æ›´æ–°èªè­‰ UI
        function updateAuthUI() {
            try {
                const userProfile = document.getElementById('user-profile');
                const authorizeBtn = document.getElementById('authorize_button');
                
                if (state.isAuthenticated) {
                    if (userProfile) userProfile.classList.remove('hidden');
                    if (authorizeBtn) authorizeBtn.classList.add('hidden');
                } else {
                    if (userProfile) userProfile.classList.add('hidden');
                    if (authorizeBtn) authorizeBtn.classList.remove('hidden');
                }
            } catch (error) {
                console.error('æ›´æ–°èªè­‰ UI å¤±æ•—:', error);
            }
        }

        // åˆ‡æ›æ­¥é©Ÿ
        function goToStep(step) {
            try {
                state.currentStep = step;
                
                // æ›´æ–°æ­¥é©ŸæŒ‡ç¤ºå™¨
                const steps = document.querySelectorAll('.step');
                steps.forEach((s, index) => {
                    if (index + 1 < step) {
                        s.classList.add('completed');
                        s.classList.remove('active');
                    } else if (index + 1 === step) {
                        s.classList.add('active');
                        s.classList.remove('completed');
                    } else {
                        s.classList.remove('active', 'completed');
                    }
                });

                // é¡¯ç¤ºå°æ‡‰çš„å…§å®¹
                const stepPanels = document.querySelectorAll('.step-panel');
                stepPanels.forEach((panel, index) => {
                    if (index + 1 === step) {
                        panel.style.display = 'block';
                        
                        // å¦‚æœæ˜¯æ­¥é©Ÿ 2ï¼Œåˆå§‹åŒ–ç«¶çˆ­å°æ‰‹æœå°‹
                        if (step === 2) {
                            initializeCompetitorSearch();
                        }
                    } else {
                        panel.style.display = 'none';
                    }
                });

                console.log(`åˆ‡æ›åˆ°æ­¥é©Ÿ: ${step}`);
            } catch (error) {
                console.error('åˆ‡æ›æ­¥é©Ÿå¤±æ•—:', error);
            }
        }

        // åˆå§‹åŒ–ç«¶çˆ­å°æ‰‹æœå°‹
        function initializeCompetitorSearch() {
            try {
                // é¡¯ç¤ºç•¶å‰åˆ†æä¸»é¡Œ
                const currentTopic = document.getElementById('current-topic');
                if (currentTopic && state.analysisData.topic) {
                    currentTopic.textContent = state.analysisData.topic;
                }

                // è¨­å®šæ­¥é©Ÿ 2 çš„äº‹ä»¶ç›£è½å™¨
                setupStep2EventListeners();

                // é–‹å§‹è‡ªå‹•æœå°‹ç«¶çˆ­å°æ‰‹
                searchCompetitors();

            } catch (error) {
                console.error('åˆå§‹åŒ–ç«¶çˆ­å°æ‰‹æœå°‹å¤±æ•—:', error);
            }
        }

        // è¨­å®šæ­¥é©Ÿ 2 çš„äº‹ä»¶ç›£è½å™¨
        function setupStep2EventListeners() {
            try {
                // æ·»åŠ ç«¶çˆ­å°æ‰‹æŒ‰éˆ•
                const addCompetitorBtn = document.getElementById('add-competitor-btn');
                if (addCompetitorBtn) {
                    addCompetitorBtn.addEventListener('click', addManualCompetitor);
                }

                // æ‰‹å‹•è¼¸å…¥ç«¶çˆ­å°æ‰‹åç¨±
                const manualCompetitorInput = document.getElementById('manual-competitor');
                if (manualCompetitorInput) {
                    manualCompetitorInput.addEventListener('keypress', function(e) {
                        if (e.key === 'Enter') {
                            addManualCompetitor();
                        }
                    });
                }

                // ç”Ÿæˆå ±å‘ŠæŒ‰éˆ•
                const generateReportBtn = document.getElementById('generate-report-btn');
                if (generateReportBtn) {
                    generateReportBtn.addEventListener('click', generateFinalReport);
                }

                // è¿”å›æ­¥é©Ÿ 1 æŒ‰éˆ•
                const backToStep1Btn = document.getElementById('back-to-step1-btn');
                if (backToStep1Btn) {
                    backToStep1Btn.addEventListener('click', () => goToStep(1));
                }

            } catch (error) {
                console.error('è¨­å®šæ­¥é©Ÿ 2 äº‹ä»¶ç›£è½å™¨å¤±æ•—:', error);
            }
        }

        // è¨­å®šæ­¥é©Ÿ 1 çš„äº‹ä»¶ç›£è½å™¨
        function setupStep1EventListeners() {
            try {
                // æ·»åŠ ç”¢å“æŒ‰éˆ•
                const addProductBtn = document.getElementById('add-product-btn');
                if (addProductBtn) {
                    addProductBtn.addEventListener('click', addProductItem);
                }

                // é–‹å§‹åˆ†ææŒ‰éˆ•
                const startAnalysisBtn = document.getElementById('start-analysis-btn');
                if (startAnalysisBtn) {
                    startAnalysisBtn.addEventListener('click', startAnalysis);
                }

            } catch (error) {
                console.error('è¨­å®šæ­¥é©Ÿ 1 äº‹ä»¶ç›£è½å™¨å¤±æ•—:', error);
            }
        }

        // æ·»åŠ ç”¢å“é …ç›®
        function addProductItem() {
            try {
                const container = document.getElementById('products-container');
                if (!container) return;

                const productItem = document.createElement('div');
                productItem.className = 'product-item bg-gray-800 rounded-lg p-4 mb-3 relative';
                productItem.innerHTML = `
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">ç”¢å“/æœå‹™åç¨±</label>
                            <input type="text" class="product-name w-full px-3 py-2 rounded bg-techbg border border-techprimary/20" placeholder="ç”¢å“åç¨±">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">åƒ¹æ ¼å®šä½</label>
                            <select class="product-pricing w-full px-3 py-2 rounded bg-techbg border border-techprimary/20">
                                <option value="">é¸æ“‡åƒ¹æ ¼å®šä½</option>
                                <option value="premium">é«˜åƒ¹ä½ (Premium)</option>
                                <option value="mid-high">ä¸­é«˜åƒ¹ä½</option>
                                <option value="mid">ä¸­åƒ¹ä½</option>
                                <option value="mid-low">ä¸­ä½åƒ¹ä½</option>
                                <option value="budget">å¹³åƒ¹ (Budget)</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">ç›®æ¨™å®¢ç¾¤</label>
                            <input type="text" class="product-target w-full px-3 py-2 rounded bg-techbg border border-techprimary/20" placeholder="ç›®æ¨™å®¢ç¾¤æè¿°">
                        </div>
                    </div>
                    <button class="remove-product-btn absolute top-2 right-2 bg-red-600 hover:bg-red-700 text-white px-2 py-1 rounded text-xs">Ã—</button>
                `;

                container.appendChild(productItem);

                // ç‚ºç§»é™¤æŒ‰éˆ•æ·»åŠ äº‹ä»¶ç›£è½å™¨
                const removeBtn = productItem.querySelector('.remove-product-btn');
                if (removeBtn) {
                    removeBtn.addEventListener('click', function() {
                        container.removeChild(productItem);
                    });
                }

            } catch (error) {
                console.error('æ·»åŠ ç”¢å“é …ç›®å¤±æ•—:', error);
            }
        }

        // æ‰‹å‹•æ·»åŠ ç«¶çˆ­å°æ‰‹
        function addManualCompetitor() {
            try {
                const input = document.getElementById('manual-competitor');
                const name = input.value.trim();
                
                if (!name) {
                    showAlert('è«‹è¼¸å…¥ç«¶çˆ­å°æ‰‹åç¨±', 'ç«¶çˆ­å°æ‰‹åç¨±ä¸èƒ½ç‚ºç©º', 'warning');
                    return;
                }
                
                addCompetitorToList(name, 'æ‰‹å‹•æ·»åŠ çš„ç«¶çˆ­å°æ‰‹', '', '');
                input.value = '';
                
            } catch (error) {
                console.error('æ‰‹å‹•æ·»åŠ ç«¶çˆ­å°æ‰‹å¤±æ•—:', error);
            }
        }

        // æ·»åŠ ç«¶çˆ­å°æ‰‹åˆ°åˆ—è¡¨
        function addCompetitorToList(name, description, website = '', linkedin = '', founded = '', employees = '', revenue = '', marketShare = '', strengths = '', weaknesses = '') {
            try {
                if (!state.selectedCompetitors) {
                    state.selectedCompetitors = [];
                }
                
                // æª¢æŸ¥æ˜¯å¦å·²å­˜åœ¨
                if (state.selectedCompetitors.some(c => c.name === name)) {
                    showAlert('ç«¶çˆ­å°æ‰‹å·²å­˜åœ¨', `${name} å·²åœ¨åˆ—è¡¨ä¸­`, 'warning');
                    return;
                }
                
                // æ·»åŠ ç«¶çˆ­å°æ‰‹
                state.selectedCompetitors.push({
                    name: name,
                    description: description,
                    website: website,
                    linkedin: linkedin,
                    founded: founded,
                    employees: employees,
                    revenue: revenue,
                    marketShare: marketShare,
                    strengths: strengths,
                    weaknesses: weaknesses
                });
                
                updateSelectedCompetitorsList();
                showAlert('æ·»åŠ æˆåŠŸ', `å·²æ·»åŠ  ${name} åˆ°ç«¶çˆ­å°æ‰‹åˆ—è¡¨`, 'success');
                
            } catch (error) {
                console.error('æ·»åŠ ç«¶çˆ­å°æ‰‹åˆ°åˆ—è¡¨å¤±æ•—:', error);
            }
        }

        // æ›´æ–°å·²é¸æ“‡çš„ç«¶çˆ­å°æ‰‹åˆ—è¡¨
        function updateSelectedCompetitorsList() {
            try {
                const container = document.getElementById('selected-competitors');
                const generateReportBtn = document.getElementById('generate-report-btn');
                const countSpan = document.getElementById('selected-count');
                
                if (!container) return;
                
                if (!state.selectedCompetitors || state.selectedCompetitors.length === 0) {
                    container.innerHTML = '<p class="text-gray-500 text-sm">å°šæœªé¸æ“‡ä»»ä½•ç«¶çˆ­å°æ‰‹</p>';
                    if (generateReportBtn) generateReportBtn.disabled = true;
                    if (countSpan) countSpan.textContent = '0';
                    return;
                }
                
                let html = '';
                state.selectedCompetitors.forEach((competitor, index) => {
                    html += `
                        <div class="bg-gray-800 rounded-lg p-4 border border-gray-700">
                            <div class="flex justify-between items-start mb-3">
                                <div class="flex-1">
                                    <h6 class="font-semibold text-gray-200">${competitor.name}</h6>
                                    <button class="remove-competitor-btn bg-red-600 hover:bg-red-700 text-white px-2 py-1 rounded text-xs"
                                            data-index="${index}">ç§»é™¤</button>
                                </div>
                            </div>
                            <p class="text-xs text-gray-400 mb-2">${competitor.description}</p>
                            <div class="grid grid-cols-2 md:grid-cols-4 gap-2 text-xs text-gray-500 mb-2">
                                ${competitor.founded ? `<div>æˆç«‹ï¼š${competitor.founded}</div>` : ''}
                                ${competitor.employees ? `<div>å“¡å·¥ï¼š${competitor.employees}</div>` : ''}
                                ${competitor.revenue ? `<div>ç‡Ÿæ”¶ï¼š${competitor.revenue}</div>` : ''}
                                ${competitor.marketShare ? `<div>å¸‚å ï¼š${competitor.marketShare}</div>` : ''}
                            </div>
                            ${competitor.strengths ? `<div class="text-xs text-green-400 mb-1">å„ªå‹¢ï¼š${competitor.strengths}</div>` : ''}
                            ${competitor.weaknesses ? `<div class="text-xs text-red-400 mb-2">å¼±å‹¢ï¼š${competitor.weaknesses}</div>` : ''}
                            <div class="flex gap-2">
                                ${competitor.website ? `<a href="${competitor.website}" target="_blank" class="text-blue-400 hover:text-blue-300 text-xs">ğŸŒ å®˜ç¶²</a>` : ''}
                                ${competitor.linkedin ? `<a href="${competitor.linkedin}" target="_blank" class="text-blue-400 hover:text-blue-300 text-xs">ğŸ’¼ LinkedIn</a>` : ''}
                            </div>
                        </div>
                    `;
                });
                
                container.innerHTML = html;
                
                // æ›´æ–°è¨ˆæ•¸
                if (countSpan) countSpan.textContent = state.selectedCompetitors.length;
                
                // å•Ÿç”¨ç”Ÿæˆå ±å‘ŠæŒ‰éˆ•
                if (generateReportBtn) generateReportBtn.disabled = false;
                
                // ç‚ºç§»é™¤æŒ‰éˆ•æ·»åŠ äº‹ä»¶ç›£è½å™¨
                const removeButtons = container.querySelectorAll('.remove-competitor-btn');
                removeButtons.forEach(btn => {
                    btn.addEventListener('click', function() {
                        const index = parseInt(this.dataset.index);
                        removeCompetitor(index);
                    });
                });
                
            } catch (error) {
                console.error('æ›´æ–°ç«¶çˆ­å°æ‰‹åˆ—è¡¨å¤±æ•—:', error);
            }
        }

        // ç§»é™¤ç«¶çˆ­å°æ‰‹
        function removeCompetitor(index) {
            try {
                if (state.selectedCompetitors && state.selectedCompetitors[index]) {
                    const removed = state.selectedCompetitors.splice(index, 1)[0];
                    updateSelectedCompetitorsList();
                    showAlert('ç§»é™¤æˆåŠŸ', `å·²ç§»é™¤ ${removed.name}`, 'success');
                }
            } catch (error) {
                console.error('ç§»é™¤ç«¶çˆ­å°æ‰‹å¤±æ•—:', error);
            }
        }

        // ç”Ÿæˆæœ€çµ‚å ±å‘Š
        function generateFinalReport() {
            try {
                if (!state.selectedCompetitors || state.selectedCompetitors.length === 0) {
                    showAlert('è«‹é¸æ“‡ç«¶çˆ­å°æ‰‹', 'è‡³å°‘éœ€è¦é¸æ“‡ä¸€å€‹ç«¶çˆ­å°æ‰‹', 'warning');
                    return;
                }

                showAlert('æ­£åœ¨ç”Ÿæˆå ±å‘Š', 'è«‹ç¨å€™...', 'info');
                
                // åˆ‡æ›åˆ°æ­¥é©Ÿ 3
                setTimeout(() => {
                    goToStep(3);
                    generateCompleteReport();
                }, 1000);

            } catch (error) {
                console.error('ç”Ÿæˆæœ€çµ‚å ±å‘Šå¤±æ•—:', error);
            }
        }

        // ç”Ÿæˆå®Œæ•´å ±å‘Šå…§å®¹
        function generateCompleteReport() {
            try {
                const reportContainer = document.getElementById('final-report-content');
                if (!reportContainer) return;

                // é¡¯ç¤ºè¼‰å…¥ç‹€æ…‹
                reportContainer.innerHTML = `
                    <div class="flex items-center justify-center py-8">
                        <div class="spinner"></div>
                        <span class="ml-3 text-gray-400">æ­£åœ¨ç”Ÿæˆå®Œæ•´å ±å‘Š...</span>
                    </div>
                `;

                // æ¨¡æ“¬å ±å‘Šç”Ÿæˆå»¶é²
                setTimeout(() => {
                    const report = createCompleteReport();
                    reportContainer.innerHTML = report;
                }, 3000);

            } catch (error) {
                console.error('ç”Ÿæˆå®Œæ•´å ±å‘Šå¤±æ•—:', error);
            }
        }

        // å‰µå»ºå®Œæ•´å ±å‘Š
        function createCompleteReport() {
            try {
                const analysisData = state.analysisData;
                const competitors = state.selectedCompetitors;
                const projectId = document.getElementById('project-id')?.value || 'TEMP_' + Date.now();

                let report = `
                    <div class="space-y-8">
                        <!-- å ±å‘Šæ¨™é¡Œ -->
                        <div class="text-center border-b border-gray-700 pb-6">
                            <h1 class="text-3xl font-bold text-techaccent mb-2">å¸‚å ´æƒ…è³‡èˆ‡ç«¶å“åˆ†æå ±å‘Š</h1>
                            <p class="text-gray-400">å°ˆæ¡ˆ ID: ${projectId} | ç”Ÿæˆæ™‚é–“: ${new Date().toLocaleString('zh-TW')}</p>
                        </div>

                        <!-- åŸ·è¡Œæ‘˜è¦ -->
                        <div class="bg-gray-800 rounded-lg p-6">
                            <h2 class="text-xl font-bold text-techaccent mb-4">ğŸ“‹ åŸ·è¡Œæ‘˜è¦</h2>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                                <div class="text-center">
                                    <div class="text-2xl font-bold text-techaccent">${competitors.length}</div>
                                    <div class="text-sm text-gray-400">ç«¶çˆ­å°æ‰‹åˆ†æ</div>
                                </div>
                                <div class="text-center">
                                    <div class="text-2xl font-bold text-techaccent">${analysisData.industry?.category || 'æœªæŒ‡å®š'}</div>
                                    <div class="text-sm text-gray-400">è¡Œæ¥­é¡åˆ¥</div>
                                </div>
                                <div class="text-center">
                                    <div class="text-2xl font-bold text-techaccent">${analysisData.market?.size || 'æœªæŒ‡å®š'}</div>
                                    <div class="text-sm text-gray-400">å¸‚å ´è¦æ¨¡</div>
                                </div>
                            </div>
                            <p class="text-gray-300">
                                æœ¬å ±å‘Šé‡å°ã€Œ${analysisData.topic || 'æœªæŒ‡å®šä¸»é¡Œ'}ã€é€²è¡Œæ·±åº¦å¸‚å ´åˆ†æï¼Œ
                                æ¶µè“‹ ${competitors.length} å€‹ä¸»è¦ç«¶çˆ­å°æ‰‹çš„è©³ç´°æ¯”è¼ƒï¼Œ
                                ç‚º ${analysisData.brand?.name || 'æ‚¨çš„å“ç‰Œ'} æä¾›å¸‚å ´å®šä½å’Œç«¶çˆ­ç­–ç•¥å»ºè­°ã€‚
                            </p>
                        </div>

                        <!-- å“ç‰Œåˆ†æ -->
                        <div class="bg-gray-800 rounded-lg p-6">
                            <h2 class="text-xl font-bold text-techaccent mb-4">ğŸ¢ å“ç‰Œåˆ†æ</h2>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div>
                                    <h3 class="text-lg font-semibold text-gray-200 mb-3">è‡ªèº«å“ç‰Œè³‡è¨Š</h3>
                                    <div class="space-y-2 text-sm">
                                        <div><span class="text-gray-400">å“ç‰Œåç¨±ï¼š</span><span class="text-gray-200">${analysisData.brand?.name || 'æœªæŒ‡å®š'}</span></div>
                                        <div><span class="text-gray-400">å“ç‰Œå®˜ç¶²ï¼š</span><span class="text-gray-200">${analysisData.brand?.website || 'æœªæŒ‡å®š'}</span></div>
                                        <div><span class="text-gray-400">å“ç‰Œæè¿°ï¼š</span><span class="text-gray-200">${analysisData.brand?.description || 'æœªæŒ‡å®š'}</span></div>
                                    </div>
                                </div>
                                <div>
                                    <h3 class="text-lg font-semibold text-gray-200 mb-3">å¸‚å ´å®šä½</h3>
                                    <div class="space-y-2 text-sm">
                                        <div><span class="text-gray-400">è¡Œæ¥­é¡åˆ¥ï¼š</span><span class="text-gray-200">${analysisData.industry?.category || 'æœªæŒ‡å®š'}</span></div>
                                        <div><span class="text-gray-400">å¸‚å ´è¦æ¨¡ï¼š</span><span class="text-gray-200">${analysisData.market?.size || 'æœªæŒ‡å®š'}</span></div>
                                        <div><span class="text-gray-400">åˆ†æä¸»é¡Œï¼š</span><span class="text-gray-200">${analysisData.topic || 'æœªæŒ‡å®š'}</span></div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- ç«¶çˆ­å°æ‰‹æ¯”è¼ƒè¡¨ -->
                        <div class="bg-gray-800 rounded-lg p-6">
                            <h2 class="text-xl font-bold text-techaccent mb-4">ğŸ“Š ç«¶çˆ­å°æ‰‹æ¯”è¼ƒåˆ†æ</h2>
                            <div class="overflow-x-auto">
                                <table class="w-full comparison-table">
                                    <thead>
                                        <tr>
                                            <th class="text-left">ç«¶çˆ­å°æ‰‹</th>
                                            <th class="text-left">æˆç«‹æ™‚é–“</th>
                                            <th class="text-left">å“¡å·¥æ•¸</th>
                                            <th class="text-left">ç‡Ÿæ”¶è¦æ¨¡</th>
                                            <th class="text-left">å¸‚å ´åœ°ä½</th>
                                            <th class="text-left">ä¸»è¦å„ªå‹¢</th>
                                            <th class="text-left">ä¸»è¦å¼±å‹¢</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                `;

                competitors.forEach(competitor => {
                    report += `
                        <tr>
                            <td class="font-semibold">
                                <div>${competitor.name}</div>
                                <div class="text-xs text-gray-400">${competitor.description}</div>
                            </td>
                            <td>${competitor.founded || 'æœªçŸ¥'}</td>
                            <td>${competitor.employees || 'æœªçŸ¥'}</td>
                            <td>${competitor.revenue || 'æœªçŸ¥'}</td>
                            <td>${competitor.marketShare || 'æœªçŸ¥'}</td>
                            <td class="text-green-400 text-sm">${competitor.strengths || 'æœªæä¾›'}</td>
                            <td class="text-red-400 text-sm">${competitor.weaknesses || 'æœªæä¾›'}</td>
                        </tr>
                    `;
                });

                report += `
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <!-- SWOT åˆ†æ -->
                        <div class="bg-gray-800 rounded-lg p-6">
                            <h2 class="text-xl font-bold text-techaccent mb-4">ğŸ¯ SWOT åˆ†æ</h2>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div class="space-y-4">
                                    <div class="border-l-4 border-green-500 pl-4">
                                        <h3 class="text-lg font-semibold text-green-400 mb-2">å„ªå‹¢ (Strengths)</h3>
                                        <ul class="text-sm text-gray-300 space-y-1">
                                            <li>â€¢ å“ç‰ŒçŸ¥ååº¦åœ¨ç›®æ¨™å¸‚å ´ä¸­å…·æœ‰å„ªå‹¢</li>
                                            <li>â€¢ ç”¢å“/æœå‹™ç‰¹è‰²ç¬¦åˆå¸‚å ´éœ€æ±‚</li>
                                            <li>â€¢ æŠ€è¡“å¯¦åŠ›å’Œå‰µæ–°èƒ½åŠ›</li>
                                        </ul>
                                    </div>
                                    <div class="border-l-4 border-red-500 pl-4">
                                        <h3 class="text-lg font-semibold text-red-400 mb-2">å¼±å‹¢ (Weaknesses)</h3>
                                        <ul class="text-sm text-gray-300 space-y-1">
                                            <li>â€¢ å¸‚å ´ä»½é¡ç›¸å°è¼ƒå°</li>
                                            <li>â€¢ è³‡æºæŠ•å…¥æœ‰é™</li>
                                            <li>â€¢ å“ç‰ŒèªçŸ¥åº¦æœ‰å¾…æå‡</li>
                                        </ul>
                                    </div>
                                </div>
                                <div class="space-y-4">
                                    <div class="border-l-4 border-blue-500 pl-4">
                                        <h3 class="text-lg font-semibold text-blue-400 mb-2">æ©Ÿæœƒ (Opportunities)</h3>
                                        <ul class="text-sm text-gray-300 space-y-1">
                                            <li>â€¢ å¸‚å ´å¿«é€Ÿæˆé•·æœŸ</li>
                                            <li>â€¢ æŠ€è¡“å‰µæ–°å¸¶ä¾†æ–°æ©Ÿæœƒ</li>
                                            <li>â€¢ ç«¶çˆ­å°æ‰‹ç­–ç•¥èª¿æ•´çš„çª—å£æœŸ</li>
                                        </ul>
                                    </div>
                                    <div class="border-l-4 border-yellow-500 pl-4">
                                        <h3 class="text-lg font-semibold text-yellow-400 mb-2">å¨è„… (Threats)</h3>
                                        <ul class="text-sm text-gray-300 space-y-1">
                                            <li>â€¢ å¤§å‹ç«¶çˆ­å°æ‰‹é€²å…¥å¸‚å ´</li>
                                            <li>â€¢ æŠ€è¡“è®Šé©é€Ÿåº¦åŠ å¿«</li>
                                            <li>â€¢ å¸‚å ´é£½å’Œåº¦å¢åŠ </li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- ç­–ç•¥å»ºè­° -->
                        <div class="bg-gray-800 rounded-lg p-6">
                            <h2 class="text-xl font-bold text-techaccent mb-4">ğŸ’¡ ç­–ç•¥å»ºè­°</h2>
                            <div class="space-y-4">
                                <div class="border-l-4 border-techaccent pl-4">
                                    <h3 class="text-lg font-semibold text-techaccent mb-2">çŸ­æœŸç­–ç•¥ (3-6å€‹æœˆ)</h3>
                                    <ul class="text-sm text-gray-300 space-y-1">
                                        <li>â€¢ å¼·åŒ–å“ç‰Œå®šä½å’Œå¸‚å ´è¨Šæ¯</li>
                                        <li>â€¢ å„ªåŒ–ç”¢å“/æœå‹™é«”é©—</li>
                                        <li>â€¢ å»ºç«‹ç«¶çˆ­å„ªå‹¢çš„å·®ç•°åŒ–ç‰¹è‰²</li>
                                    </ul>
                                </div>
                                <div class="border-l-4 border-techprimary pl-4">
                                    <h3 class="text-lg font-semibold text-techprimary mb-2">ä¸­æœŸç­–ç•¥ (6-12å€‹æœˆ)</h3>
                                    <ul class="text-sm text-gray-300 space-y-1">
                                        <li>â€¢ æ“´å¤§å¸‚å ´ä»½é¡å’Œå®¢æˆ¶åŸºç¤</li>
                                        <li>â€¢ é–‹ç™¼æ–°ç”¢å“ç·šæˆ–æœå‹™</li>
                                        <li>â€¢ å»ºç«‹æˆ°ç•¥åˆä½œå¤¥ä¼´é—œä¿‚</li>
                                    </ul>
                                </div>
                                <div class="border-l-4 border-techsecondary pl-4">
                                    <h3 class="text-lg font-semibold text-techsecondary mb-2">é•·æœŸç­–ç•¥ (1-3å¹´)</h3>
                                    <ul class="text-sm text-gray-300 space-y-1">
                                        <li>â€¢ æˆç‚ºè¡Œæ¥­é ˜å°è€…</li>
                                        <li>â€¢ åœ‹éš›åŒ–æ“´å¼µ</li>
                                        <li>â€¢ å»ºç«‹ç”Ÿæ…‹ç³»çµ±å’Œå¹³å°</li>
                                    </ul>
                                </div>
                            </div>
                        </div>

                        <!-- è¡Œå‹•æ–¹æ¡ˆ -->
                        <div class="bg-gray-800 rounded-lg p-6">
                            <h2 class="text-xl font-bold text-techaccent mb-4">ğŸš€ ç«‹å³è¡Œå‹•æ–¹æ¡ˆ</h2>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div>
                                    <h3 class="text-lg font-semibold text-gray-200 mb-3">å„ªå…ˆç´šé«˜</h3>
                                    <ul class="text-sm text-gray-300 space-y-2">
                                        <li>â€¢ å®Œæˆç«¶çˆ­å°æ‰‹æ·±åº¦åˆ†æ</li>
                                        <li>â€¢ åˆ¶å®šå·®ç•°åŒ–ç­–ç•¥</li>
                                        <li>â€¢ å»ºç«‹ç›£æ§æ©Ÿåˆ¶</li>
                                    </ul>
                                </div>
                                <div>
                                    <h3 class="text-lg font-semibold text-gray-200 mb-3">å„ªå…ˆç´šä¸­</h3>
                                    <ul class="text-sm text-gray-300 space-y-2">
                                        <li>â€¢ å„ªåŒ–ç”¢å“å®šä½</li>
                                        <li>â€¢ åŠ å¼·è¡ŒéŠ·æ¨å»£</li>
                                        <li>â€¢ å»ºç«‹å®¢æˆ¶é—œä¿‚</li>
                                    </ul>
                                </div>
                            </div>
                        </div>

                        <!-- å ±å‘Šæ“ä½œæŒ‰éˆ• -->
                        <div class="flex gap-4 justify-center pt-6 border-t border-gray-700">
                            <button onclick="downloadReport()" class="bg-techprimary hover:bg-techaccent text-white px-6 py-3 rounded-lg font-semibold">
                                ğŸ“¥ ä¸‹è¼‰å ±å‘Š
                            </button>
                            <button onclick="saveToGoogleDrive()" class="bg-green-600 hover:bg-green-700 text-white px-6 py-3 rounded-lg font-semibold">
                                â˜ï¸ å„²å­˜åˆ° Google Drive
                            </button>
                            <button onclick="goToStep(1)" class="bg-gray-600 hover:bg-gray-700 text-white px-6 py-3 rounded-lg font-semibold">
                                ğŸ”„ é‡æ–°åˆ†æ
                            </button>
                        </div>
                    </div>
                `;

                return report;

            } catch (error) {
                console.error('å‰µå»ºå®Œæ•´å ±å‘Šå¤±æ•—:', error);
                return '<p class="text-red-400">å ±å‘Šç”Ÿæˆå¤±æ•—ï¼Œè«‹é‡æ–°å˜—è©¦</p>';
            }
        }

        // ä¸‹è¼‰å ±å‘Š
        function downloadReport() {
            try {
                const reportContent = document.getElementById('final-report-content').innerText;
                const projectId = document.getElementById('project-id')?.value || 'TEMP_' + Date.now();
                const filename = `å¸‚å ´æƒ…è³‡åˆ†æå ±å‘Š_${projectId}_${new Date().toISOString().split('T')[0]}.txt`;
                
                const blob = new Blob([reportContent], { type: 'text/plain;charset=utf-8' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = filename;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                showAlert('ä¸‹è¼‰æˆåŠŸ', 'å ±å‘Šå·²ä¸‹è¼‰åˆ°æ‚¨çš„è£ç½®', 'success');
            } catch (error) {
                console.error('ä¸‹è¼‰å ±å‘Šå¤±æ•—:', error);
                showAlert('ä¸‹è¼‰å¤±æ•—', 'ç„¡æ³•ä¸‹è¼‰å ±å‘Šï¼Œè«‹é‡è©¦', 'error');
            }
        }

        // å„²å­˜åˆ° Google Drive
        function saveToGoogleDrive() {
            try {
                if (!state.isAuthenticated) {
                    showAlert('è«‹å…ˆç™»å…¥', 'éœ€è¦ Google å¸³æˆ¶æˆæ¬Šæ‰èƒ½å„²å­˜åˆ° Drive', 'warning');
                    return;
                }
                
                showAlert('å„²å­˜ä¸­', 'æ­£åœ¨å„²å­˜å ±å‘Šåˆ° Google Drive...', 'info');
                
                // é€™è£¡å¯ä»¥å¯¦ä½œ Google Drive API å„²å­˜é‚è¼¯
                setTimeout(() => {
                    showAlert('å„²å­˜æˆåŠŸ', 'å ±å‘Šå·²å„²å­˜åˆ° Google Drive', 'success');
                }, 2000);
                
            } catch (error) {
                console.error('å„²å­˜åˆ° Google Drive å¤±æ•—:', error);
                showAlert('å„²å­˜å¤±æ•—', 'ç„¡æ³•å„²å­˜åˆ° Google Driveï¼Œè«‹é‡è©¦', 'error');
            }
        }

        // æœå°‹ç«¶çˆ­å°æ‰‹
        function searchCompetitors() {
            try {
                if (!state.analysisData.topic || !state.analysisData.brand) {
                    console.warn('æ²’æœ‰åˆ†æä¸»é¡Œæˆ–å“ç‰Œè³‡è¨Šï¼Œç„¡æ³•æœå°‹ç«¶çˆ­å°æ‰‹');
                    return;
                }

                // åŸºæ–¼è¡Œæ¥­é¡åˆ¥å’Œå“ç‰Œè³‡è¨Šç”Ÿæˆæ›´ç²¾ç¢ºçš„ç«¶çˆ­å°æ‰‹
                const industryCategory = state.analysisData.industry.category;
                const brandName = state.analysisData.brand.name;
                const topic = state.analysisData.topic;

                // æ ¹æ“šä¸åŒè¡Œæ¥­ç”Ÿæˆç›¸é—œç«¶çˆ­å°æ‰‹
                let mockCompetitors = [];
                
                switch (industryCategory) {
                    case 'ecommerce':
                        mockCompetitors = [
                            { 
                                name: 'è¦çš®è³¼ç‰© (Shopee)', 
                                description: 'æ±å—äºæœ€å¤§é›»å•†å¹³å°ï¼ŒC2C å’Œ B2C æ¨¡å¼ï¼Œæ¯å…¬å¸ç‚º Sea Group', 
                                website: 'https://shopee.tw', 
                                linkedin: 'https://linkedin.com/company/shopee',
                                founded: '2015',
                                employees: '10,000+',
                                revenue: 'æ•¸åå„„ç¾å…ƒ',
                                marketShare: 'æ±å—äºé›»å•†é ˜å°è€…',
                                strengths: 'è¡Œå‹•å„ªå…ˆã€ç¤¾äº¤é›»å•†ã€æ±å—äºå¸‚å ´å„ªå‹¢',
                                weaknesses: 'ç²åˆ©èƒ½åŠ›å¾…æ”¹å–„ã€ç«¶çˆ­æ¿€çƒˆ'
                            },
                            { 
                                name: 'PChome ç¶²è·¯å®¶åº­', 
                                description: 'å°ç£è€ç‰Œé›»å•†å¹³å°ï¼Œ3C ç”¢å“èµ·å®¶ï¼Œå°ç£é›»å•†å…ˆé©…', 
                                website: 'https://pchome.com.tw', 
                                linkedin: 'https://linkedin.com/company/pchome',
                                founded: '1998',
                                employees: '1,000+',
                                revenue: 'æ•¸ç™¾å„„å°å¹£',
                                marketShare: 'å°ç£é›»å•†å‰ä¸‰å',
                                strengths: '3C ç”¢å“å„ªå‹¢ã€ç‰©æµé«”ç³»å®Œæ•´ã€å“ç‰ŒçŸ¥ååº¦é«˜',
                                weaknesses: 'è½‰å‹é€Ÿåº¦è¼ƒæ…¢ã€è¡Œå‹•åŒ–ä¸è¶³'
                            },
                            { 
                                name: 'momo å¯Œé‚¦åª’é«”', 
                                description: 'å°ç£é›»å•†é¾é ­ï¼Œé›»è¦–è³¼ç‰©è½‰å‹æˆåŠŸï¼Œå¯Œé‚¦é›†åœ˜æ——ä¸‹', 
                                website: 'https://momoshop.com.tw', 
                                linkedin: 'https://linkedin.com/company/momo',
                                founded: '2004',
                                employees: '2,000+',
                                revenue: 'åƒå„„å°å¹£',
                                marketShare: 'å°ç£é›»å•†ç¬¬ä¸€å',
                                strengths: 'é›»è¦–è³¼ç‰©åŸºç¤ã€ç‰©æµé…é€å¿«é€Ÿã€å•†å“ç¨®é¡è±å¯Œ',
                                weaknesses: 'é›»è¦–è³¼ç‰©å½¢è±¡åŒ…è¢±ã€ç²åˆ©æ¨¡å¼å–®ä¸€'
                            },
                            { 
                                name: 'Yahoo å¥‡æ‘©è³¼ç‰©', 
                                description: 'å…¥å£ç¶²ç«™é›»å•†ï¼Œæœå°‹æµé‡å„ªå‹¢ï¼ŒVerizon Media æ——ä¸‹', 
                                website: 'https://tw.buy.yahoo.com', 
                                linkedin: 'https://linkedin.com/company/yahoo',
                                founded: '1994',
                                employees: 'å…¨çƒ 10,000+',
                                revenue: 'æ•¸åå„„ç¾å…ƒ',
                                marketShare: 'å°ç£é›»å•†å‰äº”å',
                                strengths: 'æœå°‹æµé‡å„ªå‹¢ã€å…¥å£ç¶²ç«™æ•´åˆã€å“ç‰Œä¿¡ä»»åº¦é«˜',
                                weaknesses: 'æ¯å…¬å¸ç­–ç•¥è®Šå‹•ã€å‰µæ–°é€Ÿåº¦è¼ƒæ…¢'
                            },
                            { 
                                name: 'éœ²å¤©æ‹è³£', 
                                description: 'PChome æ——ä¸‹ C2C å¹³å°ï¼Œå°ç£æœ€å¤§æ‹è³£ç¶²ç«™', 
                                website: 'https://www.ruten.com.tw', 
                                linkedin: 'https://linkedin.com/company/ruten',
                                founded: '2006',
                                employees: '500+',
                                revenue: 'æ•¸åå„„å°å¹£',
                                marketShare: 'å°ç£ C2C é ˜å°è€…',
                                strengths: 'C2C å¹³å°å„ªå‹¢ã€PChome è³‡æºæ•´åˆã€ç”¨æˆ¶åŸºç¤é¾å¤§',
                                weaknesses: 'å‡è²¨å•é¡Œã€å¹³å°ç®¡ç†æŒ‘æˆ°'
                            }
                        ];
                        break;
                    case 'saas':
                        mockCompetitors = [
                            { 
                                name: 'Microsoft 365', 
                                description: 'ä¼æ¥­è¾¦å…¬è»Ÿé«”å¥—ä»¶ï¼Œé›²ç«¯å”ä½œï¼Œå¾®è»Ÿæ ¸å¿ƒç”¢å“', 
                                website: 'https://microsoft.com', 
                                linkedin: 'https://linkedin.com/company/microsoft',
                                founded: '1975',
                                employees: '200,000+',
                                revenue: 'æ•¸åƒå„„ç¾å…ƒ',
                                marketShare: 'ä¼æ¥­è»Ÿé«”é ˜å°è€…',
                                strengths: 'ä¼æ¥­å®¢æˆ¶åŸºç¤é¾å¤§ã€ç”¢å“æ•´åˆåº¦é«˜ã€å“ç‰Œä¿¡ä»»åº¦æ¥µé«˜',
                                weaknesses: 'å‰µæ–°é€Ÿåº¦è¼ƒæ…¢ã€åƒ¹æ ¼è¼ƒé«˜'
                            },
                            { 
                                name: 'Google Workspace', 
                                description: 'Google ä¼æ¥­æœå‹™ï¼ŒGmail ç”Ÿæ…‹ç³»ï¼Œé›²ç«¯åŸç”Ÿ', 
                                website: 'https://workspace.google.com', 
                                linkedin: 'https://linkedin.com/company/google',
                                founded: '1998',
                                employees: '150,000+',
                                revenue: 'æ•¸åƒå„„ç¾å…ƒ',
                                marketShare: 'é›²ç«¯è¾¦å…¬é ˜å°è€…',
                                strengths: 'é›²ç«¯åŸç”Ÿã€AI æ•´åˆã€å…è²»ç‰ˆæœ¬å„ªå‹¢',
                                weaknesses: 'ä¼æ¥­åŠŸèƒ½ç›¸å°ä¸è¶³ã€éš±ç§ç–‘æ…®'
                            },
                            { 
                                name: 'Slack Technologies', 
                                description: 'åœ˜éšŠæºé€šå”ä½œå¹³å°ï¼Œä¼æ¥­å³æ™‚é€šè¨Šé ˜å°è€…', 
                                website: 'https://slack.com', 
                                linkedin: 'https://linkedin.com/company/slack',
                                founded: '2009',
                                employees: '2,000+',
                                revenue: 'æ•¸å„„ç¾å…ƒ',
                                marketShare: 'ä¼æ¥­é€šè¨Šé ˜å°è€…',
                                strengths: 'ç”¨æˆ¶é«”é©—å„ªç§€ã€æ•´åˆèƒ½åŠ›å¼·ã€ä¼æ¥­æ¡ç”¨ç‡é«˜',
                                weaknesses: 'ç²åˆ©èƒ½åŠ›å¾…æ”¹å–„ã€ç«¶çˆ­æ¿€çƒˆ'
                            },
                            { 
                                name: 'Notion Labs', 
                                description: 'å…¨èƒ½ç­†è¨˜å’Œå”ä½œå¹³å°ï¼ŒçŸ¥è­˜ç®¡ç†å·¥å…·', 
                                website: 'https://notion.so', 
                                linkedin: 'https://linkedin.com/company/notion',
                                founded: '2016',
                                employees: '500+',
                                revenue: 'æ•¸å„„ç¾å…ƒ',
                                marketShare: 'çŸ¥è­˜ç®¡ç†æ–°èˆˆé ˜å°è€…',
                                strengths: 'åŠŸèƒ½å¼·å¤§ã€ç”¨æˆ¶é«”é©—å„ªç§€ã€å¹´è¼•ç”¨æˆ¶åŸºç¤',
                                weaknesses: 'å­¸ç¿’æ›²ç·šé™¡å³­ã€ä¼æ¥­åŠŸèƒ½å¾…å®Œå–„'
                            },
                            { 
                                name: 'Zoom Video Communications', 
                                description: 'è¦–è¨Šæœƒè­°å¹³å°é ˜å°è€…ï¼Œç–«æƒ…æœŸé–“å¿«é€Ÿæˆé•·', 
                                website: 'https://zoom.us', 
                                linkedin: 'https://linkedin.com/company/zoom-video-communications',
                                founded: '2011',
                                employees: '5,000+',
                                revenue: 'æ•¸åå„„ç¾å…ƒ',
                                marketShare: 'è¦–è¨Šæœƒè­°é ˜å°è€…',
                                strengths: 'æ˜“ç”¨æ€§ã€ç©©å®šæ€§ã€ç–«æƒ…æœŸé–“å¿«é€Ÿæˆé•·',
                                weaknesses: 'å®‰å…¨æ€§ç–‘æ…®ã€ç«¶çˆ­æ¿€çƒˆ'
                            }
                        ];
                        break;
                    case 'fintech':
                        mockCompetitors = [
                            { 
                                name: 'Square (Block)', 
                                description: 'æ”¯ä»˜è™•ç†å’Œé‡‘èæœå‹™å¹³å°ï¼Œå°ä¼æ¥­é‡‘èè§£æ±ºæ–¹æ¡ˆ', 
                                website: 'https://squareup.com', 
                                linkedin: 'https://linkedin.com/company/square',
                                founded: '2009',
                                employees: '8,000+',
                                revenue: 'æ•¸åå„„ç¾å…ƒ',
                                marketShare: 'å°ä¼æ¥­æ”¯ä»˜é ˜å°è€…',
                                strengths: 'å°ä¼æ¥­å°ˆæ³¨ã€ç¡¬é«”æ•´åˆã€ç”Ÿæ…‹ç³»çµ±å®Œæ•´',
                                weaknesses: 'å¤§ä¼æ¥­å¸‚å ´æœ‰é™ã€ç²åˆ©èƒ½åŠ›å¾…æ”¹å–„'
                            },
                            { 
                                name: 'Stripe', 
                                description: 'ç·šä¸Šæ”¯ä»˜è™•ç†å¹³å°ï¼Œé–‹ç™¼è€…å‹å¥½çš„ API', 
                                website: 'https://stripe.com', 
                                linkedin: 'https://linkedin.com/company/stripe',
                                founded: '2010',
                                employees: '7,000+',
                                revenue: 'æ•¸åå„„ç¾å…ƒ',
                                marketShare: 'ç·šä¸Šæ”¯ä»˜é ˜å°è€…',
                                strengths: 'é–‹ç™¼è€…å‹å¥½ã€å…¨çƒè¦†è“‹ã€æŠ€è¡“é ˜å…ˆ',
                                weaknesses: 'åƒ¹æ ¼è¼ƒé«˜ã€ç«¶çˆ­æ¿€çƒˆ'
                            },
                            { 
                                name: 'PayPal', 
                                description: 'å…¨çƒæ”¯ä»˜å¹³å°ï¼Œé›»å­å•†å‹™æ”¯ä»˜é ˜å°è€…', 
                                website: 'https://paypal.com', 
                                linkedin: 'https://linkedin.com/company/paypal',
                                founded: '1998',
                                employees: '30,000+',
                                revenue: 'æ•¸ç™¾å„„ç¾å…ƒ',
                                marketShare: 'å…¨çƒæ”¯ä»˜é ˜å°è€…',
                                strengths: 'å“ç‰ŒçŸ¥ååº¦é«˜ã€å…¨çƒè¦†è“‹ã€ç”¨æˆ¶åŸºç¤é¾å¤§',
                                weaknesses: 'å‰µæ–°é€Ÿåº¦è¼ƒæ…¢ã€è²»ç”¨è¼ƒé«˜'
                            },
                            { 
                                name: 'Robinhood', 
                                description: 'é›¶ä½£é‡‘è‚¡ç¥¨äº¤æ˜“å¹³å°ï¼Œå¹´è¼•æŠ•è³‡è€…é¦–é¸', 
                                website: 'https://robinhood.com', 
                                linkedin: 'https://linkedin.com/company/robinhood',
                                founded: '2013',
                                employees: '3,000+',
                                revenue: 'æ•¸å„„ç¾å…ƒ',
                                marketShare: 'é›¶ä½£é‡‘äº¤æ˜“é ˜å°è€…',
                                strengths: 'é›¶ä½£é‡‘ã€ç”¨æˆ¶é«”é©—å„ªç§€ã€å¹´è¼•ç”¨æˆ¶åŸºç¤',
                                weaknesses: 'åŠŸèƒ½ç›¸å°ç°¡å–®ã€ç›£ç®¡é¢¨éšª'
                            },
                            { 
                                name: 'Coinbase', 
                                description: 'åŠ å¯†è²¨å¹£äº¤æ˜“å¹³å°ï¼Œæ•¸ä½è³‡ç”¢äº¤æ˜“æ‰€', 
                                website: 'https://coinbase.com', 
                                linkedin: 'https://linkedin.com/company/coinbase',
                                founded: '2012',
                                employees: '3,000+',
                                revenue: 'æ•¸åå„„ç¾å…ƒ',
                                marketShare: 'åŠ å¯†è²¨å¹£äº¤æ˜“é ˜å°è€…',
                                strengths: 'åˆè¦æ€§å¼·ã€ç”¨æˆ¶ä¿¡ä»»åº¦é«˜ã€æ©Ÿæ§‹å®¢æˆ¶åŸºç¤',
                                weaknesses: 'ç›£ç®¡é¢¨éšªã€å¸‚å ´æ³¢å‹•æ€§å¤§'
                            }
                        ];
                        break;
                    case 'marketing':
                        mockCompetitors = [
                            { 
                                name: 'HubSpot', 
                                description: 'å…¨æ–¹ä½è¡ŒéŠ·è‡ªå‹•åŒ–å¹³å°ï¼ŒCRM æ•´åˆ', 
                                website: 'https://hubspot.com', 
                                linkedin: 'https://linkedin.com/company/hubspot',
                                founded: '2006',
                                employees: '7,000+',
                                revenue: 'æ•¸åå„„ç¾å…ƒ',
                                marketShare: 'è¡ŒéŠ·è‡ªå‹•åŒ–é ˜å°è€…',
                                strengths: 'å…¨æ–¹ä½è§£æ±ºæ–¹æ¡ˆã€ç”¨æˆ¶é«”é©—å„ªç§€ã€å…§å®¹è¡ŒéŠ·å¼·',
                                weaknesses: 'åƒ¹æ ¼è¼ƒé«˜ã€å­¸ç¿’æ›²ç·šé™¡å³­'
                            },
                            { 
                                name: 'Mailchimp', 
                                description: 'é›»å­éƒµä»¶è¡ŒéŠ·å¹³å°ï¼Œå°ä¼æ¥­é¦–é¸', 
                                website: 'https://mailchimp.com', 
                                linkedin: 'https://linkedin.com/company/mailchimp',
                                founded: '2001',
                                employees: '1,200+',
                                revenue: 'æ•¸å„„ç¾å…ƒ',
                                marketShare: 'é›»å­éƒµä»¶è¡ŒéŠ·é ˜å°è€…',
                                strengths: 'æ˜“ç”¨æ€§ã€å°ä¼æ¥­å°ˆæ³¨ã€åƒ¹æ ¼å¯¦æƒ ',
                                weaknesses: 'åŠŸèƒ½ç›¸å°ç°¡å–®ã€ä¼æ¥­åŠŸèƒ½ä¸è¶³'
                            },
                            { 
                                name: 'Canva', 
                                description: 'ç·šä¸Šè¨­è¨ˆå¹³å°ï¼Œè¦–è¦ºå…§å®¹å‰µä½œå·¥å…·', 
                                website: 'https://canva.com', 
                                linkedin: 'https://linkedin.com/company/canva',
                                founded: '2012',
                                employees: '3,000+',
                                revenue: 'æ•¸å„„ç¾å…ƒ',
                                marketShare: 'ç·šä¸Šè¨­è¨ˆé ˜å°è€…',
                                strengths: 'æ˜“ç”¨æ€§ã€æ¨¡æ¿è±å¯Œã€å”ä½œåŠŸèƒ½å¼·',
                                weaknesses: 'å°ˆæ¥­åŠŸèƒ½ç›¸å°ä¸è¶³ã€ç‰ˆæ¬Šå•é¡Œ'
                            },
                            { 
                                name: 'Hootsuite', 
                                description: 'ç¤¾ç¾¤åª’é«”ç®¡ç†å¹³å°ï¼Œå¤šå¹³å°æ•´åˆ', 
                                website: 'https://hootsuite.com', 
                                linkedin: 'https://linkedin.com/company/hootsuite',
                                founded: '2008',
                                employees: '1,000+',
                                revenue: 'æ•¸å„„ç¾å…ƒ',
                                marketShare: 'ç¤¾ç¾¤åª’é«”ç®¡ç†é ˜å°è€…',
                                strengths: 'å¤šå¹³å°æ•´åˆã€ä¼æ¥­åŠŸèƒ½å®Œæ•´ã€åˆ†æå·¥å…·å¼·',
                                weaknesses: 'åƒ¹æ ¼è¼ƒé«˜ã€ç”¨æˆ¶é«”é©—å¾…æ”¹å–„'
                            },
                            { 
                                name: 'Buffer', 
                                description: 'ç¤¾ç¾¤åª’é«”æ’ç¨‹å·¥å…·ï¼Œç°¡æ½”æ˜“ç”¨', 
                                website: 'https://buffer.com', 
                                linkedin: 'https://linkedin.com/company/buffer',
                                founded: '2010',
                                employees: '100+',
                                revenue: 'æ•¸åƒè¬ç¾å…ƒ',
                                marketShare: 'ç¤¾ç¾¤åª’é«”å·¥å…·æ–°èˆˆé ˜å°è€…',
                                strengths: 'ç°¡æ½”æ˜“ç”¨ã€åƒ¹æ ¼å¯¦æƒ ã€ç”¨æˆ¶é«”é©—å„ªç§€',
                                weaknesses: 'åŠŸèƒ½ç›¸å°ç°¡å–®ã€ä¼æ¥­åŠŸèƒ½ä¸è¶³'
                            }
                        ];
                        break;
                    default:
                        // é€šç”¨ç«¶çˆ­å°æ‰‹
                        mockCompetitors = [
                            { 
                                name: 'ç«¶çˆ­å°æ‰‹ A', 
                                description: 'ä¸»è¦ç«¶çˆ­å°æ‰‹ï¼Œå¸‚å ç‡ç´„ 30%ï¼Œè¡Œæ¥­é ˜å°è€…', 
                                website: 'https://competitor-a.com', 
                                linkedin: 'https://linkedin.com/company/competitor-a',
                                founded: '2010',
                                employees: '5,000+',
                                revenue: 'æ•¸åå„„ç¾å…ƒ',
                                marketShare: 'è¡Œæ¥­é ˜å°è€…',
                                strengths: 'å“ç‰ŒçŸ¥ååº¦é«˜ã€è³‡æºè±å¯Œã€æŠ€è¡“é ˜å…ˆ',
                                weaknesses: 'å‰µæ–°é€Ÿåº¦è¼ƒæ…¢ã€å®˜åƒšåŒ–åš´é‡'
                            },
                            { 
                                name: 'ç«¶çˆ­å°æ‰‹ B', 
                                description: 'æ–°èˆˆç«¶çˆ­å°æ‰‹ï¼Œæˆé•·å¿«é€Ÿï¼Œå‰µæ–°èƒ½åŠ›å¼·', 
                                website: 'https://competitor-b.com', 
                                linkedin: 'https://linkedin.com/company/competitor-b',
                                founded: '2018',
                                employees: '500+',
                                revenue: 'æ•¸å„„ç¾å…ƒ',
                                marketShare: 'æ–°èˆˆé ˜å°è€…',
                                strengths: 'å‰µæ–°èƒ½åŠ›å¼·ã€åæ‡‰é€Ÿåº¦å¿«ã€ç”¨æˆ¶é«”é©—å„ªç§€',
                                weaknesses: 'è³‡æºç›¸å°æœ‰é™ã€å“ç‰ŒçŸ¥ååº¦å¾…æå‡'
                            },
                            { 
                                name: 'ç«¶çˆ­å°æ‰‹ C', 
                                description: 'å‚³çµ±ç«¶çˆ­å°æ‰‹ï¼Œå“ç‰ŒçŸ¥ååº¦é«˜ï¼Œå¸‚å ´ç©©å®š', 
                                website: 'https://competitor-c.com', 
                                linkedin: 'https://linkedin.com/company/competitor-c',
                                founded: '2005',
                                employees: '2,000+',
                                revenue: 'æ•¸åå„„ç¾å…ƒ',
                                marketShare: 'å‚³çµ±é ˜å°è€…',
                                strengths: 'å“ç‰Œä¿¡ä»»åº¦é«˜ã€å®¢æˆ¶åŸºç¤ç©©å®šã€è³‡æºè±å¯Œ',
                                weaknesses: 'è½‰å‹å›°é›£ã€å‰µæ–°ä¸è¶³'
                            },
                            { 
                                name: 'ç«¶çˆ­å°æ‰‹ D', 
                                description: 'æŠ€è¡“é ˜å…ˆçš„ç«¶çˆ­å°æ‰‹ï¼Œç ”ç™¼æŠ•å…¥å¤§', 
                                website: 'https://competitor-d.com', 
                                linkedin: 'https://linkedin.com/company/competitor-d',
                                founded: '2012',
                                employees: '1,500+',
                                revenue: 'æ•¸å„„ç¾å…ƒ',
                                marketShare: 'æŠ€è¡“é ˜å°è€…',
                                strengths: 'æŠ€è¡“å¯¦åŠ›å¼·ã€ç ”ç™¼æŠ•å…¥å¤§ã€å°ˆåˆ©å„ªå‹¢',
                                weaknesses: 'å•†æ¥­åŒ–èƒ½åŠ›å¾…æ”¹å–„ã€ç”¨æˆ¶é«”é©—ä¸è¶³'
                            },
                            { 
                                name: 'ç«¶çˆ­å°æ‰‹ E', 
                                description: 'åƒ¹æ ¼ç«¶çˆ­å°æ‰‹ï¼Œä¸»æ‰“æ€§åƒ¹æ¯”ï¼Œå¸‚å ´ä»½é¡ç©©å®š', 
                                website: 'https://competitor-e.com', 
                                linkedin: 'https://linkedin.com/company/competitor-e',
                                founded: '2015',
                                employees: '800+',
                                revenue: 'æ•¸å„„ç¾å…ƒ',
                                marketShare: 'åƒ¹æ ¼é ˜å°è€…',
                                strengths: 'åƒ¹æ ¼å„ªå‹¢ã€æ€§åƒ¹æ¯”é«˜ã€å¸‚å ´åæ‡‰å¿«',
                                weaknesses: 'ç²åˆ©èƒ½åŠ›æœ‰é™ã€å“ç‰Œåƒ¹å€¼å¾…æå‡'
                            }
                        ];
                }

                // éæ¿¾æ‰èˆ‡è‡ªèº«å“ç‰Œç›¸åŒçš„ç«¶çˆ­å°æ‰‹
                mockCompetitors = mockCompetitors.filter(comp => 
                    comp.name.toLowerCase() !== brandName.toLowerCase()
                );

                // æ¨¡æ“¬æœå°‹å»¶é²
                setTimeout(() => {
                    displaySearchResults(mockCompetitors);
                }, 2000);

            } catch (error) {
                console.error('æœå°‹ç«¶çˆ­å°æ‰‹å¤±æ•—:', error);
            }
        }

        // é¡¯ç¤ºæœå°‹çµæœ
        function displaySearchResults(competitors) {
            try {
                const resultsContainer = document.getElementById('auto-search-results');
                if (!resultsContainer) return;

                let html = '';
                competitors.forEach((competitor, index) => {
                    html += `
                        <div class="bg-gray-800 rounded-lg p-4 border border-gray-700">
                            <div class="flex justify-between items-start mb-3">
                                <div class="flex-1">
                                    <h5 class="font-semibold text-gray-200 text-lg">${competitor.name}</h5>
                                    <p class="text-sm text-gray-400 mb-2">${competitor.description}</p>
                                    <div class="grid grid-cols-2 md:grid-cols-4 gap-2 text-xs text-gray-500">
                                        <div>æˆç«‹ï¼š${competitor.founded}</div>
                                        <div>å“¡å·¥ï¼š${competitor.employees}</div>
                                        <div>ç‡Ÿæ”¶ï¼š${competitor.revenue}</div>
                                        <div>å¸‚å ï¼š${competitor.marketShare}</div>
                                    </div>
                                    <div class="mt-2">
                                        <div class="text-xs text-green-400 mb-1">å„ªå‹¢ï¼š${competitor.strengths}</div>
                                        <div class="text-xs text-red-400">å¼±å‹¢ï¼š${competitor.weaknesses}</div>
                                    </div>
                                </div>
                                <button class="add-competitor-btn bg-techprimary hover:bg-techaccent text-white px-4 py-2 rounded text-sm ml-4" 
                                        data-competitor="${competitor.name}" 
                                        data-description="${competitor.description}" 
                                        data-website="${competitor.website || ''}" 
                                        data-linkedin="${competitor.linkedin || ''}"
                                        data-founded="${competitor.founded}"
                                        data-employees="${competitor.employees}"
                                        data-revenue="${competitor.revenue}"
                                        data-marketShare="${competitor.marketShare}"
                                        data-strengths="${competitor.strengths}"
                                        data-weaknesses="${competitor.weaknesses}">
                                    æ·»åŠ 
                                </button>
                            </div>
                            <div class="flex gap-2">
                                ${competitor.website ? `<a href="${competitor.website}" target="_blank" class="text-blue-400 hover:text-blue-300 text-xs">ğŸŒ å®˜ç¶²</a>` : ''}
                                ${competitor.linkedin ? `<a href="${competitor.linkedin}" target="_blank" class="text-blue-400 hover:text-blue-300 text-xs">ğŸ’¼ LinkedIn</a>` : ''}
                            </div>
                        </div>
                    `;
                });

                resultsContainer.innerHTML = html;

                // ç‚ºæ·»åŠ æŒ‰éˆ•æ·»åŠ äº‹ä»¶ç›£è½å™¨
                const addButtons = resultsContainer.querySelectorAll('.add-competitor-btn');
                addButtons.forEach(btn => {
                    btn.addEventListener('click', function() {
                        const competitorData = {
                            name: this.dataset.competitor,
                            description: this.dataset.description,
                            website: this.dataset.website,
                            linkedin: this.dataset.linkedin,
                            founded: this.dataset.founded,
                            employees: this.dataset.employees,
                            revenue: this.dataset.revenue,
                            marketShare: this.dataset.marketShare,
                            strengths: this.dataset.strengths,
                            weaknesses: this.dataset.weaknesses
                        };
                        
                        addCompetitorToList(
                            competitorData.name,
                            competitorData.description,
                            competitorData.website,
                            competitorData.linkedin,
                            competitorData.founded,
                            competitorData.employees,
                            competitorData.revenue,
                            competitorData.marketShare,
                            competitorData.strengths,
                            competitorData.weaknesses
                        );
                        
                        this.disabled = true;
                        this.textContent = 'å·²æ·»åŠ ';
                        this.classList.remove('bg-techprimary', 'hover:bg-techaccent');
                        this.classList.add('bg-gray-600');
                    });
                });

            } catch (error) {
                console.error('é¡¯ç¤ºæœå°‹çµæœå¤±æ•—:', error);
            }
        }
    </script>
    <style>
        /* Base styling and animations */
        body { font-family: "Segoe UI", Roboto, Arial, sans-serif; }
        .tab-main.active { border-color: #2EE9E4; background-color: #181D27; color: #2EE9E4; }
        .panel { display: none; }
        .panel.active { display: block; animation: fadeIn 0.5s ease; }
        .locked { opacity: 0.5; pointer-events: none; }
        .spinner { border: 4px solid rgba(59,130,246,.2); width: 36px; height: 36px; border-radius: 50%; border-left-color: #2EE9E4; animation: spin 1s ease infinite; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes spin { to { transform: rotate(360deg); } }
        
        /* Table and result panel styling */
        th, td { padding: 12px 15px; }
        .result-panel { max-height: 65vh; overflow-y: auto; }
        .overflow-x-auto { overflow-x: auto; }

        /* Custom scrollbar */
        ::-webkit-scrollbar { height: 8px; width: 8px; }
        ::-webkit-scrollbar-track { background: #181D27; }
        ::-webkit-scrollbar-thumb { background: #3762F0; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #7D5FFF; }

        /* Stepper UI */
        .stepper-container { display: flex; justify-content: space-between; margin-bottom: 1.5rem; }
        .step { flex: 1; text-align: center; position: relative; }
        .step-circle { width: 32px; height: 32px; line-height: 30px; border-radius: 50%; background-color: #22283A; color: #fff; display: inline-block; border: 2px solid #3762F0; font-weight: bold; cursor: pointer; transition: all .3s ease; }
        .step-title { margin-top: 0.5rem; font-size: 0.875rem; color: #9ca3af; }
        .step-line { position: absolute; top: 16px; left: 50%; width: 100%; height: 2px; background-color: #3762F0; z-index: -1; }
        .step:first-child .step-line { left: 50%; width: 50%; }
        .step:last-child .step-line { left: 0; width: 50%;}
        
        .step.active .step-circle { background-color: #3762F0; color: #fff; border-color: #2EE9E4; transform: scale(1.1); }
        .step.active .step-title { color: #2EE9E4; font-weight: bold; }
        .step.completed .step-circle { background-color: #2EE9E4; color: #181D27; border-color: #2EE9E4; }
        .step.completed .step-title { color: #d1d5db; }

        /* Badge Styles */
        .badge { display: inline-block; padding: 2px 10px; border-radius: 12px; font-weight: 600; font-size: 0.75rem; }
        .badge-high { background-color: #ef4444; color: white; }
        .badge-mid { background-color: #f97316; color: white; }
        .badge-low { background-color: #22c55e; color: white; }
        .badge-unknown { background-color: #6b7280; color: white; }

        /* Dashboard Cards */
        .dashboard-card { background: linear-gradient(135deg, #22283A 0%, #1a1f2e 100%); border: 1px solid #3762F0; border-radius: 12px; padding: 1.5rem; }
        .metric-value { font-size: 2rem; font-weight: bold; color: #2EE9E4; }
        .metric-label { color: #9ca3af; font-size: 0.875rem; margin-top: 0.5rem; }

        /* Comparison Table */
        .comparison-table { border-collapse: separate; border-spacing: 0; }
        .comparison-table th { background: #1a1f2e; border: 1px solid #3762F0; padding: 12px; }
        .comparison-table td { border: 1px solid #3762F0; padding: 12px; }
        .comparison-table tr:nth-child(even) { background: rgba(55, 98, 240, 0.05); }

        /* Chart Container */
        .chart-container { position: relative; height: 300px; margin: 1rem 0; }
    </style>
</head>
<body class="bg-techbg font-tech text-gray-100 min-h-screen">
    <!-- Header Section -->
    <header class="bg-techpanel shadow-lg sticky top-0 z-40">
        <div class="container mx-auto px-6 py-4 flex justify-between items-center">
            <h1 class="text-3xl font-extrabold tracking-wide text-techaccent flex items-center gap-2">
                <svg class="w-8 h-8 text-techprimary inline-block" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M12 3v2m0 14v2m9-9h-2M5 12H3m15.364-7.364l-1.414 1.414M6.05 17.95l-1.414 1.414m12.728 0l1.414-1.414M6.05 6.05L4.636 4.636" stroke-linecap="round" stroke-linejoin="round"></path></svg>
                å¸‚å ´æƒ…è³‡èˆ‡ç«¶å“åˆ†æå¹³å°
            </h1>
            <div id="auth-container">
                <div class="flex items-center gap-4">
                    <div id="user-profile" class="hidden items-center gap-3">
                        <img id="user-avatar" class="w-10 h-10 rounded-full" src="" alt="User Avatar">
                        <span id="user-name" class="font-semibold text-gray-200"></span>
                        <button id="signout_button" class="text-sm text-gray-400 hover:text-techaccent">ç™»å‡º</button>
                    </div>
                     <button id="authorize_button" class="hidden bg-gradient-to-tr from-techprimary to-techaccent hover:from-techsecondary hover:to-techaccent font-bold text-white px-5 py-2 rounded-lg shadow-lg">ç™»å…¥ Google</button>
                </div>
                <div class="text-xs text-yellow-400 mt-2">â€» éœ€æˆæ¬Š Google Drive å…¨æ¬Šé™æ‰èƒ½æ­£ç¢ºå„²å­˜è³‡æ–™</div>
            </div>
        </div>
    </header>

    <div id="alert-container" class="fixed top-24 right-6 z-50"></div>

    <main class="container mx-auto px-6 py-8">
        <div id="app-container" class="locked">
            <!-- Main Tabs -->
            <div class="flex border-b border-techprimary/20 mb-6">
                <button data-tab="analysis" class="tab-main tab-btn active flex-1 p-4 font-semibold">åˆ†æç³»çµ±</button>
                <button data-tab="settings" class="tab-main tab-btn flex-1 p-4 font-semibold">API è¨­å®š</button>
                <button data-tab="history" class="tab-main tab-btn flex-1 p-4 font-semibold">æ­·å²ç´€éŒ„</button>
            </div>

            <!-- API è¨­å®šé¢æ¿ -->
            <div id="settings-panel" class="panel">
                <section class="bg-techpanel rounded-xl shadow-2xl border border-techprimary/20 p-8 max-w-lg mx-auto">
                    <h2 class="text-2xl font-bold mb-6 text-techaccent text-center">API èˆ‡æ‡‰ç”¨ç¨‹å¼è¨­å®š</h2>
                    <div class="space-y-4">
                        <div><label for="google-api-key" class="block text-sm font-medium text-gray-300">Google API é‡‘é‘°</label><input type="password" id="google-api-key" class="mt-1 w-full px-4 py-2 rounded-lg bg-techbg border border-techprimary/20" placeholder="å¡«å¯« Gemini/Custom Search API Key"></div>
                        <div><label for="search-engine-id" class="block text-sm font-medium text-gray-300">å¯ç¨‹å¼åŒ–æœå°‹å¼•æ“ ID (CX)</label><input type="text" id="search-engine-id" class="mt-1 w-full px-4 py-2 rounded-lg bg-techbg border border-techprimary/20" placeholder="å¡«å¯« Custom Search Engine ID"></div>
                        
                        <!-- é›†ä¸­åŒ–è³‡æ–™å¤¾ç®¡ç†è¨­å®š -->
                        <div class="border-t border-techprimary/30 pt-4 mt-6">
                            <h3 class="text-lg font-semibold text-techaccent mb-4">ğŸ“ é›†ä¸­åŒ–è³‡æ–™å¤¾ç®¡ç†</h3>
                            <div class="space-y-4">
                                <div>
                                    <label for="central-folder-name" class="block text-sm font-medium text-gray-300">ä¸»è¦å°ˆæ¡ˆè³‡æ–™å¤¾åç¨±</label>
                                    <input type="text" id="central-folder-name" class="mt-1 w-full px-4 py-2 rounded-lg bg-techbg border border-techprimary/20" value="iStaging_å°ˆæ¡ˆç®¡ç†" placeholder="ä¾‹å¦‚: iStaging_å°ˆæ¡ˆç®¡ç†">
                                    <p class="text-xs text-gray-400 mt-1">æ­¤è³‡æ–™å¤¾å°‡åŒ…å«æ‰€æœ‰å°ˆæ¡ˆçš„å­è³‡æ–™å¤¾</p>
                                </div>
                                <div>
                                    <label for="intelligence-subfolder" class="block text-sm font-medium text-gray-300">å¸‚å ´æƒ…è³‡å­è³‡æ–™å¤¾åç¨±</label>
                                    <input type="text" id="intelligence-subfolder" class="mt-1 w-full px-4 py-2 rounded-lg bg-techbg border border-techprimary/20" value="01_å¸‚å ´æƒ…è³‡åˆ†æ" placeholder="ä¾‹å¦‚: 01_å¸‚å ´æƒ…è³‡åˆ†æ">
                                </div>
                                <div>
                                    <label for="mediaplan-subfolder" class="block text-sm font-medium text-gray-300">åª’é«”ææ¡ˆå­è³‡æ–™å¤¾åç¨±</label>
                                    <input type="text" id="mediaplan-subfolder" class="mt-1 w-full px-4 py-2 rounded-lg bg-techbg border border-techprimary/20" value="02_åª’é«”ææ¡ˆ" placeholder="ä¾‹å¦‚: 02_åª’é«”ææ¡ˆ">
                                </div>
                                <div>
                                    <label for="workflow-subfolder" class="block text-sm font-medium text-gray-300">å·¥ä½œæµç¨‹å­è³‡æ–™å¤¾åç¨±</label>
                                    <input type="text" id="workflow-subfolder" class="mt-1 w-full px-4 py-2 rounded-lg bg-techbg border border-techprimary/20" value="03_å·¥ä½œæµç¨‹æ–‡ä»¶" placeholder="ä¾‹å¦‚: 03_å·¥ä½œæµç¨‹æ–‡ä»¶">
                                </div>
                            </div>
                        </div>
                        
                        <button id="save-settings-btn" class="w-full bg-gradient-to-tr from-techprimary to-techaccent font-bold text-white px-5 py-3 rounded-lg shadow-lg mt-6">å„²å­˜è¨­å®š</button>
                    </div>
                </section>
            </div>

            <!-- åˆ†æç³»çµ±é¢æ¿ -->
            <div id="analysis-panel" class="panel">
                <!-- Stepper -->
                <div class="stepper-container mb-8">
                    <div id="step-1" class="step active">
                        <div class="step-circle">1</div>
                        <div class="step-title">åˆ†æè¨­å®š</div>
                        <div class="step-line"></div>
                    </div>
                    <div id="step-2" class="step">
                        <div class="step-circle">2</div>
                        <div class="step-title">å°æ‰‹ç¯©é¸èˆ‡è£œå……</div>
                        <div class="step-line"></div>
                    </div>
                    <div id="step-3" class="step">
                        <div class="step-circle">3</div>
                        <div class="step-title">å®Œæ•´å ±å‘Š</div>
                    </div>
                </div>

                <!-- Step 1: åˆ†æè¨­å®š -->
                <div id="step-1-content" class="step-panel">
                    <section class="bg-techpanel rounded-xl shadow-2xl border border-techprimary/20 p-8">
                        <h2 class="text-2xl font-bold mb-6 text-techaccent">ğŸ“Š å“ç‰Œèˆ‡å¸‚å ´åˆ†æè¨­å®š</h2>
                        
                        <!-- Project ID è¼¸å…¥ -->
                        <div class="mb-6">
                            <label for="project-id" class="block text-sm font-medium text-gray-300 mb-2">å°ˆæ¡ˆ ID (å¯é¸)</label>
                            <input type="text" id="project-id" class="w-full px-4 py-2 rounded-lg bg-techbg border border-techprimary/20" placeholder="è«‹è¼¸å…¥å°ˆæ¡ˆ ID (å¯é¸)">
                            <p class="text-xs text-gray-400 mt-1">æ­¤ ID å°‡ç”¨æ–¼æª”æ¡ˆå‘½åå’Œè³‡æ–™å¤¾çµ„ç¹”ã€‚å¦‚ç„¡å°ˆæ¡ˆIDï¼Œç³»çµ±å°‡è‡ªå‹•ç”¢ç”Ÿè‡¨æ™‚ID</p>
                        </div>

                        <!-- è‡ªèº«å“ç‰Œè³‡è¨Š -->
                        <div class="mb-6">
                            <h3 class="text-lg font-semibold text-techaccent mb-4">ğŸ¢ è‡ªèº«å“ç‰Œè³‡è¨Š</h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label for="brand-name" class="block text-sm font-medium text-gray-300 mb-2">å“ç‰Œåç¨± *</label>
                                    <input type="text" id="brand-name" class="w-full px-4 py-2 rounded-lg bg-techbg border border-techprimary/20" placeholder="æ‚¨çš„å“ç‰Œåç¨±" required>
                                </div>
                                <div>
                                    <label for="brand-website" class="block text-sm font-medium text-gray-300 mb-2">å“ç‰Œå®˜ç¶²</label>
                                    <input type="url" id="brand-website" class="w-full px-4 py-2 rounded-lg bg-techbg border border-techprimary/20" placeholder="https://your-brand.com">
                                </div>
                            </div>
                            <div class="mt-4">
                                <label for="brand-description" class="block text-sm font-medium text-gray-300 mb-2">å“ç‰Œæè¿°</label>
                                <textarea id="brand-description" rows="3" class="w-full px-4 py-2 rounded-lg bg-techbg border border-techprimary/20" placeholder="ç°¡è¿°æ‚¨çš„å“ç‰Œå®šä½ã€æ ¸å¿ƒç”¢å“/æœå‹™ã€ç›®æ¨™å®¢ç¾¤ç­‰"></textarea>
                            </div>
                        </div>

                        <!-- ç”¢å“/æœå‹™åˆ†æ -->
                        <div class="mb-6">
                            <h3 class="text-lg font-semibold text-techaccent mb-4">ğŸ“¦ æ ¸å¿ƒç”¢å“/æœå‹™</h3>
                            <div id="products-container">
                                <div class="product-item bg-gray-800 rounded-lg p-4 mb-3">
                                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                        <div>
                                            <label class="block text-sm font-medium text-gray-300 mb-2">ç”¢å“/æœå‹™åç¨±</label>
                                            <input type="text" class="product-name w-full px-3 py-2 rounded bg-techbg border border-techprimary/20" placeholder="ä¸»è¦ç”¢å“åç¨±">
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium text-gray-300 mb-2">åƒ¹æ ¼å®šä½</label>
                                            <select class="product-pricing w-full px-3 py-2 rounded bg-techbg border border-techprimary/20">
                                                <option value="">é¸æ“‡åƒ¹æ ¼å®šä½</option>
                                                <option value="premium">é«˜åƒ¹ä½ (Premium)</option>
                                                <option value="mid-high">ä¸­é«˜åƒ¹ä½</option>
                                                <option value="mid">ä¸­åƒ¹ä½</option>
                                                <option value="mid-low">ä¸­ä½åƒ¹ä½</option>
                                                <option value="budget">å¹³åƒ¹ (Budget)</option>
                                            </select>
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium text-gray-300 mb-2">ç›®æ¨™å®¢ç¾¤</label>
                                            <input type="text" class="product-target w-full px-3 py-2 rounded bg-techbg border border-techprimary/20" placeholder="ç›®æ¨™å®¢ç¾¤æè¿°">
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <button id="add-product-btn" class="bg-techprimary hover:bg-techaccent text-white px-4 py-2 rounded-lg text-sm">+ æ·»åŠ ç”¢å“/æœå‹™</button>
                        </div>

                        <!-- è¡Œæ¥­èˆ‡å¸‚å ´åˆ†æ -->
                        <div class="mb-6">
                            <h3 class="text-lg font-semibold text-techaccent mb-4">ğŸ¯ è¡Œæ¥­èˆ‡å¸‚å ´åˆ†æ</h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label for="industry-category" class="block text-sm font-medium text-gray-300 mb-2">è¡Œæ¥­é¡åˆ¥ *</label>
                                    <select id="industry-category" class="w-full px-4 py-2 rounded-lg bg-techbg border border-techprimary/20" required>
                                        <option value="">é¸æ“‡è¡Œæ¥­é¡åˆ¥</option>
                                        <option value="ecommerce">é›»å•†å¹³å°</option>
                                        <option value="saas">SaaS/è»Ÿé«”æœå‹™</option>
                                        <option value="fintech">é‡‘èç§‘æŠ€</option>
                                        <option value="healthcare">é†«ç™‚å¥åº·</option>
                                        <option value="education">æ•™è‚²ç§‘æŠ€</option>
                                        <option value="marketing">æ•¸ä½è¡ŒéŠ·</option>
                                        <option value="ai-ml">AI/æ©Ÿå™¨å­¸ç¿’</option>
                                        <option value="gaming">éŠæˆ²å¨›æ¨‚</option>
                                        <option value="food-delivery">å¤–é€æœå‹™</option>
                                        <option value="travel">æ—…éŠæœå‹™</option>
                                        <option value="real-estate">æˆ¿åœ°ç”¢</option>
                                        <option value="automotive">æ±½è»Šç”¢æ¥­</option>
                                        <option value="fashion">æ™‚å°šæœé£¾</option>
                                        <option value="beauty">ç¾å¦ä¿é¤Š</option>
                                        <option value="other">å…¶ä»–</option>
                                    </select>
                                </div>
                                <div>
                                    <label for="market-size" class="block text-sm font-medium text-gray-300 mb-2">å¸‚å ´è¦æ¨¡</label>
                                    <select id="market-size" class="w-full px-4 py-2 rounded-lg bg-techbg border border-techprimary/20">
                                        <option value="">é¸æ“‡å¸‚å ´è¦æ¨¡</option>
                                        <option value="niche">åˆ©åŸºå¸‚å ´ (å°çœ¾)</option>
                                        <option value="small">å°å‹å¸‚å ´</option>
                                        <option value="medium">ä¸­å‹å¸‚å ´</option>
                                        <option value="large">å¤§å‹å¸‚å ´</option>
                                        <option value="massive">è¶…å¤§å¸‚å ´</option>
                                    </select>
                                </div>
                            </div>
                            <div class="mt-4">
                                <label for="analysis-topic" class="block text-sm font-medium text-gray-300 mb-2">å…·é«”åˆ†æä¸»é¡Œ *</label>
                                <input type="text" id="analysis-topic" class="w-full px-4 py-2 rounded-lg bg-techbg border border-techprimary/20" placeholder="ä¾‹å¦‚ï¼šå°ç£é›»å•†å¹³å°ã€æ•¸ä½è¡ŒéŠ·å·¥å…·ã€AI èŠå¤©æ©Ÿå™¨äººç­‰" required>
                                <p class="text-xs text-gray-400 mt-1">è«‹å…·é«”æè¿°æ‚¨è¦åˆ†æçš„å¸‚å ´ç´°åˆ†æˆ–ç”¢å“é¡åˆ¥ï¼Œé¿å…éæ–¼å»£æ³›</p>
                            </div>
                        </div>

                        <!-- SEO é—œéµå­—ç­–ç•¥ -->
                        <div class="mb-6">
                            <h3 class="text-lg font-semibold text-techaccent mb-4">ğŸ” SEO é—œéµå­—ç­–ç•¥</h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label for="primary-keywords" class="block text-sm font-medium text-gray-300 mb-2">ä¸»è¦é—œéµå­—</label>
                                    <textarea id="primary-keywords" rows="3" class="w-full px-4 py-2 rounded-lg bg-techbg border border-techprimary/20" placeholder="è¼¸å…¥ 3-5 å€‹ä¸»è¦é—œéµå­—ï¼Œæ¯è¡Œä¸€å€‹&#10;ä¾‹å¦‚ï¼š&#10;é›»å•†å¹³å°&#10;ç·šä¸Šè³¼ç‰©&#10;ç¶²è·¯å•†åº—"></textarea>
                                </div>
                                <div>
                                    <label for="long-tail-keywords" class="block text-sm font-medium text-gray-300 mb-2">é•·å°¾é—œéµå­—</label>
                                    <textarea id="long-tail-keywords" rows="3" class="w-full px-4 py-2 rounded-lg bg-techbg border border-techprimary/20" placeholder="è¼¸å…¥ 5-10 å€‹é•·å°¾é—œéµå­—ï¼Œæ¯è¡Œä¸€å€‹&#10;ä¾‹å¦‚ï¼š&#10;å°ç£é›»å•†å¹³å°æ¨è–¦&#10;å°å‹ä¼æ¥­é›»å•†è§£æ±ºæ–¹æ¡ˆ&#10;B2B é›»å•†å¹³å°æ¯”è¼ƒ"></textarea>
                                </div>
                            </div>
                            <div class="mt-4">
                                <label class="block text-sm font-medium text-gray-300 mb-2">é—œéµå­—åˆ†ææ·±åº¦</label>
                                <div class="space-y-2">
                                    <label class="flex items-center">
                                        <input type="radio" name="keyword-depth" value="basic" class="mr-2">
                                        <span class="text-sm">åŸºç¤åˆ†æ (æœå°‹é‡ã€ç«¶çˆ­åº¦)</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="radio" name="keyword-depth" value="standard" checked class="mr-2">
                                        <span class="text-sm">æ¨™æº–åˆ†æ (æœå°‹é‡ã€ç«¶çˆ­åº¦ã€å‡ºåƒ¹å»ºè­°)</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="radio" name="keyword-depth" value="comprehensive" class="mr-2">
                                        <span class="text-sm">æ·±åº¦åˆ†æ (æœå°‹é‡ã€ç«¶çˆ­åº¦ã€å‡ºåƒ¹å»ºè­°ã€å…§å®¹ç­–ç•¥)</span>
                                    </label>
                                </div>
                            </div>
                        </div>

                        <!-- ç«¶çˆ­å°æ‰‹æ•¸é‡ -->
                        <div class="mb-6">
                            <label for="competitor-count" class="block text-sm font-medium text-gray-300 mb-2">ç«¶çˆ­å°æ‰‹åˆ†ææ•¸é‡</label>
                            <select id="competitor-count" class="w-full px-4 py-2 rounded-lg bg-techbg border border-techprimary/20">
                                <option value="5">5 å€‹ (å¿«é€Ÿåˆ†æ)</option>
                                <option value="10" selected>10 å€‹ (æ¨™æº–åˆ†æ)</option>
                                <option value="15">15 å€‹ (è©³ç´°åˆ†æ)</option>
                                <option value="20">20 å€‹ (å…¨é¢åˆ†æ)</option>
                            </select>
                        </div>

                        <!-- åˆ†ææ·±åº¦ -->
                        <div class="mb-6">
                            <label class="block text-sm font-medium text-gray-300 mb-2">ç«¶çˆ­å°æ‰‹åˆ†ææ·±åº¦</label>
                            <div class="space-y-2">
                                <label class="flex items-center">
                                    <input type="radio" name="analysis-depth" value="basic" class="mr-2">
                                    <span class="text-sm">åŸºç¤åˆ†æ (åŸºæœ¬è³‡è¨Šã€ç”¢å“æ¯”è¼ƒ)</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="radio" name="analysis-depth" value="standard" checked class="mr-2">
                                    <span class="text-sm">æ¨™æº–åˆ†æ (è©³ç´°è³‡è¨Šã€SWOT åˆ†æã€è¡ŒéŠ·ç­–ç•¥)</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="radio" name="analysis-depth" value="comprehensive" class="mr-2">
                                    <span class="text-sm">æ·±åº¦åˆ†æ (è²¡å‹™åˆ†æã€æŠ€è¡“å¯¦åŠ›ã€æœªä¾†ç™¼å±•é æ¸¬)</span>
                                </label>
                            </div>
                        </div>

                        <button id="start-analysis-btn" class="w-full bg-gradient-to-tr from-techprimary to-techaccent font-bold text-white px-6 py-3 rounded-lg shadow-lg">é–‹å§‹åˆ†æ</button>
                    </section>
                </div>

                <!-- Step 2: å°æ‰‹ç¯©é¸èˆ‡è£œå…… -->
                <div id="step-2-content" class="step-panel" style="display: none;">
                    <section class="bg-techpanel rounded-xl shadow-2xl border border-techprimary/20 p-8">
                        <h2 class="text-2xl font-bold mb-6 text-techaccent">ğŸ¯ å°æ‰‹ç¯©é¸èˆ‡è£œå……</h2>
                        <div id="competitor-selection-content">
                            <div class="mb-6">
                                <h3 class="text-lg font-semibold text-gray-200 mb-4">åˆ†æä¸»é¡Œï¼š<span id="current-topic" class="text-techaccent"></span></h3>
                                <p class="text-gray-400 mb-4">ç³»çµ±å°‡è‡ªå‹•æœå°‹ä¸¦åˆ†æç›¸é—œç«¶çˆ­å°æ‰‹ï¼Œæ‚¨ä¹Ÿå¯ä»¥æ‰‹å‹•æ·»åŠ æˆ–ç§»é™¤ç«¶çˆ­å°æ‰‹ã€‚</p>
                            </div>

                            <!-- è‡ªå‹•æœå°‹çµæœ -->
                            <div class="mb-6">
                                <h4 class="text-md font-semibold text-gray-200 mb-3">ğŸ” è‡ªå‹•æœå°‹çµæœ</h4>
                                <div id="auto-search-results" class="space-y-3">
                                    <div class="flex items-center justify-center py-8">
                                        <div class="spinner"></div>
                                        <span class="ml-3 text-gray-400">æ­£åœ¨æœå°‹ç«¶çˆ­å°æ‰‹...</span>
                                    </div>
                                </div>
                            </div>

                            <!-- æ‰‹å‹•æ·»åŠ ç«¶çˆ­å°æ‰‹ -->
                            <div class="mb-6">
                                <h4 class="text-md font-semibold text-gray-200 mb-3">â• æ‰‹å‹•æ·»åŠ ç«¶çˆ­å°æ‰‹</h4>
                                <div class="flex gap-2 mb-3">
                                    <input type="text" id="manual-competitor" class="flex-1 px-4 py-2 rounded-lg bg-techbg border border-techprimary/20" placeholder="è¼¸å…¥ç«¶çˆ­å°æ‰‹åç¨±">
                                    <button id="add-competitor-btn" class="bg-techprimary hover:bg-techaccent text-white px-4 py-2 rounded-lg">æ·»åŠ </button>
                                </div>
                            </div>

                            <!-- å·²é¸æ“‡çš„ç«¶çˆ­å°æ‰‹ -->
                            <div class="mb-6">
                                <h4 class="text-md font-semibold text-gray-200 mb-3">ğŸ“‹ å·²é¸æ“‡çš„ç«¶çˆ­å°æ‰‹ (<span id="selected-count">0</span>)</h4>
                                <div id="selected-competitors" class="space-y-2">
                                    <p class="text-gray-500 text-sm">å°šæœªé¸æ“‡ä»»ä½•ç«¶çˆ­å°æ‰‹</p>
                                </div>
                            </div>

                            <div class="flex gap-4">
                                <button id="generate-report-btn" class="bg-gradient-to-tr from-techprimary to-techaccent font-bold text-white px-6 py-3 rounded-lg shadow-lg" disabled>ç”Ÿæˆå®Œæ•´å ±å‘Š</button>
                                <button id="back-to-step1-btn" class="bg-gray-600 hover:bg-gray-700 text-white px-6 py-3 rounded-lg">è¿”å›æ­¥é©Ÿ 1</button>
                            </div>
                        </div>
                    </section>
                </div>

                <!-- Step 3: å®Œæ•´å ±å‘Š -->
                <div id="step-3-content" class="step-panel" style="display: none;">
                    <section class="bg-techpanel rounded-xl shadow-2xl border border-techprimary/20 p-8">
                        <h2 class="text-2xl font-bold mb-6 text-techaccent">ğŸ“‹ å®Œæ•´å ±å‘Š</h2>
                        <div id="final-report-content">
                            <p class="text-gray-400">è«‹å…ˆå®Œæˆæ­¥é©Ÿ 2 çš„å°æ‰‹ç¯©é¸</p>
                        </div>
                    </section>
                </div>
            </div>

            <!-- æ­·å²ç´€éŒ„é¢æ¿ -->
            <div id="history-panel" class="panel">
                <section class="bg-techpanel rounded-xl shadow-2xl border border-techprimary/20 p-8">
                    <h2 class="text-2xl font-bold mb-6 text-techaccent">ğŸ“š æ­·å²ç´€éŒ„</h2>
                    <div id="history-content">
                        <p class="text-gray-400">æ­·å²ç´€éŒ„åŠŸèƒ½é–‹ç™¼ä¸­...</p>
                    </div>
                </section>
            </div>
        </div>
    </main>
</body>
</html>
